(()=>{var e={};e.id=165,e.ids=[165],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},6007:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>h,tree:()=>c});var t=a(482),r=a(9108),d=a(2563),l=a.n(d),i=a(8300),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);a.d(s,n);let c=["",{children:["(main)",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,1898)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(main)\\admin\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,2485)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(main)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,1342)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(main)\\admin\\page.tsx"],x="/(main)/admin/page",m={require:a,loadChunk:()=>Promise.resolve()},h=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(main)/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4806:(e,s,a)=>{Promise.resolve().then(a.bind(a,6513))},5299:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(9224).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},2739:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(9224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9895:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(9224).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},6513:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>Z});var t=a(5344),r=a(3729),d=a(6506),l=a(2273),i=a(5366),n=a(5299),c=a(7121),o=a(9895),x=a(9224);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,x.Z)("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]),h=(0,x.Z)("CircleDollarSign",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]);var p=a(5794);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,x.Z)("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);var g=a(7126),b=a(1917),f=a(1700),j=a(658),N=a(5750),y=a(8704),v=a(8732),_=a(4133),w=a(4755),k=a(3673);function Z(){let[e,s]=(0,r.useState)(null),[a,x]=(0,r.useState)(!0),[Z,P]=(0,r.useState)(0),[q,S]=(0,r.useState)([]),[M,A]=(0,r.useState)(0),[O,C]=(0,r.useState)(0),[U,D]=(0,r.useState)({totalArea10r:0,currentUnitPrice:null}),[E,Y]=(0,r.useState)(0),[G,X]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(0,N.ts)().then(e=>{s(e),x(!1)})},[]),(0,r.useEffect)(()=>{e&&("admin"===e.role&&(y.O.from("users").select("id",{count:"exact",head:!0}).eq("status","pending").then(({count:e})=>P(e??0)),y.O.from("projects").select("id",{count:"exact",head:!0}).eq("status","open").then(({count:e})=>A(e??0))),"provider"===e.role&&y.O.from("projects").select("id, campaign_title, location, final_date, status, is_closed, base_price, min_price, target_area_10r, min_target_area_10r, max_target_area_10r, execution_price").eq("provider_id",e.id).in("status",["open","closed","applied"]).order("start_date",{ascending:!0}).limit(10).then(({data:e})=>{if(!e?.length){S([]),D({totalArea10r:0,currentUnitPrice:null});return}let s=e.map(e=>e.id);Promise.all([y.O.from("bookings").select("campaign_id, confirmed_date, area_10r").in("campaign_id",s).neq("status","canceled"),...s.map(e=>(0,v.x1)(e))]).then(([a,...t])=>{let r=a.data||[],d=new Map;r.forEach(e=>{let s=e.campaign_id,a=d.get(s)||{confirmed_date:"",count:0};a.count+=1,e.confirmed_date&&(a.confirmed_date=e.confirmed_date),d.set(s,a)}),S(e.map(e=>{let s=d.get(e.id)||{confirmed_date:"",count:0};return{id:e.id,campaign_title:e.campaign_title||e.location||"案件",location:e.location||"",confirmed_date:s.confirmed_date,final_date:e.final_date||"",booking_count:s.count,status:e.status??"",is_closed:e.is_closed??!1}}).slice(0,5));let l=t.reduce((e,s)=>e+s,0),i=e.find(e=>!e.is_closed&&("open"===e.status||"applied"===e.status)),n=null;if(i&&i.id){let e=s.indexOf(i.id),a=e>=0?t[e]??0:0;n=(0,_.Bx)({base_price:i.base_price||0,min_price:i.min_price||0,target_area_10r:i.target_area_10r||0,min_target_area_10r:i.min_target_area_10r,max_target_area_10r:i.max_target_area_10r,execution_price:i.execution_price},a).currentPrice}D({totalArea10r:l,currentUnitPrice:n})})}))},[e,O]),a)?t.jsx("main",{className:"min-h-full flex items-center justify-center",children:t.jsx(j.Z,{message:"読み込み中..."})}):e&&("admin"===e.role||"provider"===e.role)?"admin"===e.role?t.jsx("main",{className:"min-h-full",children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-6 md:py-8",children:[(0,t.jsxs)("h1",{className:"text-xl md:text-2xl font-black text-dashboard-text flex items-center gap-2 mb-6",children:[t.jsx(l.Z,{className:"w-6 h-6 text-agrix-forest"}),"Platform Admin"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-6",children:[t.jsx(d.default,{href:"/admin/users",className:"block group",children:(0,t.jsxs)(k.Zb,{className:"h-full transition-all hover:shadow-md hover:border-agrix-forest/30",children:[(0,t.jsxs)(k.Ol,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-gold/20",children:t.jsx(i.Z,{className:"w-6 h-6 text-agrix-gold"})}),(0,t.jsxs)("div",{children:[t.jsx(k.ll,{className:"text-base",children:"承認待ちユーザー"}),t.jsx(k.SZ,{children:"未承認の申請"})]})]}),t.jsx(n.Z,{className:"w-5 h-5 text-dashboard-muted group-hover:text-agrix-forest transition-colors"})]}),(0,t.jsxs)(k.aY,{children:[t.jsx("p",{className:"text-2xl md:text-3xl font-black text-dashboard-text tabular-nums",children:Z}),t.jsx("span",{className:"text-sm text-dashboard-muted",children:"件"})]})]})}),(0,t.jsxs)(k.Zb,{children:[t.jsx(k.Ol,{className:"flex flex-row items-center justify-between pb-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-forest/10",children:t.jsx(c.Z,{className:"w-6 h-6 text-agrix-forest"})}),(0,t.jsxs)("div",{children:[t.jsx(k.ll,{className:"text-base",children:"募集中案件数"}),t.jsx(k.SZ,{children:"オープンな案件"})]})]})}),(0,t.jsxs)(k.aY,{children:[t.jsx("p",{className:"text-2xl md:text-3xl font-black text-dashboard-text tabular-nums",children:M}),t.jsx("span",{className:"text-sm text-dashboard-muted",children:"件"})]})]})]}),(0,t.jsxs)(k.Zb,{children:[(0,t.jsxs)(k.Ol,{className:"pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(o.Z,{className:"w-5 h-5 text-agrix-forest"}),t.jsx(k.ll,{className:"text-base",children:"クイックリンク"})]}),t.jsx(k.SZ,{children:"管理メニューへすばやくアクセス"})]}),t.jsx(k.aY,{children:t.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:t.jsx("li",{children:(0,t.jsxs)(d.default,{href:"/admin/users",className:"flex items-center gap-3 p-4 rounded-xl border border-dashboard-border hover:bg-dashboard-bg hover:border-agrix-forest/20 transition-colors",children:[t.jsx(i.Z,{className:"w-5 h-5 text-agrix-gold shrink-0"}),t.jsx("span",{className:"font-bold text-dashboard-text",children:"ユーザー承認管理"})]})})})})]})]})}):t.jsx("main",{className:"min-h-full",children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-6 md:py-8",children:[(0,t.jsxs)("h1",{className:"text-xl md:text-2xl font-black text-dashboard-text flex items-center gap-2 mb-6",children:[t.jsx(l.Z,{className:"w-6 h-6 text-agrix-forest"}),"ダッシュボード"]}),(0,t.jsxs)("section",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6 mb-6",children:[(0,t.jsxs)(k.Zb,{children:[t.jsx(k.Ol,{className:"flex flex-row items-start justify-between pb-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-forest/10",children:t.jsx(m,{className:"w-6 h-6 text-agrix-forest"})}),(0,t.jsxs)("div",{children:[t.jsx(k.ll,{className:"text-base",children:"合計面積"}),t.jsx(k.SZ,{children:"直近案件の申込合計"})]})]})}),t.jsx(k.aY,{children:(0,t.jsxs)("p",{className:"text-2xl md:text-3xl font-black text-agrix-forest tabular-nums",children:[U.totalArea10r.toFixed(1),t.jsx("span",{className:"text-base font-medium text-dashboard-muted ml-1",children:"反"})]})})]}),(0,t.jsxs)(k.Zb,{children:[t.jsx(k.Ol,{className:"flex flex-row items-start justify-between pb-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-gold/20",children:t.jsx(h,{className:"w-6 h-6 text-agrix-gold"})}),(0,t.jsxs)("div",{children:[t.jsx(k.ll,{className:"text-base",children:"現在の単価"}),t.jsx(k.SZ,{children:"募集中案件の暫定単価"})]})]})}),t.jsx(k.aY,{children:t.jsx("p",{className:"text-2xl md:text-3xl font-black tabular-nums",children:null!=U.currentUnitPrice?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{className:"text-agrix-gold",children:["\xa5",U.currentUnitPrice.toLocaleString()]}),t.jsx("span",{className:"text-base font-medium text-dashboard-muted ml-1",children:"/10a"})]}):t.jsx("span",{className:"text-dashboard-muted font-medium text-xl",children:"—"})})})]})]}),(0,t.jsxs)("section",{className:"mb-6",children:[(0,t.jsxs)("h2",{className:"text-base font-bold text-dashboard-text flex items-center gap-2 mb-4",children:[t.jsx(p.Z,{className:"w-5 h-5 text-agrix-forest"}),"直近の作業予定"]}),t.jsx(k.Zb,{children:0===q.length?(0,t.jsxs)(k.aY,{className:"p-10 flex flex-col items-center justify-center text-center",children:[t.jsx("div",{className:"rounded-full bg-dashboard-muted/20 p-6 mb-4",children:t.jsx(u,{className:"w-12 h-12 text-dashboard-muted"})}),t.jsx("p",{className:"font-bold text-dashboard-text mb-1",children:"現在予定はありません"}),t.jsx("p",{className:"text-sm text-dashboard-muted mb-6 max-w-sm",children:"新規案件を作成すると、ここに直近の作業予定が表示されます。"}),(0,t.jsxs)(d.default,{href:"/admin/campaigns/new",className:"inline-flex items-center gap-2 rounded-xl bg-agrix-forest text-white px-5 py-2.5 text-sm font-bold hover:bg-agrix-forest-dark transition-colors",children:[t.jsx(g.Z,{className:"w-4 h-4"}),"案件を作成"]})]}):t.jsx("ul",{className:"divide-y divide-dashboard-border",children:q.map(e=>(0,t.jsxs)("li",{className:"p-4 flex items-center justify-between gap-3 flex-wrap",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[t.jsx("p",{className:"font-bold text-dashboard-text",children:e.campaign_title||e.location}),(0,t.jsxs)("p",{className:"text-sm text-dashboard-muted",children:[e.confirmed_date||e.final_date?new Date(e.confirmed_date||e.final_date).toLocaleDateString("ja-JP"):"日付未確定"," \xb7 ","申込 ",e.booking_count," 件",e.is_closed||"closed"===e.status?" \xb7 締切済":""]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[!e.is_closed&&("open"===e.status||"applied"===e.status)&&t.jsx("button",{type:"button",onClick:async()=>{let s=await (0,v.dm)(e.id);s.success?(w.toast.success("募集を締め切りました"),C(e=>e+1)):w.toast.error(s.error??"締切に失敗しました")},className:"px-3 py-1.5 rounded-lg bg-agrix-gold/20 text-agrix-gold-dark text-sm font-bold hover:bg-agrix-gold/30 border border-agrix-gold/50",children:"募集締切"}),(0,t.jsxs)(d.default,{href:"/provider/calendar",className:"text-sm font-bold text-agrix-forest hover:underline flex items-center gap-1",children:["カレンダー ",t.jsx(n.Z,{className:"w-4 h-4"})]})]})]},e.id))})})]}),(0,t.jsxs)("section",{children:[t.jsx("h2",{className:"text-base font-bold text-dashboard-text flex items-center gap-2 mb-4",children:"メニュー"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4",children:[(0,t.jsxs)(d.default,{href:"/admin/campaigns/new",className:"flex items-center gap-4 p-4 rounded-2xl border border-dashboard-border bg-dashboard-card shadow-sm hover:shadow-md hover:border-agrix-forest/30 transition-all",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-forest/10",children:t.jsx(g.Z,{className:"w-6 h-6 text-agrix-forest"})}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-bold text-dashboard-text",children:"案件を作成"}),t.jsx("p",{className:"text-sm text-dashboard-muted",children:"新規募集を開始"})]}),t.jsx(n.Z,{className:"w-5 h-5 text-dashboard-muted ml-auto"})]}),(0,t.jsxs)(d.default,{href:"/provider/calendar",className:"flex items-center gap-4 p-4 rounded-2xl border border-dashboard-border bg-dashboard-card shadow-sm hover:shadow-md hover:border-agrix-forest/30 transition-all",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-forest/10",children:t.jsx(p.Z,{className:"w-6 h-6 text-agrix-forest"})}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-bold text-dashboard-text",children:"作業カレンダー"}),t.jsx("p",{className:"text-sm text-dashboard-muted",children:"予定の確認・管理"})]}),t.jsx(n.Z,{className:"w-5 h-5 text-dashboard-muted ml-auto"})]}),(0,t.jsxs)(d.default,{href:"/admin/masters",className:"flex items-center gap-4 p-4 rounded-2xl border border-dashboard-border bg-dashboard-card shadow-sm hover:shadow-md hover:border-agrix-forest/30 transition-all",children:[t.jsx("div",{className:"p-3 rounded-xl bg-dashboard-muted/20",children:t.jsx(b.Z,{className:"w-6 h-6 text-agrix-slate"})}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-bold text-dashboard-text",children:"マスタ管理"}),t.jsx("p",{className:"text-sm text-dashboard-muted",children:"品目・作業種別・農薬"})]}),t.jsx(n.Z,{className:"w-5 h-5 text-dashboard-muted ml-auto"})]}),(0,t.jsxs)(d.default,{href:"/admin/users",className:"flex items-center gap-4 p-4 rounded-2xl border border-dashboard-border bg-dashboard-card shadow-sm hover:shadow-md hover:border-agrix-forest/30 transition-all",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-gold/20",children:t.jsx(f.Z,{className:"w-6 h-6 text-agrix-gold"})}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-bold text-dashboard-text",children:"紐付き農家一覧"}),t.jsx("p",{className:"text-sm text-dashboard-muted",children:"自分に紐付いている農家"})]}),t.jsx(n.Z,{className:"w-5 h-5 text-dashboard-muted ml-auto"})]}),(0,t.jsxs)(d.default,{href:"/provider/reports/new",className:"flex items-center gap-4 p-4 rounded-2xl border border-dashboard-border bg-dashboard-card shadow-sm hover:shadow-md hover:border-agrix-forest/30 transition-all",children:[t.jsx("div",{className:"p-3 rounded-xl bg-agrix-gold/20",children:t.jsx(c.Z,{className:"w-6 h-6 text-agrix-gold"})}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-bold text-dashboard-text",children:"実績報告"}),t.jsx("p",{className:"text-sm text-dashboard-muted",children:"作業完了の報告"})]}),t.jsx(n.Z,{className:"w-5 h-5 text-dashboard-muted ml-auto"})]})]})]})]})}):t.jsx("main",{className:"min-h-full flex items-center justify-center p-4",children:t.jsx(k.Zb,{children:t.jsx(k.aY,{className:"p-8 text-center text-dashboard-muted",children:"この画面を利用する権限がありません。"})})})}},658:(e,s,a)=>{"use strict";a.d(s,{Z:()=>l});var t=a(5344),r=a(2739),d=a(1453);function l({message:e="読み込み中...",className:s}){return(0,t.jsxs)("div",{className:(0,d.cn)("flex min-h-[40vh] flex-col items-center justify-center gap-4",s),children:[t.jsx(r.Z,{className:"h-12 w-12 text-agrix-forest animate-spin","aria-hidden":!0}),t.jsx("p",{className:"text-sm font-medium text-slate-600",children:e})]})}},1898:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>d,__esModule:()=>r,default:()=>l});let t=(0,a(6843).createProxy)(String.raw`C:\Users\yusuk\Documents\wwx\Wayfinder AgriX\v3-app\src\app\(main)\admin\page.tsx`),{__esModule:r,$$typeof:d}=t,l=t.default}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[638,240,337,859,232,164,993,534],()=>a(6007));module.exports=t})();