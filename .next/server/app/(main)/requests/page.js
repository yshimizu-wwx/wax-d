(()=>{var e={};e.id=419,e.ids=[419],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},2115:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>l});var s=r(482),a=r(9108),n=r(2563),d=r.n(n),i=r(8300),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let l=["",{children:["(main)",{children:["requests",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2145)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(main)\\requests\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2485)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(main)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,1342)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(main)\\requests\\page.tsx"],x="/(main)/requests/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/requests/page",pathname:"/requests",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},9649:(e,t,r)=>{Promise.resolve().then(r.bind(r,8538))},8538:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var s=r(5344),a=r(3729),n=r(8428),d=r(6506),i=r(6135),o=r(6810),l=r(7121),c=r(4755),x=r(5750),u=r(7083),m=r(658),h=r(3673),p=r(5190),f=r(6540),g=r(7361),b=r(9626);function v({farmerId:e,fields:t,linkedProviders:r,onSubmit:n,onCancel:d}){let[i,o]=(0,a.useState)(""),[l,c]=(0,a.useState)(""),[x,u]=(0,a.useState)(""),[m,v]=(0,a.useState)(""),[j,y]=(0,a.useState)(""),[_,N]=(0,a.useState)(""),[w,k]=(0,a.useState)(""),[S,D]=(0,a.useState)(new Set),[q,C]=(0,a.useState)(""),[P,I]=(0,a.useState)(!1),[E,z]=(0,a.useState)({}),[A,U]=(0,a.useState)([]),[Z,F]=(0,a.useState)([]),[O,M]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!i){U([]),F([]),M([]),u(""),v(""),y("");return}Promise.all([(0,b.iB)("crop",i),(0,b.iB)("task_category",i),(0,b.iB)("task_detail",i)]).then(([e,t,r])=>{U(e),F(t),M(r),u(""),v(""),y("")})},[i]);let W=(0,a.useMemo)(()=>t.filter(e=>S.has(e.id)).reduce((e,t)=>e+(t.area_size??0),0),[t,S]),$=e=>{D(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},G=A.find(e=>e.id===x)?.name,R=Z.find(e=>e.id===m)?.name,X=O.find(e=>e.id===j)?.name,B=()=>{let e={};return i||(e.providerId="依頼先の業者を選んでください"),0===S.size&&(e.fields="対象の畑を1つ以上選んでください"),x||(e.cropId="品目を選んでください"),m||(e.taskCategoryId="作業種別を選んでください"),j||(e.taskDetailId="作業内容を選んでください"),_||(e.desiredStartDate="希望開始日を選んでください"),w||(e.desiredEndDate="希望終了日を選んでください"),_&&w&&_>w&&(e.desiredEndDate="終了日は開始日以降にしてください"),z(e),0===Object.keys(e).length},Y=async t=>{if(t.preventDefault(),B()){I(!0);try{await n({farmer_id:e,provider_id:i,location:l||void 0,crop_name:G,task_category_name:R,task_detail_name:X,desired_start_date:_||void 0,desired_end_date:w||void 0,estimated_area_10r:W>0?Math.round(10*W)/10:void 0,field_ids:Array.from(S),notes:q||void 0}),o(""),c(""),u(""),v(""),y(""),N(""),k(""),D(new Set),C(""),z({})}finally{I(!1)}}};return 0===r.length?s.jsx(h.Zb,{children:s.jsx(h.aY,{className:"p-6",children:s.jsx("p",{className:"text-dashboard-muted text-sm",children:"依頼先の業者とまだ紐付けされていません。招待コードで業者と紐付けてから作業依頼を送信できます。"})})}):s.jsx(h.Zb,{children:s.jsx(h.aY,{className:"p-6",children:(0,s.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"provider",children:"依頼先の業者"}),(0,s.jsxs)("select",{id:"provider",value:i,onChange:e=>o(e.target.value),className:"mt-1 w-full rounded-lg border border-dashboard-border bg-dashboard-card px-3 py-2 text-sm text-dashboard-text focus:outline-none focus:ring-2 focus:ring-agrix-forest",children:[s.jsx("option",{value:"",children:"選択してください"}),r.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),E.providerId&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.providerId})]}),(0,s.jsxs)("div",{children:[s.jsx(g._,{children:"対象の畑（複数選択可）"}),s.jsx("p",{className:"text-xs text-dashboard-muted mb-2",children:"依頼対象の畑にチェックを入れてください。合計面積は自動計算されます。"}),s.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto rounded-lg border border-dashboard-border bg-dashboard-card p-3",children:t.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:S.has(e.id),onChange:()=>$(e.id),className:"rounded border-dashboard-border text-agrix-forest focus:ring-agrix-forest"}),(0,s.jsxs)("span",{className:"text-sm text-dashboard-text",children:[e.name||"（名称未設定）",null!=e.area_size&&` \xb7 ${e.area_size} 反`]})]},e.id))}),E.fields&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.fields}),(0,s.jsxs)("div",{className:"mt-2",children:[s.jsx(g._,{className:"text-dashboard-muted font-normal",children:"合計面積（反）"}),s.jsx(f.I,{readOnly:!0,value:W>0?String(Math.round(10*W)/10):"",placeholder:"畑を選択すると自動で計算されます",className:"mt-1 bg-dashboard-bg"})]})]}),(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"location",children:"依頼場所・地域（任意）"}),s.jsx(f.I,{id:"location",value:l,onChange:e=>c(e.target.value),placeholder:"例: 〇〇県〇〇市",className:"mt-1"})]}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"crop",children:"品目"}),(0,s.jsxs)("select",{id:"crop",value:x,onChange:e=>u(e.target.value),className:"mt-1 w-full rounded-lg border border-dashboard-border bg-dashboard-card px-3 py-2 text-sm text-dashboard-text focus:outline-none focus:ring-2 focus:ring-agrix-forest",children:[s.jsx("option",{value:"",children:"選択してください"}),A.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),E.cropId&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.cropId})]}),(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"taskCategory",children:"作業種別"}),(0,s.jsxs)("select",{id:"taskCategory",value:m,onChange:e=>v(e.target.value),className:"mt-1 w-full rounded-lg border border-dashboard-border bg-dashboard-card px-3 py-2 text-sm text-dashboard-text focus:outline-none focus:ring-2 focus:ring-agrix-forest",children:[s.jsx("option",{value:"",children:"選択してください"}),Z.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),E.taskCategoryId&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.taskCategoryId})]}),(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"taskDetail",children:"作業内容（詳細）"}),(0,s.jsxs)("select",{id:"taskDetail",value:j,onChange:e=>y(e.target.value),className:"mt-1 w-full rounded-lg border border-dashboard-border bg-dashboard-card px-3 py-2 text-sm text-dashboard-text focus:outline-none focus:ring-2 focus:ring-agrix-forest",children:[s.jsx("option",{value:"",children:"選択してください"}),O.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),E.taskDetailId&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.taskDetailId})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"desiredStartDate",children:"希望開始日"}),s.jsx(f.I,{id:"desiredStartDate",type:"date",value:_,onChange:e=>N(e.target.value),className:"mt-1"}),E.desiredStartDate&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.desiredStartDate})]}),(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"desiredEndDate",children:"希望終了日"}),s.jsx(f.I,{id:"desiredEndDate",type:"date",value:w,min:_||void 0,onChange:e=>k(e.target.value),className:"mt-1"}),E.desiredEndDate&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:E.desiredEndDate})]})]}),(0,s.jsxs)("div",{children:[s.jsx(g._,{htmlFor:"notes",children:"備考"}),s.jsx("textarea",{id:"notes",value:q,onChange:e=>C(e.target.value),placeholder:"業者への連絡事項など",className:"mt-1 w-full min-h-[80px] rounded-lg border border-dashboard-border bg-dashboard-card px-3 py-2 text-sm text-dashboard-text focus:outline-none focus:ring-2 focus:ring-agrix-forest"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 pt-2",children:[s.jsx(p.z,{type:"submit",disabled:P,className:"bg-agrix-forest hover:bg-agrix-forest-dark",children:P?"送信中...":"作業を依頼する"}),d&&s.jsx(p.z,{type:"button",variant:"outline",onClick:d,children:"キャンセル"})]})]})})})}let j={pending:"依頼中",converted:"案件化済み",rejected:"お断り"};function y(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)(null),[f,g]=(0,a.useState)(!0),[b,y]=(0,a.useState)([]),[_,N]=(0,a.useState)([]),[w,k]=(0,a.useState)([]);(0,a.useEffect)(()=>{(0,x.ts)().then(e=>{r(e??null),g(!1)})},[]),(0,a.useEffect)(()=>{t&&"farmer"===t.role&&((0,u.xW)(t.id).then(y),(0,u.cd)(t.id).then(N),(0,u.ye)(t.id).then(k))},[t]),(0,a.useEffect)(()=>{!f&&t&&"farmer"!==t.role&&e.replace("/")},[t,f,e]);let S=async e=>{if(!t||"farmer"!==t.role)return;let r=await (0,u.xC)(e);if(r.success)c.toast.success("作業依頼を送信しました"),(0,u.xW)(t.id).then(y);else throw c.toast.error(r.error||"送信に失敗しました"),Error(r.error)};return f?s.jsx("main",{className:"min-h-full flex items-center justify-center",children:s.jsx(m.Z,{message:"読み込み中..."})}):t&&"farmer"===t.role?s.jsx("main",{className:"min-h-full",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8",children:[(0,s.jsxs)("h1",{className:"text-xl font-bold text-dashboard-text mb-2 flex items-center gap-2",children:[s.jsx(i.Z,{className:"w-6 h-6 text-agrix-forest"}),"作業依頼"]}),s.jsx("p",{className:"text-sm text-dashboard-muted mb-6",children:"業者に作業を依頼し、案件として募集してもらうための依頼を送信できます。"}),(0,s.jsxs)("section",{className:"mb-8",children:[s.jsx("h2",{className:"text-lg font-bold text-dashboard-text mb-4",children:"新規依頼"}),0===_.length?s.jsx(h.Zb,{children:(0,s.jsxs)(h.aY,{className:"p-8 flex flex-col items-center justify-center text-center",children:[s.jsx("div",{className:"rounded-full bg-amber-500/10 p-4 mb-4",children:s.jsx(o.Z,{className:"w-10 h-10 text-amber-600"})}),s.jsx("p",{className:"font-bold text-dashboard-text mb-1",children:"まずは圃場を登録してください"}),s.jsx("p",{className:"text-sm text-dashboard-muted mb-4",children:"作業依頼をするには、依頼対象の畑を登録する必要があります。"}),s.jsx(d.default,{href:"/my-fields",children:s.jsx(p.z,{className:"bg-agrix-forest hover:bg-agrix-forest-dark w-full sm:w-auto",children:"畑を登録する"})})]})}):s.jsx(v,{farmerId:t.id,fields:_,linkedProviders:w,onSubmit:S})]}),(0,s.jsxs)("section",{children:[(0,s.jsxs)("h2",{className:"text-lg font-bold text-dashboard-text mb-4 flex items-center gap-2",children:[s.jsx(l.Z,{className:"w-5 h-5 text-agrix-forest"}),"依頼一覧"]}),s.jsx(h.Zb,{className:"overflow-hidden",children:0===b.length?s.jsx(h.aY,{className:"p-10 text-center text-dashboard-muted",children:"まだ依頼がありません。上記フォームから依頼を送信してください。"}):s.jsx("ul",{className:"divide-y divide-dashboard-border",children:b.map(e=>s.jsx("li",{className:"p-4",children:s.jsx("div",{className:"flex flex-wrap items-start justify-between gap-2",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-bold text-dashboard-text",children:[e.crop_name_free_text||e.crop_name||"（作物未指定）",e.task_detail_free_text||e.task_detail_name?` \xb7 ${e.task_detail_free_text||e.task_detail_name}`:""]}),(0,s.jsxs)("p",{className:"text-sm text-dashboard-muted",children:[e.location&&`${e.location} \xb7 `,"希望: ",e.desired_start_date||"未定"," ～ ",e.desired_end_date||"未定",null!=e.estimated_area_10r&&` \xb7 ${e.estimated_area_10r} 反`]}),(0,s.jsxs)("p",{className:"text-xs text-dashboard-muted mt-1",children:[e.created_at&&new Date(e.created_at).toLocaleString("ja-JP")," \xb7 ",s.jsx("span",{className:"converted"===e.status?"text-agrix-forest font-medium":"rejected"===e.status?"text-red-600":"",children:j[e.status]||e.status})]})]})})},e.id))})})]})]})}):s.jsx("main",{className:"min-h-full flex items-center justify-center",children:s.jsx(m.Z,{message:"リダイレクト中..."})})}},658:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var s=r(5344),a=r(2739),n=r(1453);function d({message:e="読み込み中...",className:t}){return(0,s.jsxs)("div",{className:(0,n.cn)("flex min-h-[40vh] flex-col items-center justify-center gap-4",t),children:[s.jsx(a.Z,{className:"h-12 w-12 text-agrix-forest animate-spin","aria-hidden":!0}),s.jsx("p",{className:"text-sm font-medium text-slate-600",children:e})]})}},5190:(e,t,r)=>{"use strict";r.d(t,{z:()=>u});var s,a,n=r(5344),d=r(3729),i=r(6815);let o=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=i.W;var c=r(1453);let x=(s="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold tracking-tight transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0",a={variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",accent:"bg-accent text-accent-foreground hover:bg-accent/80 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10",secondary:"bg-muted text-muted-foreground hover:bg-muted/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}},e=>{var t;if((null==a?void 0:a.variants)==null)return l(s,null==e?void 0:e.class,null==e?void 0:e.className);let{variants:r,defaultVariants:n}=a,d=Object.keys(r).map(t=>{let s=null==e?void 0:e[t],a=null==n?void 0:n[t];if(null===s)return null;let d=o(s)||o(a);return r[t][d]}),i=e&&Object.entries(e).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{});return l(s,d,null==a?void 0:null===(t=a.compoundVariants)||void 0===t?void 0:t.reduce((e,t)=>{let{class:r,className:s,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...n,...i}[t]):({...n,...i})[t]===r})?[...e,r,s]:e},[]),null==e?void 0:e.class,null==e?void 0:e.className)}),u=d.forwardRef(({className:e,variant:t,size:r,...s},a)=>n.jsx("button",{className:(0,c.cn)(x({variant:t,size:r,className:e})),ref:a,...s}));u.displayName="Button"},6540:(e,t,r)=>{"use strict";r.d(t,{I:()=>d});var s=r(5344),a=r(3729),n=r(1453);let d=a.forwardRef(({className:e,type:t,...r},a)=>s.jsx("input",{type:t,className:(0,n.cn)("flex h-11 w-full rounded-lg border border-border bg-card px-4 py-2 text-sm font-medium text-foreground ring-offset-background transition-colors","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:border-primary","disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));d.displayName="Input"},7361:(e,t,r)=>{"use strict";r.d(t,{_:()=>d});var s=r(5344),a=r(3729),n=r(1453);let d=a.forwardRef(({className:e,...t},r)=>s.jsx("label",{ref:r,className:(0,n.cn)("block text-sm font-bold text-foreground leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...t}));d.displayName="Label"},9626:(e,t,r)=>{"use strict";r.d(t,{Rn:()=>n,VJ:()=>o,b9:()=>i,fz:()=>d,iB:()=>a});var s=r(8704);async function a(e,t){let r=s.O.from("masters").select("*").eq("type",e).order("name",{ascending:!0});t&&(r=r.or(`provider_id.eq.${t},provider_id.is.null`));let{data:a,error:n}=await r;return n?(console.error("Error fetching masters:",n),[]):a||[]}async function n(e,t,r,a){try{let n="undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),{error:d}=await s.O.from("masters").insert({id:n,provider_id:r,type:e,name:t.trim(),parent_id:a||null,status:"active"});if(d)return{success:!1,error:d.message};return{success:!0,id:n}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function d(e,t){try{let{error:r}=await s.O.from("masters").update(t).eq("id",e);if(r)return{success:!1,error:r.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function i(e){return d(e,{status:"inactive"})}async function o(e){return d(e,{status:"active"})}},2145:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>d});let s=(0,r(6843).createProxy)(String.raw`C:\Users\yusuk\Documents\wwx\Wayfinder AgriX\v3-app\src\app\(main)\requests\page.tsx`),{__esModule:a,$$typeof:n}=s,d=s.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,240,337,859,804,792,993,764],()=>r(2115));module.exports=s})();