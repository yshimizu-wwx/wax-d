"use strict";(()=>{var e={};e.id=476,e.ids=[476],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8408:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>f});var a={};r.r(a),r.d(a,{GET:()=>d});var i=r(5419),n=r(9108),o=r(9678),s=r(8070),c=r(2509);async function l(e,t,r){let a=t.user?.email;if(!a)return{redirectPath:"/login"};let{data:i,error:n}=await e.from("users").select("role, id, invitation_code, associated_provider_id").eq("email",a).single();if(n||!i)return{redirectPath:"/login"};let o="provider"===i.role?"under_review":"active";if(await e.from("users").update({status:o}).eq("email",a),"farmer"===i.role){let r=t.user?.user_metadata?.provider_id||null;if(!r&&i.invitation_code){let{data:t}=await e.from("users").select("id").eq("invitation_code",i.invitation_code).eq("role","provider").single();r=t?.id??null}if(r){let{data:t}=await e.from("farmer_providers").select("provider_id").eq("farmer_id",i.id).eq("provider_id",r).eq("status","active").maybeSingle(),{count:a}=await e.from("farmer_providers").select("*",{count:"exact",head:!0}).eq("farmer_id",i.id).eq("status","active");!t&&(a??0)<10&&await e.from("farmer_providers").insert({farmer_id:i.id,provider_id:r,status:"active",created_at:new Date().toISOString()})}}return"provider"===i.role?{redirectPath:"/auth/pending-approval"}:{redirectPath:"/auth/verified"}}async function d(e){let t=new URL(e.url),r=t.searchParams.get("code");if(!r)return s.Z.redirect(new URL("/login",t.origin));let a=await (0,c.e)(),{data:i,error:n}=await a.auth.exchangeCodeForSession(r);if(n||!i.user)return s.Z.redirect(new URL("/login",t.origin));let o=await l(a,{user:i.user},t.origin);return s.Z.redirect(new URL(o.redirectPath,t.origin))}let u=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/(auth)/auth/callback/route",pathname:"/auth/callback",filename:"route",bundlePath:"app/(auth)/auth/callback/route"},resolvedPagePath:"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\(auth)\\auth\\callback\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:v,staticGenerationBailout:f}=u,g="/(auth)/auth/callback/route";function w(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},2509:(e,t,r)=>{r.d(t,{e:()=>n});var a=r(6496),i=r(7439);async function n(){let e=await (0,i.cookies)();return(0,a.createServerClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:a})=>{r?e.set(t,r,a):e.delete(t)})}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,320],()=>r(8408));module.exports=a})();