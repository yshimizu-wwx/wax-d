"use strict";(()=>{var t={};t.id=129,t.ids=[129],t.modules={517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6467:(t,e,a)=>{a.r(e),a.d(e,{headerHooks:()=>w,originalPathname:()=>P,patchFetch:()=>j,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>N});var r={};a.r(r),a.d(r,{GET:()=>d});var n=a(5419),s=a(9108),i=a(9678),l=a(8070),o=a(4480);function u(t){let e=t.trim();return!!(/日本|Japan|にほん|ニホン/i.test(e)||/[一-龥ぁ-んァ-ン]/.test(e)||/県|府|都|道|郡|町|村|市|区|丁目|番地/.test(e))}function c(t){let e=t.trim();return!u(e)||/日本|Japan/i.test(e)?e:`${e}, Japan`}async function m(t){let e=t?.trim();if(!e)return null;try{let t=await (0,o.X)(e);if(t)return{lat:t.lat,lng:t.lng,displayName:t.displayName}}catch{}let a=c(e),r=new URLSearchParams({q:a,format:"json",limit:"1",addressdetails:"0"});r.set("countrycodes","jp");let n=async()=>{let t=await fetch(`https://nominatim.openstreetmap.org/search?${r.toString()}`,{method:"GET",headers:{Accept:"application/json","User-Agent":"WayfinderAgriX/1.0 (Agricultural field mapping)"}});if(!t.ok)return null;let e=await t.json();if(!Array.isArray(e)||0===e.length)return null;let a=e[0],n=parseFloat(a.lat),s=parseFloat(a.lon);return Number.isNaN(n)||Number.isNaN(s)?null:{lat:n,lng:s,displayName:a.display_name}},s=await n();if(s||a===e||(r.set("q",e),await new Promise(t=>setTimeout(t,1100)),s=await n()),!s&&u(e)){let t=e.replace(/\s*[\d０-９\-－ー]+\s*$/,"").trim();t&&t.length>=2&&(r.set("q",c(t)),await new Promise(t=>setTimeout(t,1100)),s=await n())}if(!s&&/^利根郡/.test(e)&&(r.set("q",c(`群馬県${e}`)),await new Promise(t=>setTimeout(t,1100)),!(s=await n()))){let t=e.replace(/\s*[\d０-９\-－ー]+\s*$/,"").trim();t.length>=2&&(r.set("q",c(`群馬県${t}`)),await new Promise(t=>setTimeout(t,1100)),s=await n())}return s}async function p(t,e){if("number"!=typeof t||"number"!=typeof e||Number.isNaN(t)||Number.isNaN(e))return null;try{let{reverseGeocodeWithGoogle:r}=await Promise.resolve().then(a.bind(a,4480));return r(t,e)}catch{}return null}async function d(t){let e=t.nextUrl.searchParams.get("address"),a=t.nextUrl.searchParams.get("lat"),r=t.nextUrl.searchParams.get("lng");if(null!=a&&null!=r){let t=parseFloat(a),e=parseFloat(r);if(Number.isNaN(t)||Number.isNaN(e))return l.Z.json({error:"lat, lng は数値で指定してください"},{status:400});try{let a=await p(t,e);if(!a)return l.Z.json({error:"住所が見つかりませんでした"},{status:404});return l.Z.json({lat:a.lat,lng:a.lng,displayName:a.displayName})}catch(t){return console.error("[geocode reverse]",t),l.Z.json({error:"検索に失敗しました"},{status:500})}}if(!e?.trim())return l.Z.json({error:"address を指定するか、lat と lng を指定してください"},{status:400});try{let t=await m(e.trim());if(!t)return l.Z.json({error:"住所が見つかりませんでした"},{status:404});return l.Z.json({lat:t.lat,lng:t.lng,displayName:t.displayName})}catch(t){return console.error("[geocode]",t),l.Z.json({error:"検索に失敗しました"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/geocode/route",pathname:"/api/geocode",filename:"route",bundlePath:"app/api/geocode/route"},resolvedPagePath:"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\api\\geocode\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:h,headerHooks:w,staticGenerationBailout:N}=g,P="/api/geocode/route";function j(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},4480:(t,e,a)=>{a.d(e,{X:()=>s,reverseGeocodeWithGoogle:()=>i});let r="https://maps.googleapis.com/maps/api/geocode/json";function n(t){if("OK"!==t.status&&"ZERO_RESULTS"!==t.status||!t.results?.length)return null;let e=t.results[0],a=e.geometry?.location;return a&&"number"==typeof a.lat&&"number"==typeof a.lng?{lat:a.lat,lng:a.lng,displayName:e.formatted_address}:null}async function s(t){let e="AIzaSyAU72mFnbq_Pc3_RJDJXZ7SEUKkZMPL1Ug";if(!e?.trim())return null;let a=t?.trim();if(!a)return null;let s=async t=>{try{let a=new URLSearchParams({address:t,key:e,region:"jp",language:"ja"}),s=await fetch(`${r}?${a.toString()}`);if(!s.ok)return null;let i=await s.json();return n(i)}catch{return null}},i=await s(a);if(!i&&(/[一-龥ぁ-んァ-ン]/.test(a)||/県|府|都|道|郡|町|村|市|区/.test(a))&&!/日本|Japan/i.test(a)&&(i=await s(`${a}, 日本`)),!(!i&&/^利根郡/.test(a))||(i=await s(`群馬県${a}`))||(i=await s(`群馬県${a}, 日本`)),!i){let t=a.replace(/\s*[\d０-９\-－ー]+\s*$/,"").trim();!(t.length>=2)||t===a||(i=await s(t))||/日本|Japan/i.test(t)||(i=await s(`${t}, 日本`))}return i}async function i(t,e){let a="AIzaSyAU72mFnbq_Pc3_RJDJXZ7SEUKkZMPL1Ug";if(!a?.trim())return null;try{let s=new URLSearchParams({latlng:`${t},${e}`,key:a,language:"ja"}),i=await fetch(`${r}?${s.toString()}`);if(!i.ok)return null;let l=await i.json();return n(l)}catch{return null}}}};var e=require("../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[638,206],()=>a(6467));module.exports=r})();