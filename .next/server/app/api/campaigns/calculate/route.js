"use strict";(()=>{var e={};e.id=910,e.ids=[910],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9289:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>x});var n={};r.r(n),r.d(n,{POST:()=>l});var a=r(5419),i=r(9108),s=r(9678),o=r(8070),c=r(2509),u=r(1498);async function l(e){try{let t=await (0,c.e)(),{data:{session:r}}=await t.auth.getSession();if(!r?.user?.email)return o.Z.json({success:!1,message:"未ログインです"},{status:401});let{base_price:n,min_price:a,target_area_10r:i,min_target_area_10r:s,max_target_area_10r:l,execution_price:p,totalArea10r:m,appliedArea10r:d}=await e.json();if("number"!=typeof n||"number"!=typeof a||"number"!=typeof i||"number"!=typeof m||m<0)return o.Z.json({success:!1,message:"base_price, min_price, target_area_10r, totalArea10r は数値で必須です"},{status:400});let f=function(e){let{pricing:t,totalArea10r:r,appliedArea10r:n}=e,a=(0,u.Bx)(t,r),i={currentPrice:a.currentPrice,progress:a.progress,isUnformed:a.isUnformed,remainingArea:a.remainingArea,priceReduction:a.priceReduction},s=a.currentPrice??t.base_price;if(null!=n&&n>0){let e=(0,u.MR)(s,n),t=(0,u.km)(e);i.amountExTax=e,i.taxAmount=t.taxAmount,i.amountInclusive=t.amountInclusive,i.taxRate=t.taxRate}return i}({pricing:{base_price:n,min_price:a,target_area_10r:i,min_target_area_10r:s,max_target_area_10r:l,execution_price:p},totalArea10r:m,appliedArea10r:d});return o.Z.json({success:!0,result:f})}catch(t){let e=t instanceof Error?t.message:"計算エラー";return o.Z.json({success:!1,message:e},{status:400})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/campaigns/calculate/route",pathname:"/api/campaigns/calculate",filename:"route",bundlePath:"app/api/campaigns/calculate/route"},resolvedPagePath:"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\api\\campaigns\\calculate\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:f,headerHooks:g,staticGenerationBailout:x}=p,h="/api/campaigns/calculate/route";function y(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},1498:(e,t,r)=>{function n(e,t){let{base_price:r,min_price:n,target_area_10r:a,min_target_area_10r:i=0,max_target_area_10r:s,execution_price:o}=e;if(r<n)throw Error("開始単価は目標単価以上である必要があります");if(t<0)throw Error("申込合計面積は0以上である必要があります");return i>0&&s&&s>0&&o?function(e,t){let{base_price:r,min_price:n,min_target_area_10r:a,max_target_area_10r:i,execution_price:s}=e;if(t<a){let e=a-t;return{currentPrice:null,progress:t/a,isUnformed:!0,priceReduction:0,remainingArea:e,nextMilestoneArea:e}}if(t>=i)return{currentPrice:Math.round(n),progress:1,isUnformed:!1,priceReduction:r-n,remainingArea:0,nextMilestoneArea:0};let o=(t-a)/(i-a),c=s+(n-s)*o,u=i-t;return{currentPrice:Math.round(c),progress:o,isUnformed:!1,priceReduction:r-c,remainingArea:u,nextMilestoneArea:u}}(e,t):function(e,t){let{base_price:r,min_price:n,target_area_10r:a}=e,i=Math.min(t/a,1),s=r-(r-n)*i,o=Math.max(0,a-t);return{currentPrice:Math.round(s),progress:i,isUnformed:!1,priceReduction:r-s,remainingArea:o,nextMilestoneArea:o>0?o:void 0}}(e,t)}function a(e,t){if(e<0||t<0)throw Error("単価と実績面積は0以上である必要があります");return Math.round(e*t)}function i(e,t=10){if(e<0)throw Error("税抜金額は0以上である必要があります");if(t<0||t>100)throw Error("消費税率は0〜100%の範囲である必要があります");let r=Math.round(t/100*e);return{amountExTax:e,taxAmount:r,amountInclusive:e+r,taxRate:t}}r.d(t,{Bx:()=>n,MR:()=>a,km:()=>i})},2509:(e,t,r)=>{r.d(t,{e:()=>i});var n=r(6496),a=r(7439);async function i(){let e=await (0,a.cookies)();return(0,n.createServerClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:n})=>{r?e.set(t,r,n):e.delete(t)})}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,320],()=>r(9289));module.exports=n})();