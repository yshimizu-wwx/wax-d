(()=>{var e={};e.id=974,e.ids=[974],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},2309:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var s=r(482),a=r(9108),n=r(2563),l=r.n(n),i=r(8300),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let d=["",{children:["provider",{children:["reports",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4107)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\provider\\reports\\new\\page.tsx"]}]},{}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,7858)),"C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\yusuk\\Documents\\wwx\\Wayfinder AgriX\\v3-app\\src\\app\\provider\\reports\\new\\page.tsx"],u="/provider/reports/new/page",p={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/provider/reports/new/page",pathname:"/provider/reports/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9855:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},8750:(e,t,r)=>{Promise.resolve().then(r.bind(r,4755)),Promise.resolve().then(r.bind(r,2041))},5665:(e,t,r)=>{Promise.resolve().then(r.bind(r,2290))},2566:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(9224).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},508:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(9224).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},2290:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5344),a=r(3729),n=r(8428),l=r(6506),i=r(2566),o=r(9224);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,o.Z)("FileCheck",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),c=(0,o.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var u=r(508),p=r(5750),x=r(8704);function m(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)(null),[o,m]=(0,a.useState)([]),[g,h]=(0,a.useState)(!0),[f,b]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[w,j]=(0,a.useState)(null),[N,_]=(0,a.useState)(""),[P,k]=(0,a.useState)(0),[S,q]=(0,a.useState)(null),[C,A]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{let t=await (0,p.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}r(t);let{data:s}=await x.O.from("projects").select("id").eq("provider_id",t.id),a=(s||[]).map(e=>e.id);if(0===a.length){h(!1);return}let{data:n,error:l}=await x.O.from("bookings").select("id, campaign_id, farmer_id, area_10r, work_status").in("campaign_id",a).eq("work_status","pending").neq("status","canceled");if(l){y("申込一覧の取得に失敗しました"),h(!1);return}let i=n||[];if(i.length>0){let{data:e}=await x.O.from("projects").select("id, campaign_title, location, final_unit_price, base_price").in("id",[...new Set(i.map(e=>e.campaign_id))]),t=new Map((e||[]).map(e=>[e.id,e]));i.forEach(e=>{e.projects=t.get(e.campaign_id)})}m(i),i.length>0&&!N&&(_(i[0].id),k(Number(i[0].area_10r)||0)),h(!1)})()},[e]);let Z=async e=>{if(e.preventDefault(),y(null),j(null),!N||P<=0){y("申込を選択し、実績面積を入力してください");return}b(!0);try{let e,t;S&&(t=S.type||"image/jpeg",e=await new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{let t=r.result,s=t.indexOf(",")>=0?t.split(",")[1]:t;e(s||"")},r.onerror=t,r.readAsDataURL(S)}));let r=await fetch("/api/provider/reports/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:N,actualArea10r:Number(P),imageBase64:e,mimeType:t,gps:C??void 0})}),s=await r.json();if(!r.ok){y(s.message||"登録に失敗しました");return}j(`実績を報告しました。確定金額: \xa5${(s.finalAmount??0).toLocaleString()}`),m(e=>e.filter(e=>e.id!==N)),_(""),k(0),q(null),A(null)}catch(e){y("送信に失敗しました")}finally{b(!1)}};return g?s.jsx("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):s.jsx("main",{className:"min-h-screen bg-slate-50",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,s.jsxs)(l.default,{href:"/admin/campaigns",className:"p-2 rounded-lg border border-slate-200 hover:bg-white flex items-center gap-2 text-slate-600",children:[s.jsx(i.Z,{className:"w-5 h-5"}),"戻る"]}),(0,s.jsxs)("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[s.jsx(d,{className:"w-7 h-7 text-green-600"}),"実績報告"]})]}),0===o.length?(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center text-slate-600",children:[s.jsx("p",{children:"報告可能な申込（作業未完了）がありません。"}),s.jsx(l.default,{href:"/admin/campaigns",className:"mt-4 inline-block text-green-600 font-medium hover:underline",children:"案件一覧へ"})]}):(0,s.jsxs)("form",{onSubmit:Z,className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[v&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm font-medium",children:v}),w&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm font-medium",children:w}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"対象申込"}),(0,s.jsxs)("select",{value:N,onChange:e=>{_(e.target.value);let t=o.find(t=>t.id===e.target.value);t&&k(Number(t.area_10r)||0)},className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-green-500",required:!0,children:[s.jsx("option",{value:"",children:"選択してください"}),o.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.projects?.location??e.campaign_id," — 申込ID: ",e.id,"（",e.area_10r," 反）"]},e.id))]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"実績面積（反）"}),s.jsx("input",{type:"number",step:"0.01",min:"0",value:P||"",onChange:e=>k(Number(e.target.value)||0),className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-green-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-bold text-slate-700 mb-2 flex items-center gap-2",children:[s.jsx(c,{className:"w-4 h-4"}),"証跡写真（任意）"]}),s.jsx("input",{type:"file",accept:"image/*",onChange:e=>q(e.target.files?.[0]??null),className:"w-full text-sm text-slate-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-green-50 file:text-green-700"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-bold text-slate-700 mb-2 flex items-center gap-2",children:[s.jsx(u.Z,{className:"w-4 h-4"}),"GPS（任意）"]}),s.jsx("button",{type:"button",onClick:()=>{if(!navigator.geolocation){y("お使いの環境ではGPSを利用できません");return}navigator.geolocation.getCurrentPosition(e=>A({lat:e.coords.latitude,lng:e.coords.longitude}),()=>y("位置情報の取得に失敗しました"))},className:"px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium text-slate-700",children:"現在地を取得"}),C&&(0,s.jsxs)("p",{className:"mt-2 text-xs text-slate-500",children:[C.lat.toFixed(6),", ",C.lng.toFixed(6)]})]})]}),s.jsx("div",{className:"px-6 py-4 bg-slate-50 border-t border-slate-200",children:s.jsx("button",{type:"submit",disabled:f,className:"w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"送信中...":"実績を報告する"})})]})]})})}},2041:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(5344),a=r(3729),n=r(6506),l=r(8428),i=r(2273),o=r(1917),d=r(9895),c=r(8120),u=r(5750);function p(){var e;let t=(0,l.usePathname)(),[r,p]=(0,a.useState)(null),[x,m]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(0,u.ts)().then(p).finally(()=>m(!1))},[]);let g=async()=>{await (0,u.w7)()},h="/login"===t;return s.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center",children:[(0,s.jsxs)(n.default,{href:"/",className:"text-xl font-black text-slate-800 tracking-tight hover:text-green-600 transition-colors",children:[s.jsx("span",{className:"text-green-600",children:"\uD83C\uDF3E"})," Wayfinder AgriX"]}),s.jsx("nav",{className:"flex items-center gap-3",children:x?s.jsx("span",{className:"text-slate-400 text-sm",children:"..."}):r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.default,{href:"admin"===(e=r.role)||"provider"===e?"/admin":"/",className:"text-sm font-bold text-slate-700 hover:text-green-600 transition-colors px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-1",children:[s.jsx(i.Z,{className:"w-4 h-4"}),"マイページ"]}),("admin"===r.role||"provider"===r.role)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.default,{href:"/admin/masters",className:"text-sm font-bold text-slate-700 hover:text-green-600 transition-colors px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-1",children:[s.jsx(o.Z,{className:"w-4 h-4"}),"マスタ"]}),(0,s.jsxs)(n.default,{href:"/admin/users",className:"text-sm font-bold text-slate-700 hover:text-green-600 transition-colors px-3 py-2 rounded-lg hover:bg-slate-50 flex items-center gap-1",children:[s.jsx(d.Z,{className:"w-4 h-4"}),"ユーザー"]})]}),(0,s.jsxs)("button",{type:"button",onClick:g,className:"text-sm font-bold text-slate-700 hover:text-red-600 transition-colors px-3 py-2 rounded-lg hover:bg-red-50 border border-slate-200 hover:border-red-200 flex items-center gap-1",children:[s.jsx(c.Z,{className:"w-4 h-4"}),"ログアウト"]})]}):s.jsx(n.default,{href:h?"/":"/login",className:"text-sm font-bold text-white bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg transition-colors",children:h?"トップへ":"ログイン"})})]})})}},5750:(e,t,r)=>{"use strict";r.d(t,{ts:()=>a,w7:()=>n});var s=r(8704);async function a(){try{let{data:{session:e}}=await s.O.auth.getSession();if(!e)return null;let{data:t,error:r}=await s.O.from("users").select("*").eq("email",e.user.email).single();if(r||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function n(){await s.O.auth.signOut(),window.location.href="/login"}},8704:(e,t,r)=>{"use strict";r.d(t,{O:()=>s});let s=(0,r(3974).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")},7858:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m,metadata:()=>x});var s=r(5036),a=r(3740),n=r.n(a),l=r(4070),i=r.n(l);r(5023);let o=(0,r(6843).createProxy)(String.raw`C:\Users\yusuk\Documents\wwx\Wayfinder AgriX\v3-app\src\components\Header.tsx`),{__esModule:d,$$typeof:c}=o,u=o.default;var p=r(7171);let x={title:"Wayfinder AgriX - ドローンあいのり予約",description:"農家と業者をつなぐ農作業予約プラットフォーム"};function m({children:e}){return s.jsx("html",{lang:"ja",children:(0,s.jsxs)("body",{className:`${n().variable} ${i().variable} antialiased`,children:[s.jsx(u,{}),e,s.jsx(p.x7,{position:"top-center",richColors:!0,closeButton:!0})]})})}},4107:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>l});let s=(0,r(6843).createProxy)(String.raw`C:\Users\yusuk\Documents\wwx\Wayfinder AgriX\v3-app\src\app\provider\reports\new\page.tsx`),{__esModule:a,$$typeof:n}=s,l=s.default},3881:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(337);let a=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},5023:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,916,337],()=>r(2309));module.exports=s})();