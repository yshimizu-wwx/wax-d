{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yusuk/Documents/wwx/Wayfinder%20AgriX/v3-app/src/lib/calculator/priceCalculator.ts"],"sourcesContent":["/**\n * ÈÄÜ„Ç™„Éº„ÇØ„Ç∑„Éß„É≥ÊñπÂºè„ÅÆÂçò‰æ°Ë®àÁÆó„É≠„Ç∏„ÉÉ„ÇØ\n *\n * GASÁâà„ÅÆ Calculator.js:23 - calculateCurrentUnitPrice „ÅÆÂÆåÂÖ®ÁßªÊ§ç\n * ÂèÇÁÖß: current_system_spec.md:295-358\n */\n\nimport type {\n  CampaignPricing,\n  PriceCalculationResult,\n  AmountCalculation,\n  ApplicationAreaValidation,\n} from './types';\n\n/**\n * ÈÄÜ„Ç™„Éº„ÇØ„Ç∑„Éß„É≥ÊñπÂºè„ÅÆÂçò‰æ°„ÇíË®àÁÆó\n *\n * @param pricing - Ê°à‰ª∂„ÅÆ‰æ°Ê†ºË®≠ÂÆö\n * @param totalArea10r - ÁèæÂú®„ÅÆÁî≥ËæºÂêàË®àÈù¢Á©çÔºà10RÂçò‰ΩçÔºâ\n * @returns Ë®àÁÆóÁµêÊûú\n *\n * @example\n * // „Éë„Çø„Éº„É≥A: ÊúÄ‰ΩéÊàêÁ´ãÈù¢Á©ç„Åå„ÅÇ„ÇãÂ†¥Âêà\n * const result = calculateCurrentUnitPrice(\n *   {\n *     base_price: 20000,\n *     min_price: 15000,\n *     target_area_10r: 50,\n *     min_target_area_10r: 30,\n *     max_target_area_10r: 50,\n *     execution_price: 18000\n *   },\n *   40\n * );\n * // => { currentPrice: 16500, progress: 0.5, isUnformed: false, ... }\n *\n * @example\n * // „Éë„Çø„Éº„É≥B: ÂæìÊù•„ÅÆÁ∑öÂΩ¢ÊñπÂºè\n * const result = calculateCurrentUnitPrice(\n *   {\n *     base_price: 20000,\n *     min_price: 15000,\n *     target_area_10r: 50\n *   },\n *   25\n * );\n * // => { currentPrice: 17500, progress: 0.5, isUnformed: false, ... }\n */\nexport function calculateCurrentUnitPrice(\n  pricing: CampaignPricing,\n  totalArea10r: number\n): PriceCalculationResult {\n  const {\n    base_price,\n    min_price,\n    target_area_10r,\n    min_target_area_10r = 0,\n    max_target_area_10r,\n    execution_price,\n  } = pricing;\n\n  // ÂÖ•ÂäõÂÄ§„ÅÆÊ§úË®º\n  if (base_price < min_price) {\n    throw new Error('ÈñãÂßãÂçò‰æ°„ÅØÁõÆÊ®ôÂçò‰æ°‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');\n  }\n\n  if (totalArea10r < 0) {\n    throw new Error('Áî≥ËæºÂêàË®àÈù¢Á©ç„ÅØ0‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');\n  }\n\n  // „Éë„Çø„Éº„É≥A: ÊúÄ‰ΩéÊàêÁ´ãÈù¢Á©ç„Åå„ÅÇ„ÇãÂ†¥Âêà\n  if (\n    min_target_area_10r > 0 &&\n    max_target_area_10r &&\n    max_target_area_10r > 0 &&\n    execution_price\n  ) {\n    return calculateWithMinimumArea(\n      pricing as Required<CampaignPricing>,\n      totalArea10r\n    );\n  }\n\n  // „Éë„Çø„Éº„É≥B: ÂæìÊù•„ÅÆÁ∑öÂΩ¢ÊñπÂºè\n  return calculateLinearPrice(pricing, totalArea10r);\n}\n\n/**\n * „Éë„Çø„Éº„É≥A: ÊúÄ‰ΩéÊàêÁ´ãÈù¢Á©ç„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆË®àÁÆó\n * @private\n */\nfunction calculateWithMinimumArea(\n  pricing: Required<CampaignPricing>,\n  totalArea10r: number\n): PriceCalculationResult {\n  const {\n    base_price,\n    min_price,\n    min_target_area_10r,\n    max_target_area_10r,\n    execution_price,\n  } = pricing;\n\n  // „Ç±„Éº„Çπ1: ÊúÄ‰ΩéÊàêÁ´ãÈù¢Á©çÊú™ÈÅî\n  if (totalArea10r < min_target_area_10r) {\n    const progress = totalArea10r / min_target_area_10r;\n    const remainingArea = min_target_area_10r - totalArea10r;\n\n    return {\n      currentPrice: null,\n      progress,\n      isUnformed: true,\n      priceReduction: 0,\n      remainingArea,\n      nextMilestoneArea: remainingArea, // ÊúÄ‰ΩéÊàêÁ´ã„Åæ„Åß„ÅÆÊÆã„ÇäÈù¢Á©ç\n    };\n  }\n\n  // „Ç±„Éº„Çπ2: Ê∫ÄÈ°ç„É©„Ç§„É≥ÈÅîÊàê\n  if (totalArea10r >= max_target_area_10r) {\n    return {\n      currentPrice: Math.round(min_price),\n      progress: 1.0,\n      isUnformed: false,\n      priceReduction: base_price - min_price,\n      remainingArea: 0,\n      nextMilestoneArea: 0,\n    };\n  }\n\n  // „Ç±„Éº„Çπ3: ÊúÄ‰ΩéÊàêÁ´ã„ÄúÊ∫ÄÈ°ç„É©„Ç§„É≥„ÅÆÈñìÔºàÁ∑öÂΩ¢Â§âÂãïÔºâ\n  const progressRange = max_target_area_10r - min_target_area_10r;\n  const currentRange = totalArea10r - min_target_area_10r;\n  const progress = currentRange / progressRange;\n\n  const priceRange = min_price - execution_price;\n  const currentPrice = execution_price + priceRange * progress;\n  const remainingArea = max_target_area_10r - totalArea10r;\n\n  return {\n    currentPrice: Math.round(currentPrice),\n    progress,\n    isUnformed: false,\n    priceReduction: base_price - currentPrice,\n    remainingArea,\n    nextMilestoneArea: remainingArea, // Ê∫ÄÈ°ç„É©„Ç§„É≥„Åæ„Åß„ÅÆÊÆã„ÇäÈù¢Á©ç\n  };\n}\n\n/**\n * „Éë„Çø„Éº„É≥B: ÂæìÊù•„ÅÆÁ∑öÂΩ¢ÊñπÂºè„ÅÆË®àÁÆó\n * @private\n */\nfunction calculateLinearPrice(\n  pricing: CampaignPricing,\n  totalArea10r: number\n): PriceCalculationResult {\n  const { base_price, min_price, target_area_10r } = pricing;\n\n  const progress = Math.min(totalArea10r / target_area_10r, 1.0);\n  const priceRange = base_price - min_price;\n  const currentPrice = base_price - priceRange * progress;\n  const remainingArea = Math.max(0, target_area_10r - totalArea10r);\n\n  return {\n    currentPrice: Math.round(currentPrice),\n    progress,\n    isUnformed: false,\n    priceReduction: base_price - currentPrice,\n    remainingArea,\n    nextMilestoneArea: remainingArea > 0 ? remainingArea : undefined,\n  };\n}\n\n/**\n * Á¢∫ÂÆöÈáëÈ°ç„ÇíË®àÁÆóÔºàÁ®éÊäúÔºâ\n *\n * @param unitPrice - Âçò‰æ°ÔºàÂÜÜ/10RÔºâ\n * @param actualArea10r - ÂÆüÁ∏æÈù¢Á©çÔºà10RÂçò‰ΩçÔºâ\n * @returns Á¢∫ÂÆöÈáëÈ°çÔºàÂÜÜ„ÄÅÁ®éÊäúÔºâ\n *\n * @example\n * calculateFinalAmount(15000, 5); // => 75000\n */\nexport function calculateFinalAmount(\n  unitPrice: number,\n  actualArea10r: number\n): number {\n  if (unitPrice < 0 || actualArea10r < 0) {\n    throw new Error('Âçò‰æ°„Å®ÂÆüÁ∏æÈù¢Á©ç„ÅØ0‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');\n  }\n\n  return Math.round(unitPrice * actualArea10r);\n}\n\n/**\n * Ê∂àË≤ªÁ®é„ÇíË®àÁÆó\n *\n * @param amountExTax - Á®éÊäúÈáëÈ°çÔºàÂÜÜÔºâ\n * @param taxRate - Ê∂àË≤ªÁ®éÁéáÔºà%„ÄÅ„Éá„Éï„Ç©„É´„Éà10%Ôºâ\n * @returns Á®éË®àÁÆóÁµêÊûú\n *\n * @example\n * calculateTax(10000); // => { amountExTax: 10000, taxAmount: 1000, amountInclusive: 11000, taxRate: 10 }\n */\nexport function calculateTax(\n  amountExTax: number,\n  taxRate: number = 10\n): AmountCalculation {\n  if (amountExTax < 0) {\n    throw new Error('Á®éÊäúÈáëÈ°ç„ÅØ0‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');\n  }\n\n  if (taxRate < 0 || taxRate > 100) {\n    throw new Error('Ê∂àË≤ªÁ®éÁéá„ÅØ0„Äú100%„ÅÆÁØÑÂõ≤„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô');\n  }\n\n  const taxAmount = Math.round(amountExTax * (taxRate / 100));\n  const amountInclusive = amountExTax + taxAmount;\n\n  return {\n    amountExTax,\n    taxAmount,\n    amountInclusive,\n    taxRate,\n  };\n}\n\n/**\n * Áî≥ËæºÈù¢Á©ç„ÅåÊÆã„ÇäÈù¢Á©çÂÜÖ„Å´Âèé„Åæ„Çã„ÅãÊ§úË®º\n *\n * @param requestedArea10r - Áî≥ËæºÂ∏åÊúõÈù¢Á©çÔºà10RÂçò‰ΩçÔºâ\n * @param currentTotalArea10r - ÁèæÂú®„ÅÆÁî≥ËæºÂêàË®àÈù¢Á©çÔºà10RÂçò‰ΩçÔºâ\n * @param maxArea10r - Ê∫ÄÈ°ç„É©„Ç§„É≥Èù¢Á©çÔºà10RÂçò‰ΩçÔºâ\n * @returns Ê§úË®ºÁµêÊûú\n *\n * @example\n * validateApplicationArea(10, 40, 50);\n * // => { isValid: true, currentTotalArea: 40, remainingArea: 10, maxArea: 50 }\n *\n * validateApplicationArea(20, 40, 50);\n * // => { isValid: false, errorMessage: 'Áî≥„ÅóËæº„ÅøÈù¢Á©ç„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô...', ... }\n */\nexport function validateApplicationArea(\n  requestedArea10r: number,\n  currentTotalArea10r: number,\n  maxArea10r: number\n): ApplicationAreaValidation {\n  if (requestedArea10r <= 0) {\n    return {\n      isValid: false,\n      errorMessage: 'Áî≥ËæºÈù¢Á©ç„ÅØ1Âèç‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô',\n      currentTotalArea: currentTotalArea10r,\n      remainingArea: maxArea10r - currentTotalArea10r,\n      maxArea: maxArea10r,\n    };\n  }\n\n  const remainingArea = maxArea10r - currentTotalArea10r;\n\n  if (requestedArea10r > remainingArea) {\n    return {\n      isValid: false,\n      errorMessage: `Áî≥„ÅóËæº„ÅøÈù¢Á©ç„Åå‰∏äÈôê„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÆã„Çä ${remainingArea.toFixed(\n        1\n      )} Âèç„Åæ„Åß‰∫àÁ¥ÑÂèØËÉΩ„Åß„Åô„ÄÇ`,\n      currentTotalArea: currentTotalArea10r,\n      remainingArea,\n      maxArea: maxArea10r,\n    };\n  }\n\n  return {\n    isValid: true,\n    currentTotalArea: currentTotalArea10r,\n    remainingArea,\n    maxArea: maxArea10r,\n  };\n}\n\n/**\n * Ê¨°„ÅÆÂçò‰æ°Â§âÂãï„Éû„Ç§„É´„Çπ„Éà„Éº„É≥„Åæ„Åß„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó\n *\n * @param pricing - Ê°à‰ª∂„ÅÆ‰æ°Ê†ºË®≠ÂÆö\n * @param totalArea10r - ÁèæÂú®„ÅÆÁî≥ËæºÂêàË®àÈù¢Á©çÔºà10RÂçò‰ΩçÔºâ\n * @returns „Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÊÉÖÂ†±\n */\nexport function getNextPriceMilestone(\n  pricing: CampaignPricing,\n  totalArea10r: number\n): {\n  nextMilestoneArea: number | null;\n  nextPrice: number | null;\n  description: string;\n} {\n  const {\n    min_price,\n    min_target_area_10r = 0,\n    max_target_area_10r,\n    execution_price,\n  } = pricing;\n\n  // „Éë„Çø„Éº„É≥A: ÊúÄ‰ΩéÊàêÁ´ãÈù¢Á©ç„Åå„ÅÇ„ÇãÂ†¥Âêà\n  if (\n    min_target_area_10r > 0 &&\n    max_target_area_10r &&\n    execution_price\n  ) {\n    if (totalArea10r < min_target_area_10r) {\n      return {\n        nextMilestoneArea: min_target_area_10r,\n        nextPrice: execution_price,\n        description: 'ÊúÄ‰ΩéÊàêÁ´ãÈù¢Á©çÈÅîÊàê„ÅßÊàêÁ´ãÊôÇÂçò‰æ°„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô',\n      };\n    }\n\n    if (totalArea10r < max_target_area_10r) {\n      return {\n        nextMilestoneArea: max_target_area_10r,\n        nextPrice: min_price,\n        description: 'Ê∫ÄÈ°ç„É©„Ç§„É≥ÈÅîÊàê„ÅßÁõÆÊ®ôÂçò‰æ°„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô',\n      };\n    }\n\n    return {\n      nextMilestoneArea: null,\n      nextPrice: null,\n      description: 'Ê∫ÄÈ°ç„É©„Ç§„É≥ÈÅîÊàêÊ∏à„Åø',\n    };\n  }\n\n  // „Éë„Çø„Éº„É≥B: ÂæìÊù•„ÅÆÁ∑öÂΩ¢ÊñπÂºè\n  const { target_area_10r } = pricing;\n\n  if (totalArea10r < target_area_10r) {\n    return {\n      nextMilestoneArea: target_area_10r,\n      nextPrice: min_price,\n      description: 'ÁõÆÊ®ôÈù¢Á©çÈÅîÊàê„ÅßÁõÆÊ®ôÂçò‰æ°„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô',\n    };\n  }\n\n  return {\n    nextMilestoneArea: null,\n    nextPrice: null,\n    description: 'ÁõÆÊ®ôÈù¢Á©çÈÅîÊàêÊ∏à„Åø',\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yusuk/Documents/wwx/Wayfinder%20AgriX/v3-app/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n"],"names":[],"mappings":";;;;AAEoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,iMAAY,EAAC,aAAa"}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yusuk/Documents/wwx/Wayfinder%20AgriX/v3-app/src/lib/geo/areaCalculator.ts"],"sourcesContent":["/**\n * Âú∞Âõ≥„ÉªÈù¢Á©çË®àÁÆó„É≠„Ç∏„ÉÉ„ÇØ\n *\n * Turf.js„Çí‰ΩøÁî®„Åó„Å¶„Éù„É™„Ç¥„É≥„ÅÆÈù¢Á©ç„Çí„ÄåÂèçÔºà10RÔºâ„ÄçÂçò‰Ωç„ÅßË®àÁÆó\n */\n\nimport * as turf from '@turf/turf';\nimport type { Polygon, Position } from 'geojson';\n\n/**\n * Èù¢Á©çÂçò‰Ωç„ÅÆÂÆöÊï∞\n */\nexport const AREA_CONSTANTS = {\n  /** 1Âù™ = 3.305785„é° */\n  TSUBO_TO_SQUARE_METER: 3.305785,\n\n  /** 1Âèç = 300Âù™ */\n  TAN_TO_TSUBO: 300,\n\n  /** 1Âèç = 991.7355„é° */\n  TAN_TO_SQUARE_METER: 991.7355,\n\n  /** 1„Éò„ÇØ„Çø„Éº„É´ = 10Âèç */\n  HECTARE_TO_TAN: 10,\n} as const;\n\n/**\n * „Éù„É™„Ç¥„É≥„ÅÆÈù¢Á©ç„Çí„ÄåÂèçÔºà10RÔºâ„ÄçÂçò‰Ωç„ÅßË®àÁÆó\n *\n * @param polygon - GeoJSONÂΩ¢Âºè„ÅÆ„Éù„É™„Ç¥„É≥\n * @returns Èù¢Á©çÔºàÂèçÂçò‰Ωç„ÄÅÂ∞èÊï∞ÁÇπÁ¨¨2‰Ωç„Åæ„ÅßÔºâ\n *\n * @example\n * const polygon = {\n *   type: 'Polygon',\n *   coordinates: [[\n *     [139.6917, 35.6895],\n *     [139.7017, 35.6895],\n *     [139.7017, 35.6995],\n *     [139.6917, 35.6995],\n *     [139.6917, 35.6895]\n *   ]]\n * };\n * const area = calculatePolygonArea10r(polygon);\n * // => Á¥Ñ100.5ÔºàÂèçÔºâ\n */\nexport function calculatePolygonArea10r(polygon: Polygon): number {\n  // Turf.js„ÅßÈù¢Á©ç„ÇíÂπ≥Êñπ„É°„Éº„Éà„É´„ÅßË®àÁÆóÔºàÊ∏¨Âú∞Á∑öË®àÁÆóÔºâ\n  const areaInSquareMeters = turf.area(polygon);\n\n  // 1Âèç = 991.7355„é° „ÅßÊèõÁÆó\n  const area10r = areaInSquareMeters / AREA_CONSTANTS.TAN_TO_SQUARE_METER;\n\n  // Â∞èÊï∞ÁÇπÁ¨¨2‰Ωç„ÅßÂõõÊç®‰∫îÂÖ•\n  return Math.round(area10r * 100) / 100;\n}\n\n/**\n * Â∫ßÊ®ôÈÖçÂàó„Åã„ÇâGeoJSON Polygon„ÇíÁîüÊàê\n *\n * @param coordinates - Â∫ßÊ®ôÈÖçÂàó [[lng, lat], ...]\n * @returns GeoJSON Polygon\n *\n * @example\n * const coords = [\n *   [139.6917, 35.6895],\n *   [139.7017, 35.6895],\n *   [139.7017, 35.6995],\n *   [139.6917, 35.6995]\n * ];\n * const polygon = coordinatesToPolygon(coords);\n */\nexport function coordinatesToPolygon(coordinates: Position[]): Polygon {\n  // ÂßãÁÇπ„Å®ÁµÇÁÇπ„Çí‰∏ÄËá¥„Åï„Åõ„ÇãÔºàGeoJSON‰ªïÊßòÔºâ\n  const coords = [...coordinates];\n\n  // Êó¢„Å´Èñâ„Åò„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Åù„ÅÆ„Åæ„ÅæËøî„Åô\n  const isClosed =\n    coords.length >= 4 &&\n    coords[0][0] === coords[coords.length - 1][0] &&\n    coords[0][1] === coords[coords.length - 1][1];\n\n  if (!isClosed) {\n    coords.push(coords[0]);\n  }\n\n  return {\n    type: 'Polygon',\n    coordinates: [coords],\n  };\n}\n\n/**\n * Leaflet.draw„ÅÆ„É¨„Ç§„É§„Éº„Åã„ÇâGeoJSON Polygon„ÇíÁîüÊàê\n *\n * @param layer - Leaflet.draw„ÅÆ„É¨„Ç§„É§„Éº„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà\n * @returns GeoJSON Polygon\n *\n * @example\n * // Leaflet.draw„ÅÆcreated„Ç§„Éô„É≥„Éà„ÅßÂèñÂæó„Åó„Åü„É¨„Ç§„É§„Éº\n * const layer = e.layer;\n * const polygon = leafletLayerToGeoJSON(layer);\n */\nexport function leafletLayerToGeoJSON(layer: any): Polygon {\n  // Leaflet„ÅÆ„É¨„Ç§„É§„Éº„Åã„ÇâÂ∫ßÊ®ô„ÇíÂèñÂæó\n  const latLngs = layer.getLatLngs()[0]; // Â§ñÂë®„ÅÆ„ÅøÂèñÂæó\n\n  // [lng, lat]ÂΩ¢Âºè„Å´Â§âÊèõ\n  const coordinates: Position[] = latLngs.map((latLng: any) => [\n    latLng.lng,\n    latLng.lat,\n  ]);\n\n  return coordinatesToPolygon(coordinates);\n}\n\n/**\n * PostGIS„ÅÆWKTÔºàWell-Known TextÔºâÂΩ¢Âºè„Å´Â§âÊèõ\n *\n * @param polygon - GeoJSON Polygon\n * @returns WKTÂΩ¢Âºè„ÅÆÊñáÂ≠óÂàó\n *\n * @example\n * const wkt = geoJSONToWKT(polygon);\n * // => \"POLYGON((139.6917 35.6895, 139.7017 35.6895, ...))\"\n */\nexport function geoJSONToWKT(polygon: Polygon): string {\n  const coords = polygon.coordinates[0]\n    .map(([lng, lat]) => `${lng} ${lat}`)\n    .join(', ');\n\n  return `POLYGON((${coords}))`;\n}\n\n/**\n * PostGIS„ÅÆWKTÂΩ¢Âºè„Åã„ÇâGeoJSON Polygon„Å´Â§âÊèõ\n *\n * @param wkt - WKTÂΩ¢Âºè„ÅÆÊñáÂ≠óÂàó\n * @returns GeoJSON Polygon\n *\n * @example\n * const polygon = wktToGeoJSON(\"POLYGON((139.6917 35.6895, ...))\");\n */\nexport function wktToGeoJSON(wkt: string): Polygon {\n  // \"POLYGON((...))\" „Åã„ÇâÂ∫ßÊ®ôÈÉ®ÂàÜ„ÇíÊäΩÂá∫\n  const coordsStr = wkt\n    .replace(/^POLYGON\\(\\(/, '')\n    .replace(/\\)\\)$/, '');\n\n  const coordinates: Position[] = coordsStr\n    .split(', ')\n    .map((pair) => {\n      const [lng, lat] = pair.split(' ').map(Number);\n      return [lng, lat];\n    });\n\n  return {\n    type: 'Polygon',\n    coordinates: [coordinates],\n  };\n}\n\n/**\n * 2ÁÇπÈñì„ÅÆË∑ùÈõ¢„ÇíË®àÁÆóÔºàHaversineÂÖ¨ÂºèÔºâ\n *\n * @param point1 - Âú∞ÁÇπ1 [lng, lat]\n * @param point2 - Âú∞ÁÇπ2 [lng, lat]\n * @returns Ë∑ùÈõ¢ÔºàkmÔºâ\n *\n * @example\n * const distance = calculateDistance(\n *   [139.6917, 35.6895],\n *   [139.7017, 35.6995]\n * );\n * // => Á¥Ñ1.4 (km)\n */\nexport function calculateDistance(\n  point1: Position,\n  point2: Position\n): number {\n  const from = turf.point(point1);\n  const to = turf.point(point2);\n\n  // Turf.js„ÅÆdistanceÈñ¢Êï∞Ôºà„Éá„Éï„Ç©„É´„Éà„ÅßkmÂçò‰ΩçÔºâ\n  return turf.distance(from, to, { units: 'kilometers' });\n}\n\n/**\n * „Éù„É™„Ç¥„É≥„ÅÆ‰∏≠ÂøÉÁÇπ„ÇíË®àÁÆó\n *\n * @param polygon - GeoJSON Polygon\n * @returns ‰∏≠ÂøÉÁÇπ [lng, lat]\n *\n * @example\n * const center = getPolygonCenter(polygon);\n * // => [139.6967, 35.6945]\n */\nexport function getPolygonCenter(polygon: Polygon): Position {\n  const center = turf.center(polygon);\n  return center.geometry.coordinates;\n}\n\n/**\n * „Éù„É™„Ç¥„É≥„ÇíÁ∞°Áï•ÂåñÔºàÈ†ÇÁÇπÊï∞„ÇíÂâäÊ∏õÔºâ\n *\n * @param polygon - GeoJSON Polygon\n * @param tolerance - Ë®±ÂÆπË™§Â∑ÆÔºà„Éá„Éï„Ç©„É´„Éà0.0001Ôºâ\n * @returns Á∞°Áï•Âåñ„Åï„Çå„ÅüPolygon\n *\n * @example\n * const simplified = simplifyPolygon(polygon, 0.001);\n */\nexport function simplifyPolygon(\n  polygon: Polygon,\n  tolerance: number = 0.0001\n): Polygon {\n  const feature = turf.feature(polygon);\n  const simplified = turf.simplify(feature, {\n    tolerance,\n    highQuality: true,\n  });\n\n  return simplified.geometry as Polygon;\n}\n\n/**\n * „Éù„É™„Ç¥„É≥„ÅåÊúâÂäπ„Åã„Å©„ÅÜ„Åã„ÇíÊ§úË®º\n *\n * @param polygon - GeoJSON Polygon\n * @returns Ê§úË®ºÁµêÊûú\n *\n * @example\n * const validation = validatePolygon(polygon);\n * if (!validation.isValid) {\n *   console.error(validation.error);\n * }\n */\nexport function validatePolygon(polygon: Polygon): {\n  isValid: boolean;\n  error?: string;\n} {\n  try {\n    // ÊúÄ‰Ωé3ÁÇπÔºà+ ÂßãÁÇπ„ÅÆÈáçË§áÔºâ= 4ÁÇπÂøÖË¶Å\n    if (polygon.coordinates[0].length < 4) {\n      return {\n        isValid: false,\n        error: '„Éù„É™„Ç¥„É≥„Å´„ÅØÊúÄ‰Ωé3ÁÇπ„ÅÆÂ∫ßÊ®ô„ÅåÂøÖË¶Å„Åß„Åô',\n      };\n    }\n\n    // ÂßãÁÇπ„Å®ÁµÇÁÇπ„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Çã„Åã\n    const first = polygon.coordinates[0][0];\n    const last = polygon.coordinates[0][polygon.coordinates[0].length - 1];\n\n    if (first[0] !== last[0] || first[1] !== last[1]) {\n      return {\n        isValid: false,\n        error: 'ÂßãÁÇπ„Å®ÁµÇÁÇπ„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì',\n      };\n    }\n\n    // Ëá™Â∑±‰∫§Â∑Æ„ÉÅ„Çß„ÉÉ„ÇØ\n    const kinks = turf.kinks(polygon);\n    if (kinks.features.length > 0) {\n      return {\n        isValid: false,\n        error: '„Éù„É™„Ç¥„É≥„ÅåËá™Â∑±‰∫§Â∑Æ„Åó„Å¶„ÅÑ„Åæ„Åô',\n      };\n    }\n\n    // Èù¢Á©ç„Åå0„Åß„Å™„ÅÑ„Åã\n    const area = turf.area(polygon);\n    if (area === 0) {\n      return {\n        isValid: false,\n        error: '„Éù„É™„Ç¥„É≥„ÅÆÈù¢Á©ç„Åå0„Åß„Åô',\n      };\n    }\n\n    return { isValid: true };\n  } catch (error) {\n    return {\n      isValid: false,\n      error: error instanceof Error ? error.message : '‰∏çÊòé„Å™„Ç®„É©„Éº',\n    };\n  }\n}\n\n/**\n * Ë§áÊï∞„ÅÆ„Éù„É™„Ç¥„É≥„ÅåÈáçË§á„Åó„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ\n *\n * @param polygon1 - „Éù„É™„Ç¥„É≥1\n * @param polygon2 - „Éù„É™„Ç¥„É≥2\n * @returns ÈáçË§á„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêàtrue\n */\nexport function polygonsOverlap(\n  polygon1: Polygon,\n  polygon2: Polygon\n): boolean {\n  try {\n    const feature1 = turf.polygon(polygon1.coordinates);\n    const feature2 = turf.polygon(polygon2.coordinates);\n\n    const intersection = turf.intersect(feature1, feature2);\n\n    return intersection !== null && intersection !== undefined;\n  } catch {\n    return false;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMO,MAAM,iBAAiB;IAC5B,mBAAmB,GACnB,uBAAuB;IAEvB,cAAc,GACd,cAAc;IAEd,mBAAmB,GACnB,qBAAqB;IAErB,iBAAiB,GACjB,gBAAgB;AAClB;AAsBO,SAAS,wBAAwB,OAAgB;IACtD,8BAA8B;IAC9B,MAAM,qBAAqB,iKAAS,CAAC;IAErC,qBAAqB;IACrB,MAAM,UAAU,qBAAqB,eAAe,mBAAmB;IAEvE,cAAc;IACd,OAAO,KAAK,KAAK,CAAC,UAAU,OAAO;AACrC;AAiBO,SAAS,qBAAqB,WAAuB;IAC1D,yBAAyB;IACzB,MAAM,SAAS;WAAI;KAAY;IAE/B,mBAAmB;IACnB,MAAM,WACJ,OAAO,MAAM,IAAI,KACjB,MAAM,CAAC,EAAE,CAAC,EAAE,KAAK,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,EAAE,IAC7C,MAAM,CAAC,EAAE,CAAC,EAAE,KAAK,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,EAAE;IAE/C,IAAI,CAAC,UAAU;QACb,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE;IACvB;IAEA,OAAO;QACL,MAAM;QACN,aAAa;YAAC;SAAO;IACvB;AACF;AAaO,SAAS,sBAAsB,KAAU;IAC9C,sBAAsB;IACtB,MAAM,UAAU,MAAM,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS;IAEhD,kBAAkB;IAClB,MAAM,cAA0B,QAAQ,GAAG,CAAC,CAAC,SAAgB;YAC3D,OAAO,GAAG;YACV,OAAO,GAAG;SACX;IAED,OAAO,qBAAqB;AAC9B;AAYO,SAAS,aAAa,OAAgB;IAC3C,MAAM,SAAS,QAAQ,WAAW,CAAC,EAAE,CAClC,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,GAAK,GAAG,IAAI,CAAC,EAAE,KAAK,EACnC,IAAI,CAAC;IAER,OAAO,CAAC,SAAS,EAAE,OAAO,EAAE,CAAC;AAC/B;AAWO,SAAS,aAAa,GAAW;IACtC,6BAA6B;IAC7B,MAAM,YAAY,IACf,OAAO,CAAC,gBAAgB,IACxB,OAAO,CAAC,SAAS;IAEpB,MAAM,cAA0B,UAC7B,KAAK,CAAC,MACN,GAAG,CAAC,CAAC;QACJ,MAAM,CAAC,KAAK,IAAI,GAAG,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC;QACvC,OAAO;YAAC;YAAK;SAAI;IACnB;IAEF,OAAO;QACL,MAAM;QACN,aAAa;YAAC;SAAY;IAC5B;AACF;AAgBO,SAAS,kBACd,MAAgB,EAChB,MAAgB;IAEhB,MAAM,OAAO,qKAAU,CAAC;IACxB,MAAM,KAAK,qKAAU,CAAC;IAEtB,iCAAiC;IACjC,OAAO,yKAAa,CAAC,MAAM,IAAI;QAAE,OAAO;IAAa;AACvD;AAYO,SAAS,iBAAiB,OAAgB;IAC/C,MAAM,SAAS,qKAAW,CAAC;IAC3B,OAAO,OAAO,QAAQ,CAAC,WAAW;AACpC;AAYO,SAAS,gBACd,OAAgB,EAChB,YAAoB,MAAM;IAE1B,MAAM,UAAU,uKAAY,CAAC;IAC7B,MAAM,aAAa,yKAAa,CAAC,SAAS;QACxC;QACA,aAAa;IACf;IAEA,OAAO,WAAW,QAAQ;AAC5B;AAcO,SAAS,gBAAgB,OAAgB;IAI9C,IAAI;QACF,sBAAsB;QACtB,IAAI,QAAQ,WAAW,CAAC,EAAE,CAAC,MAAM,GAAG,GAAG;YACrC,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,gBAAgB;QAChB,MAAM,QAAQ,QAAQ,WAAW,CAAC,EAAE,CAAC,EAAE;QACvC,MAAM,OAAO,QAAQ,WAAW,CAAC,EAAE,CAAC,QAAQ,WAAW,CAAC,EAAE,CAAC,MAAM,GAAG,EAAE;QAEtE,IAAI,KAAK,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,IAAI,KAAK,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,EAAE;YAChD,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,WAAW;QACX,MAAM,QAAQ,mKAAU,CAAC;QACzB,IAAI,MAAM,QAAQ,CAAC,MAAM,GAAG,GAAG;YAC7B,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,WAAW;QACX,MAAM,OAAO,iKAAS,CAAC;QACvB,IAAI,SAAS,GAAG;YACd,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;YACL,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD;IACF;AACF;AASO,SAAS,gBACd,QAAiB,EACjB,QAAiB;IAEjB,IAAI;QACF,MAAM,WAAW,uKAAY,CAAC,SAAS,WAAW;QAClD,MAAM,WAAW,uKAAY,CAAC,SAAS,WAAW;QAElD,MAAM,eAAe,2KAAc,CAAC,UAAU;QAE9C,OAAO,iBAAiB,QAAQ,iBAAiB;IACnD,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 391, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yusuk/Documents/wwx/Wayfinder%20AgriX/v3-app/src/lib/api.ts"],"sourcesContent":["import { supabase } from '@/lib/supabase'\r\nimport { Project } from '@/types/database'\r\nimport type { Polygon } from 'geojson'\r\nimport { geoJSONToWKT } from '@/lib/geo/areaCalculator'\r\n\r\nexport async function fetchProjects(): Promise<Project[]> {\r\n    const { data, error } = await supabase\r\n        .from('projects')\r\n        .select('*')\r\n        .eq('status', 'open')\r\n        .order('created_at', { ascending: false })\r\n\r\n    if (error) {\r\n        console.error('Error fetching projects:', error)\r\n        return []\r\n    }\r\n\r\n    return data as Project[] || []\r\n}\r\n\r\n/**\r\n * Fetch the currently active project/campaign\r\n * Looks for projects with status='open' and is_closed=false\r\n */\r\nexport async function fetchActiveProject(): Promise<Project | null> {\r\n    const { data, error } = await supabase\r\n        .from('projects')\r\n        .select('*')\r\n        .eq('status', 'open')\r\n        .eq('is_closed', false)\r\n        .order('created_at', { ascending: false })\r\n        .limit(1)\r\n        .single()\r\n\r\n    if (error) {\r\n        // No active project found is not necessarily an error\r\n        if (error.code === 'PGRST116') {\r\n            console.log('No active project found')\r\n            return null\r\n        }\r\n        console.error('Error fetching active project:', error)\r\n        return null\r\n    }\r\n\r\n    return data as Project\r\n}\r\n\r\n/**\r\n * Fetch total applied area for a campaign\r\n */\r\nexport async function fetchCampaignTotalArea(campaignId: string): Promise<number> {\r\n    const { data, error } = await supabase\r\n        .from('bookings')\r\n        .select('area_10r')\r\n        .eq('campaign_id', campaignId)\r\n        .neq('status', 'canceled')\r\n\r\n    if (error) {\r\n        console.error('Error fetching campaign total area:', error)\r\n        return 0\r\n    }\r\n\r\n    const total = data?.reduce((sum, booking) => sum + (booking.area_10r || 0), 0) || 0\r\n    return total\r\n}\r\n\r\nexport interface BookingData {\r\n    campaign_id: string\r\n    farmer_name: string\r\n    phone: string\r\n    email: string\r\n    desired_start_date: string\r\n    desired_end_date: string\r\n    field_polygon: Polygon\r\n    area_10r: number\r\n    locked_price: number\r\n}\r\n\r\n/**\r\n * Create a new booking/reservation\r\n */\r\nexport async function createBooking(bookingData: BookingData): Promise<{ success: boolean; error?: string; bookingId?: string }> {\r\n    try {\r\n        // Convert GeoJSON polygon to WKT for PostGIS\r\n        const polygonWKT = geoJSONToWKT(bookingData.field_polygon)\r\n\r\n        // Generate a unique ID (you might want to use UUID here)\r\n        const bookingId = `BK_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n\r\n        const { data, error } = await supabase\r\n            .from('bookings')\r\n            .insert({\r\n                id: bookingId,\r\n                campaign_id: bookingData.campaign_id,\r\n                farmer_name: bookingData.farmer_name,\r\n                phone: bookingData.phone,\r\n                email: bookingData.email,\r\n                desired_start_date: bookingData.desired_start_date,\r\n                desired_end_date: bookingData.desired_end_date,\r\n                field_polygon: polygonWKT,\r\n                area_10r: bookingData.area_10r,\r\n                locked_price: bookingData.locked_price,\r\n                status: 'pending',\r\n                applied_at: new Date().toISOString(),\r\n            })\r\n            .select('id')\r\n            .single()\r\n\r\n        if (error) {\r\n            console.error('Error creating booking:', error)\r\n            return { success: false, error: error.message }\r\n        }\r\n\r\n        return { success: true, bookingId: data?.id || bookingId }\r\n    } catch (error) {\r\n        console.error('Unexpected error creating booking:', error)\r\n        return {\r\n            success: false,\r\n            error: error instanceof Error ? error.message : 'Unknown error occurred'\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAGA;;;AAEO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,qIAAQ,CACjC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAU,QACb,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;IAE5C,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,EAAE;IACb;IAEA,OAAO,QAAqB,EAAE;AAClC;AAMO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,qIAAQ,CACjC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,UAAU,QACb,EAAE,CAAC,aAAa,OAChB,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC,GACN,MAAM;IAEX,IAAI,OAAO;QACP,sDAAsD;QACtD,IAAI,MAAM,IAAI,KAAK,YAAY;YAC3B,QAAQ,GAAG,CAAC;YACZ,OAAO;QACX;QACA,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;IACX;IAEA,OAAO;AACX;AAKO,eAAe,uBAAuB,UAAkB;IAC3D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,qIAAQ,CACjC,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,eAAe,YAClB,GAAG,CAAC,UAAU;IAEnB,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO;IACX;IAEA,MAAM,QAAQ,MAAM,OAAO,CAAC,KAAK,UAAY,MAAM,CAAC,QAAQ,QAAQ,IAAI,CAAC,GAAG,MAAM;IAClF,OAAO;AACX;AAiBO,eAAe,cAAc,WAAwB;IACxD,IAAI;QACA,6CAA6C;QAC7C,MAAM,aAAa,IAAA,sJAAY,EAAC,YAAY,aAAa;QAEzD,yDAAyD;QACzD,MAAM,YAAY,CAAC,GAAG,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAE/E,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,qIAAQ,CACjC,IAAI,CAAC,YACL,MAAM,CAAC;YACJ,IAAI;YACJ,aAAa,YAAY,WAAW;YACpC,aAAa,YAAY,WAAW;YACpC,OAAO,YAAY,KAAK;YACxB,OAAO,YAAY,KAAK;YACxB,oBAAoB,YAAY,kBAAkB;YAClD,kBAAkB,YAAY,gBAAgB;YAC9C,eAAe;YACf,UAAU,YAAY,QAAQ;YAC9B,cAAc,YAAY,YAAY;YACtC,QAAQ;YACR,YAAY,IAAI,OAAO,WAAW;QACtC,GACC,MAAM,CAAC,MACP,MAAM;QAEX,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC;QAClD;QAEA,OAAO;YAAE,SAAS;YAAM,WAAW,MAAM,MAAM;QAAU;IAC7D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO;YACH,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACJ;AACJ"}},
    {"offset": {"line": 485, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yusuk/Documents/wwx/Wayfinder%20AgriX/v3-app/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport dynamic from 'next/dynamic';\nimport { calculateCurrentUnitPrice } from '@/lib/calculator/priceCalculator';\nimport { fetchActiveProject, fetchCampaignTotalArea, createBooking, type BookingData } from '@/lib/api';\nimport { Project } from '@/types/database';\nimport type { Polygon } from 'geojson';\nimport type { FarmerFormData } from '@/components/CampaignForm';\n\n// Dynamically import components to avoid SSR issues\nconst PolygonMap = dynamic(() => import('@/components/PolygonMap'), {\n  ssr: false,\n  loading: () => (\n    <div className=\"w-full h-full bg-slate-100 animate-pulse rounded-2xl flex items-center justify-center text-slate-400\">\n      Âú∞Âõ≥„ÇíË™≠„ÅøËæº„Åø‰∏≠...\n    </div>\n  )\n});\n\nconst CampaignForm = dynamic(() => import('@/components/CampaignForm'), {\n  ssr: false,\n});\n\nexport default function Home() {\n  const [project, setProject] = useState<Project | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [area10r, setArea10r] = useState<number>(0);\n  const [polygon, setPolygon] = useState<Polygon | null>(null);\n  const [coords, setCoords] = useState<{ lat: number; lng: number }[] | null>(null);\n  const [totalCampaignArea, setTotalCampaignArea] = useState<number>(0);\n\n  // Load active project and total area on mount\n  useEffect(() => {\n    async function loadProject() {\n      const activeProject = await fetchActiveProject();\n      setProject(activeProject);\n\n      if (activeProject) {\n        const totalArea = await fetchCampaignTotalArea(activeProject.id);\n        setTotalCampaignArea(totalArea);\n      }\n\n      setLoading(false);\n    }\n    loadProject();\n  }, []);\n\n  const handlePolygonComplete = (\n    newCoords: { lat: number; lng: number }[] | null,\n    newArea10r: number,\n    newPolygon: Polygon | null\n  ) => {\n    setCoords(newCoords);\n    setArea10r(newArea10r);\n    setPolygon(newPolygon);\n  };\n\n  const handleFormSubmit = async (formData: FarmerFormData) => {\n    if (!project || !polygon) {\n      alert('Ê°à‰ª∂ÊÉÖÂ†±„Åæ„Åü„ÅØÂúÉÂ†¥„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô');\n      return;\n    }\n\n    // Calculate the locked price at submission time using TOTAL area\n    const pricing = {\n      base_price: project.base_price || 0,\n      min_price: project.min_price || 0,\n      target_area_10r: project.target_area_10r || 0,\n      min_target_area_10r: project.min_target_area_10r,\n      max_target_area_10r: project.max_target_area_10r,\n      execution_price: project.execution_price,\n    };\n\n    const simulatedTotalArea = totalCampaignArea + area10r;\n    const validation = calculateCurrentUnitPrice(pricing, simulatedTotalArea);\n    const lockedPrice = validation.currentPrice ?? project.base_price ?? 0;\n\n    const bookingData: BookingData = {\n      campaign_id: project.id,\n      farmer_name: formData.farmerName,\n      phone: formData.phone,\n      email: formData.email,\n      desired_start_date: formData.desiredStartDate,\n      desired_end_date: formData.desiredEndDate,\n      field_polygon: polygon,\n      area_10r: area10r,\n      locked_price: lockedPrice,\n    };\n\n    const result = await createBooking(bookingData);\n\n    if (result.success) {\n      alert(`‰∫àÁ¥Ñ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü!\\n‰∫àÁ¥ÑID: ${result.bookingId}\\n\\nÁ¢∫Ë™ç„É°„Éº„É´„Çí ${formData.email} „Å´ÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ`);\n      // Reset form\n      setArea10r(0);\n      setPolygon(null);\n      setCoords(null);\n      // Reload to clear map and refresh total area\n      window.location.reload();\n    } else {\n      alert(`‰∫àÁ¥Ñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${result.error}`);\n    }\n  };\n\n  if (loading) {\n    return (\n      <main className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-green-600 mx-auto mb-4\"></div>\n          <p className=\"text-slate-600 font-medium\">Ë™≠„ÅøËæº„Åø‰∏≠...</p>\n        </div>\n      </main>\n    );\n  }\n\n  if (!project) {\n    return (\n      <main className=\"min-h-screen bg-slate-50 flex items-center justify-center p-4\">\n        <div className=\"bg-white p-8 rounded-2xl shadow-lg border border-slate-200 max-w-md text-center\">\n          <div className=\"text-6xl mb-4\">üåæ</div>\n          <h1 className=\"text-2xl font-bold text-slate-800 mb-2\">ÁèæÂú®ÂãüÈõÜ‰∏≠„ÅÆÊ°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</h1>\n          <p className=\"text-slate-600\">Êñ∞„Åó„ÅÑÊ°à‰ª∂„ÅåÈñãÂßã„Åï„Çå„Çã„Åæ„Åß„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ</p>\n        </div>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"min-h-screen bg-gradient-to-br from-slate-50 to-green-50/30\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3\">\n            <div>\n              <h1 className=\"text-2xl md:text-3xl font-black text-slate-800 tracking-tight\">\n                <span className=\"text-green-600 mr-2\">üåæ Wayfinder</span>AgriX\n              </h1>\n              <p className=\"text-slate-500 text-sm font-medium mt-1\">Ëæ≤‰ΩúÊ•≠‰∫àÁ¥Ñ„Ç∑„Çπ„ÉÜ„É†</p>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-blue-50 px-3 py-1.5 rounded-lg border border-blue-200\">\n                <span className=\"text-blue-700 font-bold text-xs\">\n                  Á¥ØË®à: {totalCampaignArea.toFixed(1)} Âèç\n                </span>\n              </div>\n              <div className=\"flex items-center gap-2 bg-green-50 px-4 py-2 rounded-full border border-green-200\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                <span className=\"text-green-700 font-bold text-sm\">ÂãüÈõÜ‰∏≠</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n\n          {/* Left Column: Map */}\n          <section className=\"order-2 lg:order-1\">\n            <div className=\"bg-white p-4 rounded-2xl shadow-sm border border-slate-200 h-[500px] lg:h-[700px] relative\">\n              <div className=\"absolute top-6 left-6 z-[1000] bg-white/95 backdrop-blur px-4 py-2 rounded-xl shadow-md border border-slate-200\">\n                <h2 className=\"text-sm font-bold text-slate-600 mb-1\">ÂúÉÂ†¥„ÇíÊèèÁîª</h2>\n                <p className=\"text-xs text-slate-500\">Âú∞Âõ≥‰∏ä„Åß„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂúÉÂ†¥„ÅÆÁØÑÂõ≤„ÇíÊåáÂÆö</p>\n              </div>\n\n              {/* Area Display Overlay */}\n              {area10r > 0 && (\n                <div className=\"absolute top-6 right-6 z-[1000] bg-green-600 text-white px-5 py-3 rounded-xl shadow-lg border-2 border-green-500 min-w-[180px]\">\n                  <div className=\"text-xs font-bold uppercase tracking-wider mb-1 opacity-90\">ÈÅ∏ÊäûÈù¢Á©ç</div>\n                  <div className=\"text-3xl font-black\">\n                    {area10r.toFixed(2)} <span className=\"text-sm font-normal opacity-90\">Âèç</span>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"w-full h-full rounded-xl overflow-hidden\">\n                <PolygonMap\n                  onPolygonComplete={handlePolygonComplete}\n                  initialPolygon={coords || undefined}\n                />\n              </div>\n            </div>\n          </section>\n\n          {/* Right Column: Form */}\n          <section className=\"order-1 lg:order-2\">\n            <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-200\">\n              <CampaignForm\n                project={project}\n                area10r={area10r}\n                totalCampaignArea={totalCampaignArea}\n                onSubmit={handleFormSubmit}\n              />\n            </div>\n          </section>\n\n        </div>\n\n        {/* Footer Info */}\n        <footer className=\"mt-8 text-center text-sm text-slate-500\">\n          <p>„Åî‰∏çÊòé„Å™ÁÇπ„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ„ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ</p>\n        </footer>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}