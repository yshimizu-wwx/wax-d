{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yusuk/Documents/wwx/Wayfinder%20AgriX/v3-app/src/components/PolygonMap.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { MapContainer, TileLayer, FeatureGroup, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport 'leaflet-draw/dist/leaflet.draw.css';\r\nimport { leafletLayerToGeoJSON, calculatePolygonArea10r } from '@/lib/geo/areaCalculator';\r\nimport type { Polygon } from 'geojson';\r\n\r\n// Fix Leaflet's default icon path issues\r\nimport markerIcon2x from 'leaflet/dist/images/marker-icon-2x.png';\r\nimport markerIcon from 'leaflet/dist/images/marker-icon.png';\r\nimport markerShadow from 'leaflet/dist/images/marker-shadow.png';\r\n\r\n// Import leaflet-draw side effects\r\nimport 'leaflet-draw';\r\n\r\n// Fix icons\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n    iconUrl: markerIcon.src,\r\n    iconRetinaUrl: markerIcon2x.src,\r\n    shadowUrl: markerShadow.src,\r\n});\r\n\r\ninterface PolygonMapProps {\r\n    onPolygonComplete: (coords: { lat: number; lng: number }[] | null, area10r: number, polygon: Polygon | null) => void;\r\n    initialPolygon?: { lat: number; lng: number }[];\r\n}\r\n\r\nfunction MapController({ onPolygonComplete, initialPolygon }: PolygonMapProps) {\r\n    const map = useMap();\r\n    const drawnItemsRef = useRef<L.FeatureGroup>(new L.FeatureGroup());\r\n\r\n    useEffect(() => {\r\n        const drawnItems = drawnItemsRef.current;\r\n        map.addLayer(drawnItems);\r\n\r\n        // Add initial polygon if provided\r\n        if (initialPolygon && initialPolygon.length > 2) {\r\n            const polygon = L.polygon(initialPolygon, {\r\n                color: '#10b981', // Tailwind green-500 equivalent\r\n                fillColor: '#10b981',\r\n                fillOpacity: 0.2,\r\n                weight: 2\r\n            });\r\n            drawnItems.addLayer(polygon);\r\n            map.fitBounds(polygon.getBounds());\r\n        }\r\n\r\n        // Initialize Draw Control\r\n        const drawControl = new L.Control.Draw({\r\n            draw: {\r\n                polygon: {\r\n                    allowIntersection: false,\r\n                    showArea: true,\r\n                    shapeOptions: {\r\n                        color: '#10b981',\r\n                        fillColor: '#10b981',\r\n                        fillOpacity: 0.2,\r\n                        weight: 2\r\n                    }\r\n                },\r\n                rectangle: false,\r\n                circle: false,\r\n                marker: false,\r\n                polyline: false,\r\n                circlemarker: false\r\n            },\r\n            edit: {\r\n                featureGroup: drawnItems,\r\n                remove: true,\r\n                edit: false // Simplified for this demo\r\n            }\r\n        });\r\n\r\n        map.addControl(drawControl);\r\n\r\n        // Event Handlers\r\n        map.on(L.Draw.Event.CREATED, (e: any) => {\r\n            const layer = e.layer;\r\n            drawnItems.clearLayers(); // Only allow one polygon\r\n            drawnItems.addLayer(layer);\r\n\r\n            const latlngs = layer.getLatLngs()[0] as { lat: number, lng: number }[];\r\n            // Convert to array of {lat, lng} objects if needed, Leaflet usually returns LatLng objects\r\n            const coords = latlngs.map(ll => ({ lat: ll.lat, lng: ll.lng }));\r\n\r\n            // Use the proper geo calculator with Turf.js\r\n            const polygon = leafletLayerToGeoJSON(layer);\r\n            const area10r = calculatePolygonArea10r(polygon);\r\n\r\n            onPolygonComplete(coords, area10r, polygon);\r\n        });\r\n\r\n        map.on(L.Draw.Event.DELETED, () => {\r\n            onPolygonComplete(null, 0, null);\r\n        });\r\n\r\n        return () => {\r\n            map.removeControl(drawControl);\r\n            map.removeLayer(drawnItems);\r\n            // clean up event listeners\r\n            map.off(L.Draw.Event.CREATED);\r\n            map.off(L.Draw.Event.DELETED);\r\n        };\r\n    }, [map, onPolygonComplete, initialPolygon]);\r\n\r\n    return null;\r\n}\r\n\r\nexport default function PolygonMap(props: PolygonMapProps) {\r\n    return (\r\n        <MapContainer\r\n            center={[35.6812, 139.7671]} // Tokyo default\r\n            zoom={15}\r\n            style={{ height: '100%', width: '100%', minHeight: '400px', borderRadius: '0.5rem' }}\r\n        >\r\n            <TileLayer\r\n                attribution='&copy; <a href=\"https://www.google.com/maps\">Google</a>'\r\n                url=\"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}\" // Google Hybrid\r\n                maxZoom={20}\r\n            />\r\n            <MapController {...props} />\r\n        </MapContainer>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AACA;AAGA;AAGA,yCAAyC;AACzC;AACA;AACA;AAEA,mCAAmC;AACnC;;;AAhBA;;;;;;;;;;;AAkBA,YAAY;AACZ,OAAO,AAAC,+JAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAS,WAAW;AACpD,+JAAC,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC;IACxB,SAAS,+JAAU,CAAC,GAAG;IACvB,eAAe,qKAAY,CAAC,GAAG;IAC/B,WAAW,iKAAY,CAAC,GAAG;AAC/B;AAOA,SAAS,cAAc,EAAE,iBAAiB,EAAE,cAAc,EAAmB;;IACzE,MAAM,MAAM,IAAA,6JAAM;IAClB,MAAM,gBAAgB,IAAA,uKAAM,EAAiB,IAAI,+JAAC,CAAC,YAAY;IAE/D,IAAA,0KAAS;mCAAC;YACN,MAAM,aAAa,cAAc,OAAO;YACxC,IAAI,QAAQ,CAAC;YAEb,kCAAkC;YAClC,IAAI,kBAAkB,eAAe,MAAM,GAAG,GAAG;gBAC7C,MAAM,UAAU,+JAAC,CAAC,OAAO,CAAC,gBAAgB;oBACtC,OAAO;oBACP,WAAW;oBACX,aAAa;oBACb,QAAQ;gBACZ;gBACA,WAAW,QAAQ,CAAC;gBACpB,IAAI,SAAS,CAAC,QAAQ,SAAS;YACnC;YAEA,0BAA0B;YAC1B,MAAM,cAAc,IAAI,+JAAC,CAAC,OAAO,CAAC,IAAI,CAAC;gBACnC,MAAM;oBACF,SAAS;wBACL,mBAAmB;wBACnB,UAAU;wBACV,cAAc;4BACV,OAAO;4BACP,WAAW;4BACX,aAAa;4BACb,QAAQ;wBACZ;oBACJ;oBACA,WAAW;oBACX,QAAQ;oBACR,QAAQ;oBACR,UAAU;oBACV,cAAc;gBAClB;gBACA,MAAM;oBACF,cAAc;oBACd,QAAQ;oBACR,MAAM,MAAM,2BAA2B;gBAC3C;YACJ;YAEA,IAAI,UAAU,CAAC;YAEf,iBAAiB;YACjB,IAAI,EAAE,CAAC,+JAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO;2CAAE,CAAC;oBAC1B,MAAM,QAAQ,EAAE,KAAK;oBACrB,WAAW,WAAW,IAAI,yBAAyB;oBACnD,WAAW,QAAQ,CAAC;oBAEpB,MAAM,UAAU,MAAM,UAAU,EAAE,CAAC,EAAE;oBACrC,2FAA2F;oBAC3F,MAAM,SAAS,QAAQ,GAAG;0DAAC,CAAA,KAAM,CAAC;gCAAE,KAAK,GAAG,GAAG;gCAAE,KAAK,GAAG,GAAG;4BAAC,CAAC;;oBAE9D,6CAA6C;oBAC7C,MAAM,UAAU,IAAA,+JAAqB,EAAC;oBACtC,MAAM,UAAU,IAAA,iKAAuB,EAAC;oBAExC,kBAAkB,QAAQ,SAAS;gBACvC;;YAEA,IAAI,EAAE,CAAC,+JAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO;2CAAE;oBACzB,kBAAkB,MAAM,GAAG;gBAC/B;;YAEA;2CAAO;oBACH,IAAI,aAAa,CAAC;oBAClB,IAAI,WAAW,CAAC;oBAChB,2BAA2B;oBAC3B,IAAI,GAAG,CAAC,+JAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO;oBAC5B,IAAI,GAAG,CAAC,+JAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO;gBAChC;;QACJ;kCAAG;QAAC;QAAK;QAAmB;KAAe;IAE3C,OAAO;AACX;GA/ES;;QACO,6JAAM;;;KADb;AAiFM,SAAS,WAAW,KAAsB;IACrD,qBACI,6LAAC,0KAAY;QACT,QAAQ;YAAC;YAAS;SAAS;QAC3B,MAAM;QACN,OAAO;YAAE,QAAQ;YAAQ,OAAO;YAAQ,WAAW;YAAS,cAAc;QAAS;;0BAEnF,6LAAC,oKAAS;gBACN,aAAY;gBACZ,KAAI;gBACJ,SAAS;;;;;;0BAEb,6LAAC;gBAAe,GAAG,KAAK;;;;;;;;;;;;AAGpC;MAfwB"}}]
}