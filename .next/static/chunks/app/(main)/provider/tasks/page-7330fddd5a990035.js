(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[109],{900:function(e,t,r){Promise.resolve().then(r.bind(r,1411))},7307:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},7976:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},6490:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},2944:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("FileCheck",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]])},6885:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]])},8792:function(e,t,r){"use strict";r.d(t,{default:function(){return a.a}});var n=r(5250),a=r.n(n)},7907:function(e,t,r){"use strict";var n=r(5313);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},1411:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var n=r(3827),a=r(4090),s=r(7907),i=r(8792);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,r(7461).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var d=r(6490),o=r(2944),c=r(6885),u=r(7976),m=r(7307),f=r(8793),x=r(4958),h=r(5671),p=r(575),g=r(2169);function v(){let e=(0,s.useRouter)(),[t,r]=(0,a.useState)(null),[v,b]=(0,a.useState)(!0),[y,j]=(0,a.useState)([]),[w,N]=(0,a.useState)([]),[k,_]=(0,a.useState)("pending");(0,a.useEffect)(()=>{(async()=>{let t=await (0,f.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}r(t);let{data:n}=await x.O.from("campaigns").select("id, campaign_title, location, final_date, status").eq("provider_id",t.id).in("status",["closed","completed","archived"]),a=null!=n?n:[];N(a);let s=a.map(e=>e.id);if(0===s.length){j([]),b(!1);return}let{data:i}=await x.O.from("bookings").select("id, campaign_id, farmer_id, farmer_name, area_10r, work_status, confirmed_date").in("campaign_id",s).neq("status","canceled"),l=null!=i?i:[],d=new Map(a.map(e=>[e.id,e]));l.forEach(e=>{e.campaign=d.get(e.campaign_id)}),j(l),b(!1)})()},[e]);let Z=(0,a.useMemo)(()=>[...y].filter(e=>"completed"!==e.work_status).sort((e,t)=>{let r=e.confirmed_date?new Date(e.confirmed_date).getTime():0,n=t.confirmed_date?new Date(t.confirmed_date).getTime():0;return 0===r&&0===n?0:0===r?1:0===n?-1:r-n}),[y]),C=(0,a.useMemo)(()=>y.filter(e=>"completed"===e.work_status).sort((e,t)=>{let r=e.confirmed_date?new Date(e.confirmed_date).getTime():0;return(t.confirmed_date?new Date(t.confirmed_date).getTime():0)-r}),[y]);if(v||!t)return(0,n.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-agrix-forest"})});let O=(e,t)=>{var r,a;let s=t?function(e){if(!e)return null;let t=new Date(e);t.setHours(0,0,0,0);let r=new Date;r.setHours(0,0,0,0);let n=Math.ceil((t.getTime()-r.getTime())/864e5);return n<0?"overdue":n<=3?"soon":null}(e.confirmed_date):null;return(0,n.jsxs)("li",{className:(0,g.cn)("py-4 flex flex-wrap items-center justify-between gap-3 rounded-xl px-3 -mx-3 transition-colors","overdue"===s&&"bg-red-500/10 border border-red-500/30","soon"===s&&"bg-amber-500/10 border border-amber-500/30"),children:[(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,n.jsx)("p",{className:"font-bold text-dashboard-text",children:(null===(r=e.campaign)||void 0===r?void 0:r.campaign_title)||(null===(a=e.campaign)||void 0===a?void 0:a.location)||"案件"}),"overdue"===s&&(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-red-500/20 text-red-600 dark:text-red-400 text-xs font-bold",children:[(0,n.jsx)(l,{className:"w-3.5 h-3.5"}),"報告期限切れ"]}),"soon"===s&&(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-amber-500/20 text-amber-700 dark:text-amber-400 text-xs font-bold",children:[(0,n.jsx)(d.Z,{className:"w-3.5 h-3.5"}),"期日が近い"]})]}),(0,n.jsxs)("p",{className:"text-sm text-dashboard-muted mt-0.5",children:[e.farmer_name||"農家"," \xb7 ",e.confirmed_date?new Date(e.confirmed_date).toLocaleDateString("ja-JP"):"日付未定"," \xb7 ",e.area_10r," 反"]})]}),t&&(0,n.jsx)(i.default,{href:"/provider/reports/new",children:(0,n.jsxs)(p.z,{size:"sm",className:"gap-1 bg-agrix-forest hover:bg-agrix-forest-dark",children:[(0,n.jsx)(o.Z,{className:"w-4 h-4"}),"実績報告"]})})]},e.id)};return(0,n.jsx)("main",{className:"min-h-full",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6 md:py-8",children:[(0,n.jsxs)("h1",{className:"text-xl md:text-2xl font-bold text-dashboard-text flex items-center gap-2 mb-6",children:[(0,n.jsx)(c.Z,{className:"w-6 h-6 text-agrix-forest"}),"作業"]}),(0,n.jsxs)("div",{className:"flex border-b border-dashboard-border mb-6",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>_("pending"),className:(0,g.cn)("flex items-center gap-2 px-4 py-3 text-sm font-bold border-b-2 transition-colors","pending"===k?"border-agrix-forest text-agrix-forest":"border-transparent text-dashboard-muted hover:text-dashboard-text"),children:[(0,n.jsx)(d.Z,{className:"w-4 h-4"}),"作業予定（未報告）",(0,n.jsxs)("span",{className:"tabular-nums text-xs font-normal opacity-80",children:["(",Z.length,")"]})]}),(0,n.jsxs)("button",{type:"button",onClick:()=>_("completed"),className:(0,g.cn)("flex items-center gap-2 px-4 py-3 text-sm font-bold border-b-2 transition-colors","completed"===k?"border-agrix-forest text-agrix-forest":"border-transparent text-dashboard-muted hover:text-dashboard-text"),children:[(0,n.jsx)(u.Z,{className:"w-4 h-4"}),"作業完了（済）",(0,n.jsxs)("span",{className:"tabular-nums text-xs font-normal opacity-80",children:["(",C.length,")"]})]})]}),(0,n.jsxs)(h.Zb,{children:[(0,n.jsx)(h.Ol,{className:"pb-2",children:(0,n.jsx)(h.ll,{className:"text-base flex items-center gap-2",children:"pending"===k?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{className:"w-5 h-5 text-agrix-forest"}),"作業予定（未報告）"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.Z,{className:"w-5 h-5 text-agrix-forest"}),"作業完了（報告済）"]})})}),(0,n.jsxs)(h.aY,{children:["pending"===k&&0===Z.length&&(0,n.jsxs)("div",{className:"py-12 text-center text-dashboard-muted",children:[(0,n.jsx)("p",{className:"font-medium mb-1",children:"未報告の作業はありません"}),(0,n.jsx)("p",{className:"text-sm",children:"案件を「日付確定」まで進めると、ここに表示されます。"}),(0,n.jsx)(i.default,{href:"/provider/projects",children:(0,n.jsx)(p.z,{variant:"outline",size:"sm",className:"mt-4",children:"案件一覧へ"})})]}),"pending"===k&&Z.length>0&&(0,n.jsx)("ul",{className:"divide-y divide-dashboard-border",children:Z.map(e=>O(e,!0))}),"completed"===k&&0===C.length&&(0,n.jsxs)("div",{className:"py-12 text-center text-dashboard-muted",children:[(0,n.jsx)("p",{className:"font-medium",children:"報告済みの作業はまだありません"}),(0,n.jsx)(i.default,{href:"/provider/reports/new",children:(0,n.jsxs)(p.z,{variant:"outline",size:"sm",className:"mt-4 gap-2",children:[(0,n.jsx)(o.Z,{className:"w-4 h-4"}),"実績報告をする"]})})]}),"completed"===k&&C.length>0&&(0,n.jsx)("ul",{className:"divide-y divide-dashboard-border",children:C.map(e=>O(e,!1))})]})]}),(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap gap-4",children:[(0,n.jsxs)(i.default,{href:"/provider/reports/new",className:"inline-flex items-center gap-2 text-sm font-bold text-agrix-forest hover:underline",children:[(0,n.jsx)(o.Z,{className:"w-4 h-4"}),"実績報告"]}),(0,n.jsxs)(i.default,{href:"/provider/calendar",className:"inline-flex items-center gap-2 text-sm font-medium text-dashboard-muted hover:text-dashboard-text",children:[(0,n.jsx)(m.Z,{className:"w-4 h-4"}),"カレンダー"]})]})]})})}},575:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var n=r(3827),a=r(4090),s=r(9769),i=r(2169);let l=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold tracking-tight transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",accent:"bg-accent text-accent-foreground hover:bg-accent/80 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10",secondary:"bg-muted text-muted-foreground hover:bg-muted/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,...d}=e;return(0,n.jsx)("button",{className:(0,i.cn)(l({variant:a,size:s,className:r})),ref:t,...d})});d.displayName="Button"},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return c},ll:function(){return d}});var n=r(3827),a=r(4090),s=r(2169);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border border-border bg-card text-card-foreground shadow-sm transition-all duration-200 hover:shadow-md",r),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("h3",{ref:t,className:(0,s.cn)("text-lg font-bold leading-none tracking-tight text-card-foreground",r),...a})});d.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},8793:function(e,t,r){"use strict";r.d(t,{Lj:function(){return i},gQ:function(){return l},ts:function(){return a},w7:function(){return s}});var n=r(4958);async function a(){try{var e,t,r,a,s,i,l,d,o,c;let{data:{session:u}}=await n.O.auth.getSession();if(!(null==u?void 0:null===(e=u.user)||void 0===e?void 0:e.email))return null;let{data:m,error:f}=await n.O.from("users").select("*").eq("email",u.user.email).single();if(f||!m)return null;return{id:m.id,email:null!==(t=m.email)&&void 0!==t?t:"",role:m.role,name:null!==(r=m.name)&&void 0!==r?r:"",phone:null!==(a=m.phone)&&void 0!==a?a:"",status:null!==(s=m.status)&&void 0!==s?s:"",address:null!==(i=m.address)&&void 0!==i?i:void 0,lat:null!==(l=m.lat)&&void 0!==l?l:void 0,lng:null!==(d=m.lng)&&void 0!==d?d:void 0,associated_provider_id:null!==(o=m.associated_provider_id)&&void 0!==o?o:void 0,invitation_code:null!==(c=m.invitation_code)&&void 0!==c?c:void 0}}catch(e){return console.error("Error getting current user:",e),null}}async function s(){await n.O.auth.signOut(),window.location.href="/login"}async function i(e){try{var t;let{data:{session:r}}=await n.O.auth.getSession();if(!(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:a}=await n.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",r.user.email);if(a)return{success:!1,error:a.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function l(e){try{let{error:t}=await n.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},4958:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});let n=(0,r(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(3167),a=r(1367);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},9769:function(e,t,r){"use strict";r.d(t,{j:function(){return i}});var n=r(3167);let a=e=>"boolean"==typeof e?"".concat(e):0===e?"0":e,s=n.W,i=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:l}=t,d=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],n=null==l?void 0:l[e];if(null===t)return null;let s=a(t)||a(n);return i[e][s]}),o=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,d,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...o}[t]):({...l,...o})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[128,150,250,971,69,744],function(){return e(e.s=900)}),_N_E=e.O()}]);