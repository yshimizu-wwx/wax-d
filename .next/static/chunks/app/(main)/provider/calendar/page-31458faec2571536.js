(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87],{4436:function(e,t,a){Promise.resolve().then(a.bind(a,5810))},5810:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var r=a(3827),s=a(4090),n=a(7907),i=a(8792),d=a(9108),l=a(8793),o=a(4958),c=a(3389),u=a(5850),f=a(1875),m=a(7089),h=a(7307);function p(e){let{providerId:t,projects:a,bookings:n=[],height:i=500}=e,d=(0,s.useRef)(null),[l,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{o(!0)},[]);let p=[];return(a.forEach(e=>{let t=e.campaign_title||e.location||e.id||"案件",a=e.final_date||e.start_date,r=e.end_date||e.final_date||e.start_date;a&&p.push({id:"proj-".concat(e.id),title:"\uD83D\uDCCB ".concat(t),start:a,end:r?r===a?void 0:r:void 0,allDay:!0,extendedProps:{type:"project",projectId:e.id,status:e.status}})}),n.forEach(e=>{let t=e.confirmed_date||(e.applied_at?e.applied_at.split("T")[0]:null);t&&p.push({id:"book-".concat(e.id),title:"申込 #".concat(e.id.slice(-6)),start:t,allDay:!0,extendedProps:{type:"booking",bookingId:e.id,campaignId:e.campaign_id}})}),l)?(0,r.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden",children:(0,r.jsx)(c.Z,{ref:d,plugins:[u.Z,f.Z,m.Z],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"},buttonText:{today:"今日",month:"月",week:"週",list:"リスト"},locale:"ja",events:p,height:i,eventDisplay:"block",dayMaxEvents:4})}):(0,r.jsx)("div",{className:"flex items-center justify-center rounded-2xl border border-slate-200 bg-slate-50",style:{height:"number"==typeof i?"".concat(i,"px"):i},children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-slate-500",children:[(0,r.jsx)(h.Z,{className:"w-6 h-6 animate-pulse"}),(0,r.jsx)("span",{children:"カレンダーを読み込み中..."})]})})}function x(){let e=(0,n.useRouter)(),[t,a]=(0,s.useState)(null),[c,u]=(0,s.useState)([]),[f,m]=(0,s.useState)([]),[h,x]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{(async()=>{let t=await (0,l.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}a(t);let{data:r}=await o.O.from("projects").select("id, start_date, end_date, final_date, campaign_title, location, status").eq("provider_id",t.id);u(r||[]);let s=(r||[]).map(e=>e.id);if(s.length>0){let{data:e}=await o.O.from("bookings").select("id, campaign_id, confirmed_date, applied_at").in("campaign_id",s);m(e||[])}x(!1)})()},[e]),h||!t)?(0,r.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-agrix-forest"})}):(0,r.jsx)("main",{className:"min-h-full",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6 md:py-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsxs)(i.default,{href:"/admin",className:"p-2 rounded-lg border border-dashboard-border hover:bg-dashboard-card flex items-center gap-2 text-dashboard-muted",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5"}),"戻る"]}),(0,r.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-dashboard-text",children:"作業カレンダー"})]}),(0,r.jsx)(p,{providerId:t.id,projects:c,bookings:f,height:600})]})})}},8793:function(e,t,a){"use strict";a.d(t,{Lj:function(){return i},gQ:function(){return d},ts:function(){return s},w7:function(){return n}});var r=a(4958);async function s(){try{let{data:{session:e}}=await r.O.auth.getSession();if(!e)return null;let{data:t,error:a}=await r.O.from("users").select("*").eq("email",e.user.email).single();if(a||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function n(){await r.O.auth.signOut(),window.location.href="/login"}async function i(e){try{var t;let{data:{session:a}}=await r.O.auth.getSession();if(!(null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:s}=await r.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",a.user.email);if(s)return{success:!1,error:s.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function d(e){try{let{error:t}=await r.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},4958:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")}},function(e){e.O(0,[554,342,250,605,971,69,744],function(){return e(e.s=4436)}),_N_E=e.O()}]);