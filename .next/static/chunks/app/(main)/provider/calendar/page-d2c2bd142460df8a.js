(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87],{4436:function(e,t,a){Promise.resolve().then(a.bind(a,5810))},5810:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var i=a(3827),n=a(4090),r=a(7907),s=a(8792),d=a(9108),l=a(8793),o=a(4958),c=a(3389),u=a(5850),m=a(1875),f=a(7089),p=a(7307);function h(e){let{providerId:t,projects:a,bookings:r=[],height:s=500}=e,d=(0,n.useRef)(null),[l,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{o(!0)},[]);let h=[];return(a.forEach(e=>{let t=e.campaign_title||e.location||e.id||"案件",a=e.final_date||e.start_date,i=e.end_date||e.final_date||e.start_date;a&&h.push({id:"proj-".concat(e.id),title:"\uD83D\uDCCB ".concat(t),start:a,end:i?i===a?void 0:i:void 0,allDay:!0,extendedProps:{type:"project",projectId:e.id,status:e.status}})}),r.forEach(e=>{let t=e.confirmed_date||(e.applied_at?e.applied_at.split("T")[0]:null);t&&h.push({id:"book-".concat(e.id),title:"申込 #".concat(e.id.slice(-6)),start:t,allDay:!0,extendedProps:{type:"booking",bookingId:e.id,campaignId:e.campaign_id}})}),l)?(0,i.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden",children:(0,i.jsx)(c.Z,{ref:d,plugins:[u.Z,m.Z,f.Z],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"},buttonText:{today:"今日",month:"月",week:"週",list:"リスト"},locale:"ja",events:h,height:s,eventDisplay:"block",dayMaxEvents:4})}):(0,i.jsx)("div",{className:"flex items-center justify-center rounded-2xl border border-slate-200 bg-slate-50",style:{height:"number"==typeof s?"".concat(s,"px"):s},children:(0,i.jsxs)("div",{className:"flex items-center gap-2 text-slate-500",children:[(0,i.jsx)(p.Z,{className:"w-6 h-6 animate-pulse"}),(0,i.jsx)("span",{children:"カレンダーを読み込み中..."})]})})}function v(){let e=(0,r.useRouter)(),[t,a]=(0,n.useState)(null),[c,u]=(0,n.useState)([]),[m,f]=(0,n.useState)([]),[p,v]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{let t=await (0,l.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}a(t);let{data:i}=await o.O.from("campaigns").select("id, start_date, end_date, final_date, campaign_title, location, status").eq("provider_id",t.id);u(i||[]);let n=(i||[]).map(e=>e.id);if(n.length>0){let{data:e}=await o.O.from("bookings").select("id, campaign_id, confirmed_date, applied_at").in("campaign_id",n);f(e||[])}v(!1)})()},[e]),p||!t)?(0,i.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-agrix-forest"})}):(0,i.jsx)("main",{className:"min-h-full",children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6 md:py-8",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,i.jsxs)(s.default,{href:"/admin",className:"p-2 rounded-lg border border-dashboard-border hover:bg-dashboard-card flex items-center gap-2 text-dashboard-muted",children:[(0,i.jsx)(d.Z,{className:"w-5 h-5"}),"戻る"]}),(0,i.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-dashboard-text",children:"作業カレンダー"})]}),(0,i.jsx)(h,{providerId:t.id,projects:c,bookings:m,height:600})]})})}},8793:function(e,t,a){"use strict";a.d(t,{Lj:function(){return s},gQ:function(){return d},ts:function(){return n},w7:function(){return r}});var i=a(4958);async function n(){try{var e,t,a,n,r,s,d,l,o,c;let{data:{session:u}}=await i.O.auth.getSession();if(!(null==u?void 0:null===(e=u.user)||void 0===e?void 0:e.email))return null;let{data:m,error:f}=await i.O.from("users").select("*").eq("email",u.user.email).single();if(f||!m)return null;return{id:m.id,email:null!==(t=m.email)&&void 0!==t?t:"",role:m.role,name:null!==(a=m.name)&&void 0!==a?a:"",phone:null!==(n=m.phone)&&void 0!==n?n:"",status:null!==(r=m.status)&&void 0!==r?r:"",address:null!==(s=m.address)&&void 0!==s?s:void 0,lat:null!==(d=m.lat)&&void 0!==d?d:void 0,lng:null!==(l=m.lng)&&void 0!==l?l:void 0,associated_provider_id:null!==(o=m.associated_provider_id)&&void 0!==o?o:void 0,invitation_code:null!==(c=m.invitation_code)&&void 0!==c?c:void 0}}catch(e){return console.error("Error getting current user:",e),null}}async function r(){await i.O.auth.signOut(),window.location.href="/login"}async function s(e){try{var t;let{data:{session:a}}=await i.O.auth.getSession();if(!(null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:n}=await i.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",a.user.email);if(n)return{success:!1,error:n.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function d(e){try{let{error:t}=await i.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},4958:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});let i=(0,a(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")}},function(e){e.O(0,[554,128,250,605,971,69,744],function(){return e(e.s=4436)}),_N_E=e.O()}]);