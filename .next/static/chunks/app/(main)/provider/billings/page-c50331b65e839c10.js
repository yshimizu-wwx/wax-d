(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{8332:function(e,t,r){Promise.resolve().then(r.bind(r,7150))},9108:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9475:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},8792:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var a=r(5250),n=r.n(a)},7907:function(e,t,r){"use strict";var a=r(5313);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},7150:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(3827),n=r(4090),s=r(7907),i=r(8792),d=r(9108),o=r(9475);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,r(7461).Z)("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);var c=r(8793),u=r(4958),m=r(5671);function h(){let e=(0,s.useRouter)(),[t,r]=(0,n.useState)(null),[h,f]=(0,n.useState)([]),[x,p]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{let t=await (0,c.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}r(t);let{data:a}=await u.O.from("campaigns").select("id, campaign_title, location, final_date, status").eq("provider_id",t.id);if(!(null==a?void 0:a.length)){p(!1);return}let{data:n}=await u.O.from("bookings").select("id, campaign_id, farmer_id, area_10r, actual_area_10r, work_status, final_amount, invoice_status").in("campaign_id",a.map(e=>e.id)).eq("work_status","completed"),s=n||[],i=[...new Set(s.map(e=>e.farmer_id).filter(Boolean))],d=new Map;if(i.length>0){let{data:e}=await u.O.from("users").select("id, name").in("id",i);d=new Map((e||[]).map(e=>[e.id,e]))}let o=new Map;a.forEach(e=>{o.set(e.id,{project:e,bookings:[],totalAmount:0})}),s.forEach(e=>{let t=o.get(e.campaign_id);if(!t)return;let r=e.farmer_id?d.get(e.farmer_id):void 0,a=Number(e.final_amount)||0;t.bookings.push({...e,farmer:r}),t.totalAmount+=a}),f(Array.from(o.values()).filter(e=>e.bookings.length>0)),p(!1)})()},[e]),x||!t)?(0,a.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-agrix-forest"})}):(0,a.jsx)("main",{className:"min-h-full print:bg-white",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6 md:py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-6 print:mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(i.default,{href:"/admin",className:"p-2 rounded-lg border border-dashboard-border hover:bg-dashboard-card flex items-center gap-2 text-dashboard-muted print:hidden",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"}),"戻る"]}),(0,a.jsxs)("h1",{className:"text-xl md:text-2xl font-bold text-dashboard-text flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"w-6 h-6 text-agrix-forest"}),"請求管理"]})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{window.print()},className:"flex items-center gap-2 px-4 py-2 bg-agrix-slate text-white rounded-lg hover:opacity-90 print:hidden",children:[(0,a.jsx)(l,{className:"w-4 h-4"}),"印刷 / PDF"]})]}),0===h.length?(0,a.jsx)(m.Zb,{children:(0,a.jsxs)(m.aY,{className:"p-8 text-center text-dashboard-muted",children:[(0,a.jsx)("p",{children:"作業完了済みの申込がありません。"}),(0,a.jsx)(i.default,{href:"/admin",className:"mt-4 inline-block text-agrix-forest font-medium hover:underline",children:"案件一覧へ"})]})}):(0,a.jsx)("div",{className:"space-y-6",children:h.map(e=>{let{project:t,bookings:r,totalAmount:n}=e;return(0,a.jsxs)(m.Zb,{className:"overflow-hidden print:break-inside-avoid",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-dashboard-border bg-dashboard-bg",children:[(0,a.jsx)("h2",{className:"font-bold text-dashboard-text",children:t.campaign_title||t.location||t.id}),(0,a.jsxs)("p",{className:"text-sm text-dashboard-muted",children:["確定日: ",t.final_date||"-"," ・ 完了申込 ",r.length," 件"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-dashboard-border bg-dashboard-bg/80",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-bold text-dashboard-text",children:"農家"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-bold text-dashboard-text",children:"実績面積（反）"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-bold text-dashboard-text",children:"確定金額"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-bold text-dashboard-text",children:"請求状況"})]})}),(0,a.jsx)("tbody",{children:r.map(e=>{var t,r,n,s;return(0,a.jsxs)("tr",{className:"border-b border-dashboard-border",children:[(0,a.jsx)("td",{className:"py-3 px-4 text-dashboard-text",children:null!==(r=null===(t=e.farmer)||void 0===t?void 0:t.name)&&void 0!==r?r:"—"}),(0,a.jsx)("td",{className:"py-3 px-4 text-right text-dashboard-muted",children:null!==(s=null!==(n=e.actual_area_10r)&&void 0!==n?n:e.area_10r)&&void 0!==s?s:"-"}),(0,a.jsxs)("td",{className:"py-3 px-4 text-right font-medium text-dashboard-text",children:["\xa5",(Number(e.final_amount)||0).toLocaleString()]}),(0,a.jsx)("td",{className:"py-3 px-4 text-dashboard-muted",children:"sent"===e.invoice_status||"processed"===e.invoice_status||"invoiced"===e.invoice_status?"請求済":"未請求"})]},e.id)})}),(0,a.jsx)("tfoot",{children:(0,a.jsxs)("tr",{className:"bg-dashboard-bg font-bold",children:[(0,a.jsx)("td",{className:"py-3 px-4",colSpan:2,children:"合計"}),(0,a.jsxs)("td",{className:"py-3 px-4 text-right text-dashboard-text",children:["\xa5",n.toLocaleString()]}),(0,a.jsx)("td",{})]})})]})})]},t.id)})})]})})}},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return d},SZ:function(){return l},Zb:function(){return i},aY:function(){return c},ll:function(){return o}});var a=r(3827),n=r(4090),s=r(2169);let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border border-border bg-card text-card-foreground shadow-sm transition-all duration-200 hover:shadow-md",r),...n})});i.displayName="Card";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...n})});d.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,s.cn)("text-lg font-bold leading-none tracking-tight text-card-foreground",r),...n})});o.displayName="CardTitle";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...n})});l.displayName="CardDescription";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...n})});c.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},8793:function(e,t,r){"use strict";r.d(t,{Lj:function(){return i},gQ:function(){return d},ts:function(){return n},w7:function(){return s}});var a=r(4958);async function n(){try{var e,t,r,n,s,i,d,o,l,c;let{data:{session:u}}=await a.O.auth.getSession();if(!(null==u?void 0:null===(e=u.user)||void 0===e?void 0:e.email))return null;let{data:m,error:h}=await a.O.from("users").select("*").eq("email",u.user.email).single();if(h||!m)return null;return{id:m.id,email:null!==(t=m.email)&&void 0!==t?t:"",role:m.role,name:null!==(r=m.name)&&void 0!==r?r:"",phone:null!==(n=m.phone)&&void 0!==n?n:"",status:null!==(s=m.status)&&void 0!==s?s:"",address:null!==(i=m.address)&&void 0!==i?i:void 0,lat:null!==(d=m.lat)&&void 0!==d?d:void 0,lng:null!==(o=m.lng)&&void 0!==o?o:void 0,associated_provider_id:null!==(l=m.associated_provider_id)&&void 0!==l?l:void 0,invitation_code:null!==(c=m.invitation_code)&&void 0!==c?c:void 0}}catch(e){return console.error("Error getting current user:",e),null}}async function s(){await a.O.auth.signOut(),window.location.href="/login"}async function i(e){try{var t;let{data:{session:r}}=await a.O.auth.getSession();if(!(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:n}=await a.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",r.user.email);if(n)return{success:!1,error:n.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function d(e){try{let{error:t}=await a.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},4958:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let a=(0,r(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var a=r(3167),n=r(1367);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}}},function(e){e.O(0,[128,150,250,971,69,744],function(){return e(e.s=8332)}),_N_E=e.O()}]);