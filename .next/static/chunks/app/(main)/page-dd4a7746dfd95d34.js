(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4794:function(e,t,s){Promise.resolve().then(s.bind(s,6489))},6489:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var a=s(3827),r=s(4090),l=s(4232),i=s(8792),n=s(7907),d=s(2244),c=s(7307),o=s(8994),x=s(8025),m=s(2457),h=s(9475),u=s(9299),f=s(6288),p=s(407),b=s(8222),g=s(8793),j=s(575),N=s(5671),v=s(5772),_=s(2169);let w=r.forwardRef((e,t)=>{let{className:s,value:r,indicatorClassName:l,...i}=e;return(0,a.jsx)(v.fC,{ref:t,className:(0,_.cn)("relative h-3 w-full overflow-hidden rounded-full bg-slate-200",s),...i,children:(0,a.jsx)(v.z$,{className:(0,_.cn)("h-full w-full flex-1 bg-agrix-forest transition-all duration-500 ease-out","data-[state=complete]:bg-agrix-gold",l),style:{transform:"translateX(-".concat(100-(null!=r?r:0),"%)")}})})});function y(e){let{result:t,currentPrice:s,label:l="逆オークション進捗",detail:i,className:n}=e,[d,c]=(0,r.useState)(t.progress),[o,x]=(0,r.useState)(s);(0,r.useEffect)(()=>{c(t.progress)},[t.progress]),(0,r.useEffect)(()=>{s!==o&&x(s)},[s,o]);let m=Math.round(100*d);return(0,a.jsxs)("div",{className:(0,_.cn)("space-y-2",n),children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-slate-600",children:l}),i&&(0,a.jsx)("span",{className:"text-slate-500",children:i})]}),(0,a.jsx)(w,{value:m,className:"h-3"}),(0,a.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:[m,"%"]}),null!=s&&(0,a.jsxs)("span",{className:"text-lg font-bold text-agrix-forest animate-price-pulse tabular-nums",children:["\xa5",s.toLocaleString(),(0,a.jsx)("span",{className:"text-xs font-normal text-slate-500 ml-1",children:"/10a"})]},s),t.isUnformed&&(0,a.jsx)("span",{className:"text-xs font-medium text-amber-600",children:"最低成立面積に達していません"})]})]})}function Z(e){var t;let{campaign:s,onSelect:r,isSelected:l,className:i}=e,n=null!==(t=s.totalArea10r)&&void 0!==t?t:0,d={base_price:s.base_price||0,min_price:s.min_price||0,target_area_10r:s.target_area_10r||0,min_target_area_10r:s.min_target_area_10r,max_target_area_10r:s.max_target_area_10r,execution_price:s.execution_price},o=(0,p.Bx)(d,n);return s.max_target_area_10r||s.target_area_10r,(0,a.jsx)(N.Zb,{className:(0,_.cn)("transition-all border-2",l?"border-agrix-forest ring-2 ring-agrix-forest/20":"hover:border-agrix-forest/50",i),children:(0,a.jsx)(N.aY,{className:"p-5",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-dashboard-text text-base leading-tight",children:s.campaign_title||s.location||"案件"}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-sm text-dashboard-muted",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 text-agrix-forest"}),s.location]}),s.start_date&&s.end_date&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 text-agrix-forest"}),s.start_date," ～ ",s.end_date]})]})]}),(0,a.jsx)(y,{result:o,currentPrice:o.currentPrice,detail:o.remainingArea>0?"残り ".concat(o.remainingArea.toFixed(1)," 反で目標"):"目標達成"}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,a.jsxs)("span",{className:"text-xs text-dashboard-muted",children:["申込合計: ",n.toFixed(1)," 反"]}),(0,a.jsx)(j.z,{size:"sm",onClick:()=>r(s),className:"shrink-0",children:"申し込む"})]})]})})})}w.displayName=v.fC.displayName;var k=s(8228);let S=(0,l.default)(()=>Promise.all([s.e(212),s.e(590),s.e(566)]).then(s.bind(s,8995)),{loadableGenerated:{webpack:()=>[8995]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"w-full h-full bg-dashboard-card animate-pulse rounded-2xl flex items-center justify-center text-dashboard-muted",children:"地図を読み込み中..."})}),A=(0,l.default)(()=>s.e(435).then(s.bind(s,1435)),{loadableGenerated:{webpack:()=>[1435]},ssr:!1});function E(){var e,t;let s=(0,n.useRouter)(),[l,j]=(0,r.useState)(null),[v,_]=(0,r.useState)(!0),[w,y]=(0,r.useState)([]),[E,z]=(0,r.useState)([]),[P,C]=(0,r.useState)(null),[Y,D]=(0,r.useState)(!0),[F,B]=(0,r.useState)(0),[L,R]=(0,r.useState)(null),[W,X]=(0,r.useState)(null),[G,I]=(0,r.useState)([]);(0,r.useEffect)(()=>{(0,g.ts)().then(e=>{j(null!=e?e:null),_(!1)})},[]),(0,r.useEffect)(()=>{if(!v&&l&&("admin"===l.role||"provider"===l.role)){s.replace("/admin");return}},[l,v,s]),(0,r.useEffect)(()=>{v||l||(0,b.v2)().then(y).finally(()=>D(!1))},[v,l]),(0,r.useEffect)(()=>{if(v||!l||"farmer"!==l.role)return;let e=!1;return D(!0),(0,b.v2)().then(t=>{if(!e)return Promise.all(t.map(e=>(0,b.x1)(e.id).then(t=>({...e,totalArea10r:t}))))}).then(t=>{!e&&t&&(z(t),C(e=>{var s;let a=null!==(s=t[0])&&void 0!==s?s:null;if(!e)return a;let r=t.find(t=>t.id===e.id);return null!=r?r:a}))}).finally(()=>{e||D(!1)}),l.id&&(0,b.ss)(l.id).then(t=>{e||I(t)}),()=>{e=!0}},[v,l]);let M=null!==(e=null==P?void 0:P.totalArea10r)&&void 0!==e?e:0,O=async e=>{var t,s;if(!P||!L){f.toast.error("案件情報または圃場データが不足しています");return}let a={base_price:P.base_price||0,min_price:P.min_price||0,target_area_10r:P.target_area_10r||0,min_target_area_10r:P.min_target_area_10r,max_target_area_10r:P.max_target_area_10r,execution_price:P.execution_price},r=M+F,i=null!==(s=null!==(t=(0,p.Bx)(a,r).currentPrice)&&void 0!==t?t:P.base_price)&&void 0!==s?s:0,n={campaign_id:P.id,farmer_id:(null==l?void 0:l.role)==="farmer"&&(null==l?void 0:l.id)?l.id:void 0,farmer_name:e.farmerName,phone:e.phone,email:e.email,desired_start_date:e.desiredStartDate,desired_end_date:e.desiredEndDate,field_polygon:L,area_10r:F,locked_price:i},d=await (0,b.TB)(n);d.success?(f.toast.success("予約が完了しました。予約ID: ".concat(d.bookingId)),B(0),R(null),X(null),(null==l?void 0:l.id)&&(0,b.ss)(l.id).then(I),z(e=>e.map(e=>{var t;return e.id===P.id?{...e,totalArea10r:(null!==(t=e.totalArea10r)&&void 0!==t?t:0)+F}:e})),C(e=>{var t;return(null==e?void 0:e.id)===P.id?{...e,totalArea10r:(null!==(t=e.totalArea10r)&&void 0!==t?t:0)+F}:e})):f.toast.error(d.error||"予約に失敗しました")};if(v)return(0,a.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,a.jsx)(k.Z,{message:"読み込み中..."})});if(l&&("admin"===l.role||"provider"===l.role))return(0,a.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,a.jsx)(k.Z,{message:"ダッシュボードへ移動中..."})});if(!l)return(0,a.jsx)("main",{className:"min-h-full",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12",children:[(0,a.jsxs)("section",{className:"text-center mb-10",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-black text-dashboard-text mb-2",children:(0,a.jsx)("span",{className:"text-agrix-forest",children:"Wayfinder AgriX Drone"})}),(0,a.jsx)("p",{className:"text-dashboard-muted font-medium max-w-xl mx-auto text-base",children:"農家と業者をつなぐドローン農作業予約プラットフォーム。圃場を指定して簡単に申し込みできます。"}),(0,a.jsxs)(i.default,{href:"/login",className:"inline-flex items-center gap-2 mt-6 bg-agrix-forest text-white px-6 py-3 rounded-2xl font-bold shadow-sm hover:bg-agrix-forest-light transition-colors",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"}),"ログイン / 新規登録"]})]}),(0,a.jsxs)("section",{id:"campaigns",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-dashboard-text mb-4 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-agrix-forest"}),"公開案件一覧"]}),Y?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(o.Z,{className:"w-8 h-8 text-dashboard-muted animate-spin"})}):0===w.length?(0,a.jsx)(N.Zb,{children:(0,a.jsx)(N.aY,{className:"p-8 text-center text-dashboard-muted",children:"現在募集中の案件はありません。"})}):(0,a.jsx)("ul",{className:"space-y-3",children:w.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(N.Zb,{children:(0,a.jsxs)(N.aY,{className:"p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-dashboard-text",children:e.campaign_title||e.location}),(0,a.jsx)("p",{className:"text-sm text-dashboard-muted",children:e.start_date&&e.end_date?"".concat(e.start_date," ～ ").concat(e.end_date):e.location})]}),(0,a.jsxs)(i.default,{href:"/login",className:"inline-flex items-center gap-1 text-sm font-bold text-agrix-forest hover:underline shrink-0",children:["申し込む ",(0,a.jsx)(x.Z,{className:"w-4 h-4"})]})]})})},e.id))})]})]})});if("farmer"!==l.role)return null;if(Y&&0===E.length&&(null==l?void 0:l.role)==="farmer")return(0,a.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,a.jsx)(k.Z,{message:"読み込み中..."})});let J={confirmed:"確定",pending:"確認待ち",completed:"完了",canceled:"キャンセル"};return(0,a.jsx)("main",{className:"min-h-full",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8",children:[(null==l?void 0:l.role)==="farmer"&&(0,a.jsxs)("section",{className:"mb-8",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-dashboard-text mb-4 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-agrix-forest"}),"予約募集一覧"]}),0===E.length?(0,a.jsx)(N.Zb,{className:"mb-8",children:(0,a.jsxs)(N.aY,{className:"p-10 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"rounded-full bg-dashboard-muted/20 p-6 mb-4",children:(0,a.jsx)(m.Z,{className:"w-12 h-12 text-dashboard-muted"})}),(0,a.jsx)("p",{className:"font-bold text-dashboard-text mb-1",children:"現在募集中の案件はありません"}),(0,a.jsx)("p",{className:"text-sm text-dashboard-muted",children:"新しい案件が公開されるとここに表示されます。"})]})}):(0,a.jsx)("ul",{className:"space-y-4",children:E.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(Z,{campaign:e,onSelect:e=>C(e),isSelected:(null==P?void 0:P.id)===e.id})},e.id))})]}),(null==l?void 0:l.role)==="farmer"&&P&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4",children:[(0,a.jsxs)("p",{className:"text-dashboard-text font-bold text-sm",children:["申し込む案件: ",P.campaign_title||P.location]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-agrix-forest/10 text-agrix-forest px-3 py-1.5 rounded-lg border border-agrix-forest/30",children:[(0,a.jsx)("span",{className:"text-xs font-bold",children:"累計"}),(0,a.jsxs)("span",{className:"font-black",children:[(null!==(t=P.totalArea10r)&&void 0!==t?t:0).toFixed(1)," 反"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[(0,a.jsx)("section",{className:"order-2 lg:order-1",children:(0,a.jsxs)(N.Zb,{className:"p-4 h-[500px] lg:h-[700px] relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-[1000] bg-dashboard-card/95 backdrop-blur px-4 py-2 rounded-xl shadow-md border border-dashboard-border flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 text-agrix-forest"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-sm font-bold text-dashboard-text",children:"圃場を描画"}),(0,a.jsx)("p",{className:"text-xs text-dashboard-muted",children:"地図上でクリックして圃場の範囲を指定"})]})]}),F>0&&(0,a.jsxs)("div",{className:"absolute top-4 right-4 z-[1000] bg-agrix-forest text-white px-5 py-3 rounded-xl shadow-sm border-2 border-agrix-gold/50 min-w-[180px]",children:[(0,a.jsx)("div",{className:"text-xs font-bold uppercase tracking-wider mb-1 opacity-90",children:"選択面積"}),(0,a.jsxs)("div",{className:"text-2xl font-black",children:[F.toFixed(2)," ",(0,a.jsx)("span",{className:"text-sm font-normal opacity-90",children:"反"})]})]}),(0,a.jsx)("div",{className:"w-full h-full rounded-xl overflow-hidden absolute inset-0 p-4 pt-14",children:(0,a.jsx)(S,{onPolygonComplete:(e,t,s)=>{X(e),B(t),R(s)},initialPolygon:W||void 0})})]})}),(0,a.jsx)("section",{className:"order-1 lg:order-2",children:(0,a.jsx)(N.Zb,{children:(0,a.jsx)(N.aY,{className:"p-6",children:(0,a.jsx)(A,{project:P,area10r:F,totalCampaignArea:M,onSubmit:O})})})})]})]}),(0,a.jsxs)("section",{id:"applications",className:"mb-8",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-dashboard-text mb-4 flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"w-5 h-5 text-agrix-forest"}),"申込履歴"]}),(0,a.jsx)(N.Zb,{className:"overflow-hidden",children:0===G.length?(0,a.jsxs)(N.aY,{className:"p-10 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"rounded-full bg-dashboard-muted/20 p-6 mb-4",children:(0,a.jsx)(h.Z,{className:"w-12 h-12 text-dashboard-muted"})}),(0,a.jsx)("p",{className:"font-bold text-dashboard-text mb-1",children:"まだ申込がありません"}),(0,a.jsx)("p",{className:"text-sm text-dashboard-muted",children:"案件を選択して申し込むと、ここに履歴が表示されます。"})]}):(0,a.jsx)("ul",{className:"divide-y divide-dashboard-border",children:G.map(e=>{var t,s;return(0,a.jsx)("li",{className:"p-4 flex flex-wrap items-center justify-between gap-2",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-dashboard-text",children:(null===(t=e.project)||void 0===t?void 0:t.campaign_title)||(null===(s=e.project)||void 0===s?void 0:s.location)||e.campaign_id}),(0,a.jsxs)("p",{className:"text-sm text-dashboard-muted",children:[e.area_10r," 反",null!=e.locked_price&&" \xb7 \xa5".concat((e.area_10r*e.locked_price).toLocaleString())," \xb7 ",J[e.status]||e.status,e.created_at&&" \xb7 ".concat(new Date(e.created_at).toLocaleDateString("ja-JP"))]})]})},e.id)})})})]}),(0,a.jsxs)("section",{id:"my-field",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-dashboard-text mb-4 flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-agrix-forest"}),"My畑管理"]}),(0,a.jsx)(N.Zb,{children:(0,a.jsxs)(N.aY,{className:"p-10 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"rounded-full bg-agrix-forest/10 p-6 mb-4",children:(0,a.jsx)(u.Z,{className:"w-12 h-12 text-agrix-forest"})}),(0,a.jsx)("p",{className:"font-bold text-dashboard-text mb-1",children:"圃場情報の登録・管理"}),(0,a.jsx)("p",{className:"text-sm text-dashboard-muted mb-4",children:"畑を登録すると、作業依頼や申込時に選択できます。"}),(0,a.jsxs)(i.default,{href:"/my-fields",className:"inline-flex items-center gap-2 bg-agrix-forest text-white px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-agrix-forest-dark transition-colors",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"マイ畑を管理する"]})]})})]}),(0,a.jsxs)("footer",{className:"mt-8 text-center text-sm text-dashboard-muted",children:[(0,a.jsx)("p",{children:"ご不明な点がございましたら、お気軽にお問い合わせください。"}),(0,a.jsxs)("p",{className:"mt-2",children:["\xa9 2026"," ",(0,a.jsx)("a",{href:"https://wayfinderworx.com/",target:"_blank",rel:"noopener noreferrer",className:"text-dashboard-text hover:text-agrix-forest underline underline-offset-2",children:"Wayfinder WorX"})]})]})]})})}},8228:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(3827),r=s(8994),l=s(2169);function i(e){let{message:t="読み込み中...",className:s}=e;return(0,a.jsxs)("div",{className:(0,l.cn)("flex min-h-[40vh] flex-col items-center justify-center gap-4",s),children:[(0,a.jsx)(r.Z,{className:"h-12 w-12 text-agrix-forest animate-spin","aria-hidden":!0}),(0,a.jsx)("p",{className:"text-sm font-medium text-slate-600",children:t})]})}},575:function(e,t,s){"use strict";s.d(t,{z:function(){return d}});var a=s(3827),r=s(4090),l=s(9769),i=s(2169);let n=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold tracking-tight transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",accent:"bg-accent text-accent-foreground hover:bg-accent/80 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10",secondary:"bg-muted text-muted-foreground hover:bg-muted/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,...d}=e;return(0,a.jsx)("button",{className:(0,i.cn)(n({variant:r,size:l,className:s})),ref:t,...d})});d.displayName="Button"}},function(e){e.O(0,[866,342,150,288,250,11,486,19,971,69,744],function(){return e(e.s=4794)}),_N_E=e.O()}]);