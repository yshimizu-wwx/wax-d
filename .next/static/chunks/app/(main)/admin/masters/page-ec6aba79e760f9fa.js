(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[734],{3671:function(e,t,r){Promise.resolve().then(r.bind(r,883))},7461:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(4090),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let r=(0,s.forwardRef)((r,i)=>{let{color:o="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...f}=r;return(0,s.createElement)("svg",{ref:i,...a,width:l,height:l,stroke:o,strokeWidth:d?24*Number(c)/Number(l):c,className:["lucide","lucide-".concat(n(e)),u].join(" "),...f},[...t.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(m)?m:[m]])});return r.displayName="".concat(e),r}},6578:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8994:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4697:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},7731:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},94:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},883:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Z}});var s=r(3827),a=r(4090),n=r(4697),i=r(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,i.Z)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),l=(0,i.Z)("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),c=(0,i.Z)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);var d=r(8994),u=r(94),m=r(7731);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,i.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var h=r(6578),x=r(8793),p=r(4958);async function b(e,t){let r=p.O.from("masters").select("*").eq("type",e).order("name",{ascending:!0});t&&(r=r.or("provider_id.eq.".concat(t,",provider_id.is.null")));let{data:s,error:a}=await r;return a?(console.error("Error fetching masters:",a),[]):s||[]}async function g(e,t,r,s){try{let a="M_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),{error:n}=await p.O.from("masters").insert({id:a,provider_id:r,type:e,name:t.trim(),parent_id:s||null,status:"active"});if(n)return{success:!1,error:n.message};return{success:!0,id:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function y(e,t){try{let{error:r}=await p.O.from("masters").update(t).eq("id",e);if(r)return{success:!1,error:r.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function v(e){return y(e,{status:"inactive"})}async function w(e){return y(e,{status:"active"})}var j=r(6288),N=r(5671);let k=[{key:"crop",label:"品目",icon:(0,s.jsx)(n.Z,{className:"w-4 h-4"})},{key:"task_category",label:"作業種別",icon:(0,s.jsx)(o,{className:"w-4 h-4"})},{key:"task_detail",label:"作業詳細",icon:(0,s.jsx)(l,{className:"w-4 h-4"})},{key:"pesticide",label:"農薬",icon:(0,s.jsx)(c,{className:"w-4 h-4"})}];function Z(){let[e,t]=(0,a.useState)(null),[r,i]=(0,a.useState)(!0),[o,l]=(0,a.useState)("crop"),[c,p]=(0,a.useState)([]),[Z,C]=(0,a.useState)(!1),[M,O]=(0,a.useState)(null),[S,I]=(0,a.useState)(""),[L,E]=(0,a.useState)(!1),[_,z]=(0,a.useState)(""),[q,J]=(0,a.useState)(!1),R=(null==e?void 0:e.role)==="provider"?e.id:(null==e||e.role,null),A=async()=>{void 0!==R&&(C(!0),p(await b(o,R)),C(!1))};(0,a.useEffect)(()=>{(0,x.ts)().then(e=>{t(e),i(!1)})},[]),(0,a.useEffect)(()=>{e&&A()},[e,o]);let U=async()=>{let e=_.trim();if(!e){j.toast.error("名称を入力してください");return}J(!0);let t=await g(o,e,null!=R?R:null,void 0);J(!1),t.success?(j.toast.success("追加しました"),z(""),E(!1),A()):j.toast.error(t.error||"追加に失敗しました")},P=e=>{O(e.id),I(e.name)},F=async()=>{if(!M)return;let e=S.trim();if(!e){j.toast.error("名称を入力してください");return}J(!0);let t=await y(M,{name:e});J(!1),t.success?(j.toast.success("更新しました"),O(null),A()):j.toast.error(t.error||"更新に失敗しました")},Y=async e=>{J(!0);let t="active"===e.status?await v(e.id):await w(e.id);J(!1),t.success?(j.toast.success("active"===e.status?"無効にしました":"有効にしました"),A()):j.toast.error(t.error||"操作に失敗しました")};if(r)return(0,s.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,s.jsx)(d.Z,{className:"w-10 h-10 text-agrix-forest animate-spin"}),(0,s.jsx)("p",{className:"text-dashboard-text font-medium",children:"読み込み中..."})]})});if(!e||"admin"!==e.role&&"provider"!==e.role)return(0,s.jsx)("main",{className:"min-h-full flex items-center justify-center p-4",children:(0,s.jsx)(N.Zb,{children:(0,s.jsx)(N.aY,{className:"p-8 text-center text-dashboard-muted",children:"この画面を利用する権限がありません。"})})});let B=k.find(e=>e.key===o);return(0,s.jsx)("main",{className:"min-h-full",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("h1",{className:"text-2xl font-black text-dashboard-text flex items-center gap-2",children:[(0,s.jsx)(n.Z,{className:"w-7 h-7 text-agrix-forest"}),"マスタ管理"]}),"provider"===e.role&&(0,s.jsx)("p",{className:"text-sm text-dashboard-muted",children:"自社マスタ＋共通マスタを表示"})]}),(0,s.jsxs)(N.Zb,{className:"overflow-hidden",children:[(0,s.jsx)("div",{className:"flex border-b border-dashboard-border overflow-x-auto",children:k.map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>{l(e.key),O(null),E(!1)},className:"flex items-center gap-2 px-5 py-4 text-sm font-bold whitespace-nowrap transition-colors ".concat(o===e.key?"text-agrix-forest border-b-2 border-agrix-forest bg-agrix-forest/10":"text-dashboard-muted hover:bg-dashboard-bg"),children:[e.icon,e.label]},e.key))}),(0,s.jsx)(N.aY,{className:"p-4",children:Z?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)(d.Z,{className:"w-8 h-8 text-dashboard-muted animate-spin"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"font-bold text-dashboard-text flex items-center gap-2",children:[null==B?void 0:B.icon,null==B?void 0:B.label,"一覧"]}),(0,s.jsxs)("button",{type:"button",onClick:()=>E(!0),className:"flex items-center gap-2 bg-agrix-forest text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-agrix-forest-light transition-colors",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4"}),"追加"]})]}),L&&(0,s.jsxs)("div",{className:"flex gap-2 mb-4 p-3 bg-dashboard-bg rounded-xl border border-dashboard-border",children:[(0,s.jsx)("input",{type:"text",value:_,onChange:e=>z(e.target.value),placeholder:"名称を入力",className:"flex-1 px-4 py-2 rounded-lg border border-dashboard-border focus:ring-2 focus:ring-agrix-forest"}),(0,s.jsxs)("button",{type:"button",onClick:U,disabled:q,className:"bg-agrix-forest text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-agrix-forest-light disabled:opacity-50 flex items-center gap-2",children:[q?(0,s.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(u.Z,{className:"w-4 h-4"}),"登録"]}),(0,s.jsx)("button",{type:"button",onClick:()=>{E(!1),z("")},className:"px-4 py-2 rounded-lg border border-dashboard-border text-dashboard-muted font-bold text-sm hover:bg-dashboard-bg",children:"キャンセル"})]}),(0,s.jsx)("ul",{className:"divide-y divide-dashboard-border",children:0===c.length?(0,s.jsx)("li",{className:"py-8 text-center text-dashboard-muted text-sm",children:"データがありません。追加ボタンで登録してください。"}):c.map(e=>(0,s.jsx)("li",{className:"flex items-center justify-between py-3 px-2 rounded-lg ".concat("inactive"===e.status?"bg-dashboard-bg text-dashboard-muted":""),children:M===e.id?(0,s.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:S,onChange:e=>I(e.target.value),className:"flex-1 px-3 py-2 rounded-lg border border-dashboard-border focus:ring-2 focus:ring-agrix-forest"}),(0,s.jsxs)("button",{type:"button",onClick:F,disabled:q,className:"text-agrix-forest font-bold text-sm hover:underline disabled:opacity-50 flex items-center gap-1",children:[q?(0,s.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):null,"保存"]}),(0,s.jsx)("button",{type:"button",onClick:()=>O(null),className:"text-dashboard-muted text-sm hover:underline",children:"キャンセル"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium text-dashboard-text",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>P(e),className:"p-2 text-dashboard-muted hover:text-agrix-forest hover:bg-agrix-forest/10 rounded-lg transition-colors",title:"編集",children:(0,s.jsx)(m.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:()=>Y(e),disabled:q,className:"p-2 rounded-lg transition-colors disabled:opacity-50",title:"active"===e.status?"無効にする":"有効にする",children:"active"===e.status?(0,s.jsx)(f,{className:"w-4 h-4 text-agrix-gold hover:bg-agrix-gold/20"}):(0,s.jsx)(h.Z,{className:"w-4 h-4 text-agrix-forest hover:bg-agrix-forest/10"})})]})]})},e.id))})]})})]})]})})}},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return l}});var s=r(3827),a=r(4090),n=r(2169);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border border-border bg-card text-card-foreground shadow-sm",r),...a})});i.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});o.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-lg font-bold leading-none tracking-tight text-card-foreground",r),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},8793:function(e,t,r){"use strict";r.d(t,{Lj:function(){return i},gQ:function(){return o},ts:function(){return a},w7:function(){return n}});var s=r(4958);async function a(){try{let{data:{session:e}}=await s.O.auth.getSession();if(!e)return null;let{data:t,error:r}=await s.O.from("users").select("*").eq("email",e.user.email).single();if(r||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function n(){await s.O.auth.signOut(),window.location.href="/login"}async function i(e){try{var t;let{data:{session:r}}=await s.O.auth.getSession();if(!(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:a}=await s.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",r.user.email);if(a)return{success:!1,error:a.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function o(e){try{let{error:t}=await s.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},4958:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(3167),a=r(1367);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[342,150,288,971,69,744],function(){return e(e.s=3671)}),_N_E=e.O()}]);