(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[734],{3671:function(e,t,r){Promise.resolve().then(r.bind(r,6328))},6578:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8994:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4697:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},7731:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},94:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(7461).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6328:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var s=r(3827),a=r(4090),n=r(4697),o=r(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,o.Z)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),l=(0,o.Z)("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),d=(0,o.Z)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);var c=r(8994),u=r(94),x=r(7731);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,o.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var f=r(6578),h=r(8793),p=r(7292),b=r(6288),y=r(5671);let g=[{key:"crop",label:"品目",icon:(0,s.jsx)(n.Z,{className:"w-4 h-4"})},{key:"task_category",label:"作業種別",icon:(0,s.jsx)(i,{className:"w-4 h-4"})},{key:"task_detail",label:"作業詳細",icon:(0,s.jsx)(l,{className:"w-4 h-4"})},{key:"pesticide",label:"農薬",icon:(0,s.jsx)(d,{className:"w-4 h-4"})}];function v(){let[e,t]=(0,a.useState)(null),[r,o]=(0,a.useState)(!0),[i,l]=(0,a.useState)("crop"),[d,v]=(0,a.useState)([]),[j,w]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null),[Z,C]=(0,a.useState)(""),[M,O]=(0,a.useState)(!1),[S,_]=(0,a.useState)(""),[I,z]=(0,a.useState)(!1),L=(null==e?void 0:e.role)==="provider"?e.id:(null==e||e.role,null),U=async()=>{void 0!==L&&(w(!0),v(await (0,p.iB)(i,L)),w(!1))};(0,a.useEffect)(()=>{(0,h.ts)().then(e=>{t(e),o(!1)})},[]),(0,a.useEffect)(()=>{e&&U()},[e,i]);let E=e=>{if(!e)return"操作に失敗しました";let t=e.toLowerCase();return t.includes("permission")||t.includes("denied")||t.includes("pgrst301")?"データの保存に必要な権限がありません。管理者にご連絡ください。":e},J=async()=>{let e=S.trim();if(!e){b.toast.error("名称を入力してください");return}z(!0);let t=await (0,p.Rn)(i,e,null!=L?L:null,void 0);z(!1),t.success?(b.toast.success("追加しました"),_(""),O(!1),U()):b.toast.error(E(t.error)||"追加に失敗しました")},R=e=>{k(e.id),C(e.name)},q=async()=>{if(!N)return;let e=Z.trim();if(!e){b.toast.error("名称を入力してください");return}z(!0);let t=await (0,p.fz)(N,{name:e});z(!1),t.success?(b.toast.success("更新しました"),k(null),U()):b.toast.error(E(t.error)||"更新に失敗しました")},P=async e=>{z(!0);let t="active"===e.status?await (0,p.b9)(e.id):await (0,p.VJ)(e.id);z(!1),t.success?(b.toast.success("active"===e.status?"無効にしました":"有効にしました"),U()):b.toast.error(E(t.error)||"操作に失敗しました")};if(r)return(0,s.jsx)("main",{className:"min-h-full flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,s.jsx)(c.Z,{className:"w-10 h-10 text-agrix-forest animate-spin"}),(0,s.jsx)("p",{className:"text-dashboard-text font-medium",children:"読み込み中..."})]})});if(!e||"admin"!==e.role&&"provider"!==e.role)return(0,s.jsx)("main",{className:"min-h-full flex items-center justify-center p-4",children:(0,s.jsx)(y.Zb,{children:(0,s.jsx)(y.aY,{className:"p-8 text-center text-dashboard-muted",children:"この画面を利用する権限がありません。"})})});let A=g.find(e=>e.key===i);return(0,s.jsx)("main",{className:"min-h-full",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("h1",{className:"text-2xl font-black text-dashboard-text flex items-center gap-2",children:[(0,s.jsx)(n.Z,{className:"w-7 h-7 text-agrix-forest"}),"マスタ管理"]}),"provider"===e.role&&(0,s.jsx)("p",{className:"text-sm text-dashboard-muted",children:"自社マスタ＋共通マスタを表示"})]}),(0,s.jsxs)(y.Zb,{className:"overflow-hidden",children:[(0,s.jsx)("div",{className:"flex border-b border-dashboard-border overflow-x-auto",children:g.map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>{l(e.key),k(null),O(!1)},className:"flex items-center gap-2 px-5 py-4 text-sm font-bold whitespace-nowrap transition-colors ".concat(i===e.key?"text-agrix-forest border-b-2 border-agrix-forest bg-agrix-forest/10":"text-dashboard-muted hover:bg-dashboard-bg"),children:[e.icon,e.label]},e.key))}),(0,s.jsx)(y.aY,{className:"p-4",children:j?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)(c.Z,{className:"w-8 h-8 text-dashboard-muted animate-spin"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"font-bold text-dashboard-text flex items-center gap-2",children:[null==A?void 0:A.icon,null==A?void 0:A.label,"一覧"]}),(0,s.jsxs)("button",{type:"button",onClick:()=>O(!0),className:"flex items-center gap-2 bg-agrix-forest text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-agrix-forest-light transition-colors",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4"}),"追加"]})]}),M&&(0,s.jsxs)("div",{className:"flex gap-2 mb-4 p-3 bg-dashboard-bg rounded-xl border border-dashboard-border",children:[(0,s.jsx)("input",{type:"text",value:S,onChange:e=>_(e.target.value),placeholder:"名称を入力",className:"flex-1 px-4 py-2 rounded-lg border border-dashboard-border bg-dashboard-card text-dashboard-text placeholder:text-dashboard-muted focus:ring-2 focus:ring-agrix-forest focus:outline-none"}),(0,s.jsxs)("button",{type:"button",onClick:J,disabled:I,className:"bg-agrix-forest text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-agrix-forest-light disabled:opacity-50 flex items-center gap-2",children:[I?(0,s.jsx)(c.Z,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(u.Z,{className:"w-4 h-4"}),"登録"]}),(0,s.jsx)("button",{type:"button",onClick:()=>{O(!1),_("")},className:"px-4 py-2 rounded-lg border border-dashboard-border text-dashboard-muted font-bold text-sm hover:bg-dashboard-bg",children:"キャンセル"})]}),(0,s.jsx)("ul",{className:"divide-y divide-dashboard-border",children:0===d.length?(0,s.jsx)("li",{className:"py-8 text-center text-dashboard-muted text-sm",children:"データがありません。追加ボタンで登録してください。"}):d.map(e=>(0,s.jsx)("li",{className:"flex items-center justify-between py-3 px-2 rounded-lg ".concat("inactive"===e.status?"bg-dashboard-bg text-dashboard-muted":""),children:N===e.id?(0,s.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:Z,onChange:e=>C(e.target.value),placeholder:"名称",className:"flex-1 px-3 py-2 rounded-lg border border-dashboard-border bg-dashboard-card text-dashboard-text placeholder:text-dashboard-muted focus:ring-2 focus:ring-agrix-forest focus:outline-none"}),(0,s.jsxs)("button",{type:"button",onClick:q,disabled:I,className:"text-agrix-forest font-bold text-sm hover:underline disabled:opacity-50 flex items-center gap-1",children:[I?(0,s.jsx)(c.Z,{className:"w-4 h-4 animate-spin"}):null,"保存"]}),(0,s.jsx)("button",{type:"button",onClick:()=>k(null),className:"text-dashboard-muted text-sm hover:underline",children:"キャンセル"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium text-dashboard-text",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>R(e),className:"p-2 text-dashboard-muted hover:text-agrix-forest hover:bg-agrix-forest/10 rounded-lg transition-colors",title:"編集",children:(0,s.jsx)(x.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:()=>P(e),disabled:I,className:"p-2 rounded-lg transition-colors disabled:opacity-50",title:"active"===e.status?"無効にする":"有効にする",children:"active"===e.status?(0,s.jsx)(m,{className:"w-4 h-4 text-agrix-gold hover:bg-agrix-gold/20"}):(0,s.jsx)(f.Z,{className:"w-4 h-4 text-agrix-forest hover:bg-agrix-forest/10"})})]})]})},e.id))})]})})]})]})})}},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return o},aY:function(){return c},ll:function(){return l}});var s=r(3827),a=r(4090),n=r(2169);let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border border-border bg-card text-card-foreground shadow-sm transition-all duration-200 hover:shadow-md",r),...a})});o.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-lg font-bold leading-none tracking-tight text-card-foreground",r),...a})});l.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});d.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},8793:function(e,t,r){"use strict";r.d(t,{Lj:function(){return o},gQ:function(){return i},ts:function(){return a},w7:function(){return n}});var s=r(4958);async function a(){try{var e,t,r,a,n,o,i,l,d,c;let{data:{session:u}}=await s.O.auth.getSession();if(!(null==u?void 0:null===(e=u.user)||void 0===e?void 0:e.email))return null;let{data:x,error:m}=await s.O.from("users").select("*").eq("email",u.user.email).single();if(m||!x)return null;return{id:x.id,email:null!==(t=x.email)&&void 0!==t?t:"",role:x.role,name:null!==(r=x.name)&&void 0!==r?r:"",phone:null!==(a=x.phone)&&void 0!==a?a:"",status:null!==(n=x.status)&&void 0!==n?n:"",address:null!==(o=x.address)&&void 0!==o?o:void 0,lat:null!==(i=x.lat)&&void 0!==i?i:void 0,lng:null!==(l=x.lng)&&void 0!==l?l:void 0,associated_provider_id:null!==(d=x.associated_provider_id)&&void 0!==d?d:void 0,invitation_code:null!==(c=x.invitation_code)&&void 0!==c?c:void 0}}catch(e){return console.error("Error getting current user:",e),null}}async function n(){await s.O.auth.signOut(),window.location.href="/login"}async function o(e){try{var t;let{data:{session:r}}=await s.O.auth.getSession();if(!(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:a}=await s.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",r.user.email);if(a)return{success:!1,error:a.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function i(e){try{let{error:t}=await s.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},7292:function(e,t,r){"use strict";r.d(t,{Rn:function(){return n},VJ:function(){return l},b9:function(){return i},fz:function(){return o},iB:function(){return a}});var s=r(4958);async function a(e,t){let r=s.O.from("masters").select("*").eq("type",e).order("name",{ascending:!0});t&&(r=r.or("provider_id.eq.".concat(t,",provider_id.is.null")));let{data:a,error:n}=await r;return n?(console.error("Error fetching masters:",n),[]):a||[]}async function n(e,t,r,a){try{let n="undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),{error:o}=await s.O.from("masters").insert({id:n,provider_id:r,type:e,name:t.trim(),parent_id:a||null,status:"active"});if(o)return{success:!1,error:o.message};return{success:!0,id:n}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function o(e,t){try{let{error:r}=await s.O.from("masters").update(t).eq("id",e);if(r)return{success:!1,error:r.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function i(e){return o(e,{status:"inactive"})}async function l(e){return o(e,{status:"active"})}},4958:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(3167),a=r(1367);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[128,150,288,971,69,744],function(){return e(e.s=3671)}),_N_E=e.O()}]);