(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{980:function(e,t,r){Promise.resolve().then(r.bind(r,9940))},7461:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var a=r(4090),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let r=(0,a.forwardRef)((r,i)=>{let{color:l="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...f}=r;return(0,a.createElement)("svg",{ref:i,...n,width:o,height:o,stroke:l,strokeWidth:d?24*Number(c)/Number(o):c,className:["lucide","lucide-".concat(s(e)),u].join(" "),...f},[...t.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(m)?m:[m]])});return r.displayName="".concat(e),r}},559:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},3441:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},8994:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5497:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])},4059:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(7461).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},9940:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var a=r(3827),n=r(4090),s=r(8994),i=r(5497),l=r(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,l.Z)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var c=r(4059),d=r(559),u=r(8793),m=r(4958),f=r(6288),h=r(3280);/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function x(e,t){return e?"function"==typeof e&&(()=>{let t=Object.getPrototypeOf(e);return t.prototype&&t.prototype.isReactComponent})()||"function"==typeof e||"object"==typeof e&&"symbol"==typeof e.$$typeof&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)?n.createElement(e,t):e:null}/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,l.Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var g=r(3441);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let v=(0,l.Z)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);var y=r(2169);function b(e){var t,r,s;let{columns:i,data:l,filterColumnId:o,filterPlaceholder:c="検索..."}=e,[d,u]=(0,n.useState)([]),[m,f]=(0,n.useState)([]),b=function(e){let t={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[r]=n.useState(()=>({current:(0,h.W_)(t)})),[a,s]=n.useState(()=>r.current.initialState);return r.current.setOptions(t=>({...t,...e,state:{...a,...e.state},onStateChange:t=>{s(t),null==e.onStateChange||e.onStateChange(t)}})),r.current}({data:l,columns:i,getCoreRowModel:(0,h.sC)(),onSortingChange:u,getSortedRowModel:(0,h.tj)(),onColumnFiltersChange:f,getFilteredRowModel:(0,h.vL)(),state:{sorting:d,columnFilters:m}});return(0,a.jsxs)("div",{className:"space-y-4",children:[o&&(0,a.jsx)("input",{placeholder:c,value:null!==(s=null===(t=b.getColumn(o))||void 0===t?void 0:t.getFilterValue())&&void 0!==s?s:"",onChange:e=>{var t;return null===(t=b.getColumn(o))||void 0===t?void 0:t.setFilterValue(e.target.value)},className:"w-full max-w-sm rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-agrix-forest focus:ring-2 focus:ring-agrix-forest/20 outline-none"}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-xl border border-slate-200",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:b.getHeaderGroups().map(e=>(0,a.jsx)("tr",{children:e.headers.map(e=>(0,a.jsx)("th",{className:"px-4 py-3 font-bold text-slate-700",children:(0,a.jsxs)("div",{className:(0,y.cn)("flex items-center gap-1",e.column.getCanSort()&&"cursor-pointer select-none hover:text-agrix-forest"),onClick:e.column.getToggleSortingHandler(),children:[e.isPlaceholder?null:x(e.column.columnDef.header,e.getContext()),e.column.getCanSort()&&(0,a.jsx)("span",{className:"shrink-0",children:"asc"===e.column.getIsSorted()?(0,a.jsx)(p,{className:"h-4 w-4"}):"desc"===e.column.getIsSorted()?(0,a.jsx)(g.Z,{className:"h-4 w-4"}):(0,a.jsx)(v,{className:"h-4 w-4 opacity-50"})})]})},e.id))},e.id))}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-100",children:(null===(r=b.getRowModel().rows)||void 0===r?void 0:r.length)?b.getRowModel().rows.map(e=>(0,a.jsx)("tr",{className:"hover:bg-slate-50/50",children:e.getVisibleCells().map(e=>(0,a.jsx)("td",{className:"px-4 py-3 text-slate-800",children:x(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:i.length,className:"px-4 py-8 text-center text-slate-500",children:"データがありません"})})})]})})]})}var w=r(575),j=r(8228),N=r(5671);function k(){let[e,t]=(0,n.useState)(null),[r,l]=(0,n.useState)(!0),[h,x]=(0,n.useState)([]),[p,g]=(0,n.useState)([]),[v,y]=(0,n.useState)(!1),[k,C]=(0,n.useState)(null);(0,n.useEffect)(()=>{(0,u.ts)().then(t).finally(()=>l(!1))},[]);let Z=async()=>{let{data:e,error:t}=await m.O.from("users").select("id, email, name, role, status, created_at").eq("status","pending").order("created_at",{ascending:!1});if(t){console.error(t);return}x(e||[])},S=async e=>{let{data:t,error:r}=await m.O.from("farmer_providers").select("farmer_id, created_at").eq("provider_id",e).eq("status","active");if(r||!(null==t?void 0:t.length)){g([]);return}let a=t.map(e=>e.farmer_id),{data:n,error:s}=await m.O.from("users").select("id, name, email").in("id",a);if(s){g([]);return}let i=new Map((n||[]).map(e=>[e.id,e]));g(t.map(e=>{var t,r;let a=i.get(e.farmer_id);return{farmer_id:e.farmer_id,name:null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"—",email:null!==(r=null==a?void 0:a.email)&&void 0!==r?r:"—",created_at:e.created_at}}))};(0,n.useEffect)(()=>{e&&(y(!0),"admin"===e.role?Z().finally(()=>y(!1)):"provider"===e.role?S(e.id).finally(()=>y(!1)):y(!1))},[e]);let _=(0,n.useMemo)(()=>[{id:"name",header:"名前",accessorFn:e=>{var t;return null!==(t=e.name)&&void 0!==t?t:"—"},enableSorting:!0},{id:"email",header:"メール",accessorFn:e=>e.email,enableSorting:!0},{id:"role",header:"ロール",accessorFn:e=>e.role,enableSorting:!0},{id:"status",header:"ステータス",accessorFn:e=>e.status},{id:"created_at",header:"登録日",accessorFn:e=>e.created_at?new Date(e.created_at).toLocaleDateString("ja-JP"):"—",enableSorting:!0},{id:"actions",header:"操作",cell:e=>{let{row:t}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(w.z,{size:"sm",disabled:!!k,onClick:()=>O(t.original.id,"active"),children:[k===t.original.id?(0,a.jsx)(s.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(i.Z,{className:"h-4 w-4"}),"承認"]}),(0,a.jsxs)(w.z,{size:"sm",variant:"secondary",disabled:!!k,onClick:()=>O(t.original.id,"rejected"),children:[k===t.original.id?(0,a.jsx)(s.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(o,{className:"h-4 w-4"}),"却下"]})]})}}],[k]),M=(0,n.useMemo)(()=>[{id:"name",header:"名前",accessorFn:e=>e.name,enableSorting:!0},{id:"email",header:"メール",accessorFn:e=>e.email,enableSorting:!0},{id:"created_at",header:"紐付け日",accessorFn:e=>e.created_at?new Date(e.created_at).toLocaleDateString("ja-JP"):"—",enableSorting:!0}],[]),O=async(e,t)=>{C(e);let{error:r}=await m.O.from("users").update({status:t}).eq("id",e);if(C(null),r){f.toast.error(r.message||"更新に失敗しました");return}f.toast.success("active"===t?"承認しました":"却下しました"),Z()};return r?(0,a.jsx)("main",{className:"min-h-full",children:(0,a.jsx)(j.Z,{message:"読み込み中..."})}):e&&("admin"===e.role||"provider"===e.role)?(0,a.jsx)("main",{className:"min-h-full",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsxs)("h1",{className:"text-2xl font-black text-dashboard-text flex items-center gap-2 mb-6",children:[(0,a.jsx)(c.Z,{className:"w-7 h-7 text-agrix-forest"}),"admin"===e.role?"ユーザー承認管理":"紐付き農家一覧"]}),"admin"===e.role&&(0,a.jsx)(N.Zb,{className:"overflow-hidden",children:(0,a.jsxs)(N.aY,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"font-bold text-dashboard-text flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5 text-agrix-gold"}),"承認待ちユーザー（status: pending）"]}),v&&(0,a.jsx)(s.Z,{className:"w-5 h-5 text-dashboard-muted animate-spin"})]}),(0,a.jsx)(b,{columns:_,data:h,filterColumnId:"email",filterPlaceholder:"メールで検索..."})]})}),"provider"===e.role&&(0,a.jsx)(N.Zb,{className:"overflow-hidden",children:(0,a.jsxs)(N.aY,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"font-bold text-dashboard-text flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5 text-agrix-forest"}),"自分に紐付いている農家"]}),v&&(0,a.jsx)(s.Z,{className:"w-5 h-5 text-dashboard-muted animate-spin"})]}),(0,a.jsx)(b,{columns:M,data:p,filterColumnId:"name",filterPlaceholder:"名前で検索..."})]})})]})}):(0,a.jsx)("main",{className:"min-h-full flex items-center justify-center p-4",children:(0,a.jsx)(N.Zb,{children:(0,a.jsx)(N.aY,{className:"p-8 text-center text-dashboard-muted",children:"この画面を利用する権限がありません。"})})})}},8228:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var a=r(3827),n=r(8994),s=r(2169);function i(e){let{message:t="読み込み中...",className:r}=e;return(0,a.jsxs)("div",{className:(0,s.cn)("flex min-h-[40vh] flex-col items-center justify-center gap-4",r),children:[(0,a.jsx)(n.Z,{className:"h-12 w-12 text-agrix-forest animate-spin","aria-hidden":!0}),(0,a.jsx)("p",{className:"text-sm font-medium text-slate-600",children:t})]})}},575:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var a=r(3827),n=r(4090),s=r(9769),i=r(2169);let l=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold tracking-tight transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",accent:"bg-accent text-accent-foreground hover:bg-accent/80 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10",secondary:"bg-muted text-muted-foreground hover:bg-muted/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,t)=>{let{className:r,variant:n,size:s,...o}=e;return(0,a.jsx)("button",{className:(0,i.cn)(l({variant:n,size:s,className:r})),ref:t,...o})});o.displayName="Button"},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return o}});var a=r(3827),n=r(4090),s=r(2169);let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border border-border bg-card text-card-foreground shadow-sm",r),...n})});i.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...n})});l.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,s.cn)("text-lg font-bold leading-none tracking-tight text-card-foreground",r),...n})});o.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},8793:function(e,t,r){"use strict";r.d(t,{Lj:function(){return i},gQ:function(){return l},ts:function(){return n},w7:function(){return s}});var a=r(4958);async function n(){try{let{data:{session:e}}=await a.O.auth.getSession();if(!e)return null;let{data:t,error:r}=await a.O.from("users").select("*").eq("email",e.user.email).single();if(r||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function s(){await a.O.auth.signOut(),window.location.href="/login"}async function i(e){try{var t;let{data:{session:r}}=await a.O.auth.getSession();if(!(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email))return{success:!1,error:"ログインしていません"};let{error:n}=await a.O.from("users").update({...void 0!==e.name&&{name:e.name},...void 0!==e.phone&&{phone:e.phone},...void 0!==e.address&&{address:e.address}}).eq("email",r.user.email);if(n)return{success:!1,error:n.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function l(e){try{let{error:t}=await a.O.auth.updateUser({password:e});if(t)return{success:!1,error:t.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},4958:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let a=(0,r(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var a=r(3167),n=r(1367);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}},9769:function(e,t,r){"use strict";r.d(t,{j:function(){return i}});var a=r(3167);let n=e=>"boolean"==typeof e?"".concat(e):0===e?"0":e,s=a.W,i=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],a=null==l?void 0:l[e];if(null===t)return null;let s=n(t)||n(a);return i[e][s]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return s(e,o,null==t?void 0:null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:r,className:a,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...c}[t]):({...l,...c})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[180,342,150,288,971,69,744],function(){return e(e.s=980)}),_N_E=e.O()}]);