(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[210],{7040:function(e,t,s){Promise.resolve().then(s.bind(s,2046))},7461:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var r=s(4090),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,t)=>{let s=(0,r.forwardRef)((s,l)=>{let{color:c="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:u="",children:m,...h}=s;return(0,r.createElement)("svg",{ref:l,...a,width:i,height:i,stroke:c,strokeWidth:d?24*Number(o)/Number(i):o,className:["lucide","lucide-".concat(n(e)),u].join(" "),...h},[...t.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(m)?m:[m]])});return s.displayName="".concat(e),s}},8994:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4697:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(7461).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},2046:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var r=s(3827),a=s(4090),n=s(4697),l=s(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,l.Z)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),i=(0,l.Z)("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),o=(0,l.Z)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);var d=s(8994);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,l.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),m=(0,l.Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),h=(0,l.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),x=(0,l.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var p=s(8793),f=s(4958);async function b(e,t){let s=f.O.from("masters").select("*").eq("type",e).order("name",{ascending:!0});t&&(s=s.or("provider_id.eq.".concat(t,",provider_id.is.null")));let{data:r,error:a}=await s;return a?(console.error("Error fetching masters:",a),[]):r||[]}async function y(e,t,s,r){try{let a="M_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),{error:n}=await f.O.from("masters").insert({id:a,provider_id:s,type:e,name:t.trim(),parent_id:r||null,status:"active"});if(n)return{success:!1,error:n.message};return{success:!0,id:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function g(e,t){try{let{error:s}=await f.O.from("masters").update(t).eq("id",e);if(s)return{success:!1,error:s.message};return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function v(e){return g(e,{status:"inactive"})}async function w(e){return g(e,{status:"active"})}var j=s(6288);let k=[{key:"crop",label:"品目",icon:(0,r.jsx)(n.Z,{className:"w-4 h-4"})},{key:"task_category",label:"作業種別",icon:(0,r.jsx)(c,{className:"w-4 h-4"})},{key:"task_detail",label:"作業詳細",icon:(0,r.jsx)(i,{className:"w-4 h-4"})},{key:"pesticide",label:"農薬",icon:(0,r.jsx)(o,{className:"w-4 h-4"})}];function N(){let[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)(!0),[c,i]=(0,a.useState)("crop"),[o,f]=(0,a.useState)([]),[N,Z]=(0,a.useState)(!1),[C,_]=(0,a.useState)(null),[M,S]=(0,a.useState)(""),[L,E]=(0,a.useState)(!1),[O,q]=(0,a.useState)(""),[z,A]=(0,a.useState)(!1),P=(null==e?void 0:e.role)==="provider"?e.id:(null==e||e.role,null),B=async()=>{void 0!==P&&(Z(!0),f(await b(c,P)),Z(!1))};(0,a.useEffect)(()=>{(0,p.ts)().then(e=>{t(e),l(!1)})},[]),(0,a.useEffect)(()=>{e&&B()},[e,c]);let V=async()=>{let e=O.trim();if(!e){j.toast.error("名称を入力してください");return}A(!0);let t=await y(c,e,null!=P?P:null,void 0);A(!1),t.success?(j.toast.success("追加しました"),q(""),E(!1),B()):j.toast.error(t.error||"追加に失敗しました")},W=e=>{_(e.id),S(e.name)},D=async()=>{if(!C)return;let e=M.trim();if(!e){j.toast.error("名称を入力してください");return}A(!0);let t=await g(C,{name:e});A(!1),t.success?(j.toast.success("更新しました"),_(null),B()):j.toast.error(t.error||"更新に失敗しました")},F=async e=>{A(!0);let t="active"===e.status?await v(e.id):await w(e.id);A(!1),t.success?(j.toast.success("active"===e.status?"無効にしました":"有効にしました"),B()):j.toast.error(t.error||"操作に失敗しました")};if(s)return(0,r.jsx)("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,r.jsx)(d.Z,{className:"w-10 h-10 text-green-600 animate-spin"}),(0,r.jsx)("p",{className:"text-slate-600 font-medium",children:"読み込み中..."})]})});if(!e||"admin"!==e.role&&"provider"!==e.role)return(0,r.jsx)("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"bg-white p-8 rounded-2xl shadow border border-slate-200 text-center",children:(0,r.jsx)("p",{className:"text-slate-600",children:"この画面を利用する権限がありません。"})})});let R=k.find(e=>e.key===c);return(0,r.jsx)("main",{className:"min-h-screen bg-slate-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("h1",{className:"text-2xl font-black text-slate-800 flex items-center gap-2",children:[(0,r.jsx)(n.Z,{className:"w-7 h-7 text-green-600"}),"マスタ管理"]}),"provider"===e.role&&(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"自社マスタ＋共通マスタを表示"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,r.jsx)("div",{className:"flex border-b border-slate-200 overflow-x-auto",children:k.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>{i(e.key),_(null),E(!1)},className:"flex items-center gap-2 px-5 py-4 text-sm font-bold whitespace-nowrap transition-colors ".concat(c===e.key?"text-green-600 border-b-2 border-green-600 bg-green-50/50":"text-slate-500 hover:bg-slate-50"),children:[e.icon,e.label]},e.key))}),(0,r.jsx)("div",{className:"p-4",children:N?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)(d.Z,{className:"w-8 h-8 text-slate-400 animate-spin"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"font-bold text-slate-700 flex items-center gap-2",children:[null==R?void 0:R.icon,null==R?void 0:R.label,"一覧"]}),(0,r.jsxs)("button",{type:"button",onClick:()=>E(!0),className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-green-500 transition-colors",children:[(0,r.jsx)(u,{className:"w-4 h-4"}),"追加"]})]}),L&&(0,r.jsxs)("div",{className:"flex gap-2 mb-4 p-3 bg-slate-50 rounded-xl border border-slate-200",children:[(0,r.jsx)("input",{type:"text",value:O,onChange:e=>q(e.target.value),placeholder:"名称を入力",className:"flex-1 px-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-green-500 focus:border-green-500"}),(0,r.jsxs)("button",{type:"button",onClick:V,disabled:z,className:"bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-green-500 disabled:opacity-50 flex items-center gap-2",children:[z?(0,r.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):(0,r.jsx)(u,{className:"w-4 h-4"}),"登録"]}),(0,r.jsx)("button",{type:"button",onClick:()=>{E(!1),q("")},className:"px-4 py-2 rounded-lg border border-slate-200 text-slate-600 font-bold text-sm hover:bg-slate-100",children:"キャンセル"})]}),(0,r.jsx)("ul",{className:"divide-y divide-slate-100",children:0===o.length?(0,r.jsx)("li",{className:"py-8 text-center text-slate-500 text-sm",children:"データがありません。追加ボタンで登録してください。"}):o.map(e=>(0,r.jsx)("li",{className:"flex items-center justify-between py-3 px-2 rounded-lg ".concat("inactive"===e.status?"bg-slate-50 text-slate-400":""),children:C===e.id?(0,r.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:M,onChange:e=>S(e.target.value),className:"flex-1 px-3 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-green-500"}),(0,r.jsxs)("button",{type:"button",onClick:D,disabled:z,className:"text-green-600 font-bold text-sm hover:underline disabled:opacity-50 flex items-center gap-1",children:[z?(0,r.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):null,"保存"]}),(0,r.jsx)("button",{type:"button",onClick:()=>_(null),className:"text-slate-500 text-sm hover:underline",children:"キャンセル"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>W(e),className:"p-2 text-slate-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"編集",children:(0,r.jsx)(m,{className:"w-4 h-4"})}),(0,r.jsx)("button",{type:"button",onClick:()=>F(e),disabled:z,className:"p-2 rounded-lg transition-colors disabled:opacity-50",title:"active"===e.status?"無効にする":"有効にする",children:"active"===e.status?(0,r.jsx)(h,{className:"w-4 h-4 text-amber-600 hover:bg-amber-50"}):(0,r.jsx)(x,{className:"w-4 h-4 text-green-600 hover:bg-green-50"})})]})]})},e.id))})]})})]})]})})}},8793:function(e,t,s){"use strict";s.d(t,{ts:function(){return a},w7:function(){return n}});var r=s(4958);async function a(){try{let{data:{session:e}}=await r.O.auth.getSession();if(!e)return null;let{data:t,error:s}=await r.O.from("users").select("*").eq("email",e.user.email).single();if(s||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function n(){await r.O.auth.signOut(),window.location.href="/login"}},4958:function(e,t,s){"use strict";s.d(t,{O:function(){return r}});let r=(0,s(6070).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")}},function(e){e.O(0,[755,288,971,69,744],function(){return e(e.s=7040)}),_N_E=e.O()}]);