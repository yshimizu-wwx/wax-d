(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{9693:function(e,t,s){Promise.resolve().then(s.bind(s,2370))},7461:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(4090),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n=(e,t)=>{let s=(0,a.forwardRef)((s,n)=>{let{color:i="currentColor",size:c=24,strokeWidth:d=2,absoluteStrokeWidth:o,className:m="",children:u,...x}=s;return(0,a.createElement)("svg",{ref:n,...r,width:c,height:c,stroke:i,strokeWidth:o?24*Number(d)/Number(c):d,className:["lucide","lucide-".concat(l(e)),m].join(" "),...x},[...t.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(u)?u:[u]])});return s.displayName="".concat(e),s}},559:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},8994:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5497:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])},4059:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},2370:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(3827),r=s(4090),l=s(8994),n=s(4059),i=s(5497),c=s(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,c.Z)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),o=(0,c.Z)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var m=s(559),u=s(8793),x=s(4958),h=s(6288);function f(){let[e,t]=(0,r.useState)(null),[s,c]=(0,r.useState)(!0),[f,p]=(0,r.useState)([]),[y,j]=(0,r.useState)([]),[b,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{(0,u.ts)().then(t).finally(()=>c(!1))},[]);let g=async()=>{let{data:e,error:t}=await x.O.from("users").select("id, email, name, role, status, created_at").eq("status","pending").order("created_at",{ascending:!1});if(t){console.error(t);return}p(e||[])},k=async e=>{let{data:t,error:s}=await x.O.from("farmer_providers").select("farmer_id, created_at").eq("provider_id",e).eq("status","active");if(s||!(null==t?void 0:t.length)){j([]);return}let a=t.map(e=>e.farmer_id),{data:r,error:l}=await x.O.from("users").select("id, name, email").in("id",a);if(l){j([]);return}let n=new Map((r||[]).map(e=>[e.id,e]));j(t.map(e=>{var t,s;let a=n.get(e.farmer_id);return{farmer_id:e.farmer_id,name:null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"—",email:null!==(s=null==a?void 0:a.email)&&void 0!==s?s:"—",created_at:e.created_at}}))};(0,r.useEffect)(()=>{e&&(v(!0),"admin"===e.role?g().finally(()=>v(!1)):"provider"===e.role?k(e.id).finally(()=>v(!1)):v(!1))},[e]);let _=async(e,t)=>{w(e);let{error:s}=await x.O.from("users").update({status:t}).eq("id",e);if(w(null),s){h.toast.error(s.message||"更新に失敗しました");return}h.toast.success("active"===t?"承認しました":"却下しました"),g()};return s?(0,a.jsx)("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,a.jsx)(l.Z,{className:"w-10 h-10 text-green-600 animate-spin"}),(0,a.jsx)("p",{className:"text-slate-600 font-medium",children:"読み込み中..."})]})}):e&&("admin"===e.role||"provider"===e.role)?(0,a.jsx)("main",{className:"min-h-screen bg-slate-50",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsxs)("h1",{className:"text-2xl font-black text-slate-800 flex items-center gap-2 mb-6",children:[(0,a.jsx)(n.Z,{className:"w-7 h-7 text-green-600"}),"admin"===e.role?"ユーザー承認管理":"紐付き農家一覧"]}),"admin"===e.role&&(0,a.jsxs)("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-100 flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"font-bold text-slate-700 flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5 text-amber-600"}),"承認待ちユーザー（status: pending）"]}),b&&(0,a.jsx)(l.Z,{className:"w-5 h-5 text-slate-400 animate-spin"})]}),(0,a.jsx)("div",{className:"divide-y divide-slate-100",children:0===f.length?(0,a.jsx)("div",{className:"py-12 text-center text-slate-500 text-sm",children:"承認待ちのユーザーはいません。"}):f.map(e=>(0,a.jsxs)("div",{className:"p-4 flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(d,{className:"w-10 h-10 text-slate-300"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-slate-800",children:e.name||"—"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:e.email}),(0,a.jsxs)("p",{className:"text-xs text-slate-400",children:[e.role," \xb7 ",e.status]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>_(e.id,"active"),disabled:!!N,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-green-500 disabled:opacity-50",children:[N===e.id?(0,a.jsx)(l.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(i.Z,{className:"w-4 h-4"}),"承認"]}),(0,a.jsxs)("button",{type:"button",onClick:()=>_(e.id,"rejected"),disabled:!!N,className:"flex items-center gap-2 bg-slate-200 text-slate-700 px-4 py-2 rounded-xl text-sm font-bold hover:bg-slate-300 disabled:opacity-50",children:[N===e.id?(0,a.jsx)(l.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(o,{className:"w-4 h-4"}),"却下"]})]})]},e.id))})]}),"provider"===e.role&&(0,a.jsxs)("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-100 flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"font-bold text-slate-700 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 text-green-600"}),"自分に紐付いている農家"]}),b&&(0,a.jsx)(l.Z,{className:"w-5 h-5 text-slate-400 animate-spin"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-xs font-bold text-slate-500 uppercase",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-4",children:"名前"}),(0,a.jsx)("th",{className:"p-4",children:"メール"}),(0,a.jsx)("th",{className:"p-4",children:"紐付け日"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-100 text-sm text-slate-700",children:0===y.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:3,className:"p-8 text-center text-slate-500",children:"紐付いている農家はいません。招待リンクで農家を追加できます。"})}):y.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"p-4 font-medium",children:e.name}),(0,a.jsx)("td",{className:"p-4",children:e.email}),(0,a.jsx)("td",{className:"p-4 text-slate-500",children:e.created_at?new Date(e.created_at).toLocaleDateString("ja-JP"):"—"})]},e.farmer_id))})]})})]})]})}):(0,a.jsx)("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"bg-white p-8 rounded-2xl shadow border border-slate-200 text-center",children:(0,a.jsx)("p",{className:"text-slate-600",children:"この画面を利用する権限がありません。"})})})}},8793:function(e,t,s){"use strict";s.d(t,{ts:function(){return r},w7:function(){return l}});var a=s(4958);async function r(){try{let{data:{session:e}}=await a.O.auth.getSession();if(!e)return null;let{data:t,error:s}=await a.O.from("users").select("*").eq("email",e.user.email).single();if(s||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function l(){await a.O.auth.signOut(),window.location.href="/login"}},4958:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(6070).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")}},function(e){e.O(0,[755,288,971,69,744],function(){return e(e.s=9693)}),_N_E=e.O()}]);