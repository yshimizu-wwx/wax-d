(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{7637:function(e,t,a){Promise.resolve().then(a.bind(a,4369))},4369:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var i=a(3827),n=a(4090),s=a(7907),r=a(8792),l=a(9108),d=a(8793),o=a(4958),c=a(3389),u=a(5850),f=a(1875),p=a(7089),h=a(7307);function m(e){let{providerId:t,projects:a,bookings:s=[],height:r=500}=e,l=(0,n.useRef)(null),[d,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{o(!0)},[]);let m=[];return(a.forEach(e=>{let t=e.campaign_title||e.location||e.id||"案件",a=e.final_date||e.start_date,i=e.end_date||e.final_date||e.start_date;a&&m.push({id:"proj-".concat(e.id),title:"\uD83D\uDCCB ".concat(t),start:a,end:i?i===a?void 0:i:void 0,allDay:!0,extendedProps:{type:"project",projectId:e.id,status:e.status}})}),s.forEach(e=>{let t=e.confirmed_date||(e.applied_at?e.applied_at.split("T")[0]:null);t&&m.push({id:"book-".concat(e.id),title:"申込 #".concat(e.id.slice(-6)),start:t,allDay:!0,extendedProps:{type:"booking",bookingId:e.id,campaignId:e.campaign_id}})}),d)?(0,i.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden",children:(0,i.jsx)(c.Z,{ref:l,plugins:[u.Z,f.Z,p.Z],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"},buttonText:{today:"今日",month:"月",week:"週",list:"リスト"},locale:"ja",events:m,height:r,eventDisplay:"block",dayMaxEvents:4})}):(0,i.jsx)("div",{className:"flex items-center justify-center rounded-2xl border border-slate-200 bg-slate-50",style:{height:"number"==typeof r?"".concat(r,"px"):r},children:(0,i.jsxs)("div",{className:"flex items-center gap-2 text-slate-500",children:[(0,i.jsx)(h.Z,{className:"w-6 h-6 animate-pulse"}),(0,i.jsx)("span",{children:"カレンダーを読み込み中..."})]})})}function x(){let e=(0,s.useRouter)(),[t,a]=(0,n.useState)(null),[c,u]=(0,n.useState)([]),[f,p]=(0,n.useState)([]),[h,x]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{let t=await (0,d.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}a(t);let{data:i}=await o.O.from("projects").select("id, start_date, end_date, final_date, campaign_title, location, status").eq("provider_id",t.id);u(i||[]);let n=(i||[]).map(e=>e.id);if(n.length>0){let{data:e}=await o.O.from("bookings").select("id, campaign_id, confirmed_date, applied_at").in("campaign_id",n);p(e||[])}x(!1)})()},[e]),h||!t)?(0,i.jsx)("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,i.jsx)("main",{className:"min-h-screen bg-slate-50",children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,i.jsxs)(r.default,{href:"/admin/campaigns",className:"p-2 rounded-lg border border-slate-200 hover:bg-white flex items-center gap-2 text-slate-600",children:[(0,i.jsx)(l.Z,{className:"w-5 h-5"}),"戻る"]}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"作業カレンダー"})]}),(0,i.jsx)(m,{providerId:t.id,projects:c,bookings:f,height:600})]})})}},8793:function(e,t,a){"use strict";a.d(t,{ts:function(){return n},w7:function(){return s}});var i=a(4958);async function n(){try{let{data:{session:e}}=await i.O.auth.getSession();if(!e)return null;let{data:t,error:a}=await i.O.from("users").select("*").eq("email",e.user.email).single();if(a||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function s(){await i.O.auth.signOut(),window.location.href="/login"}},4958:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});let i=(0,a(6070).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")}},function(e){e.O(0,[554,755,250,605,971,69,744],function(){return e(e.s=7637)}),_N_E=e.O()}]);