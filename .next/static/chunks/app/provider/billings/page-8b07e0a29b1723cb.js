(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{5149:function(e,t,a){Promise.resolve().then(a.bind(a,5884))},7461:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(4090),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let a=(0,s.forwardRef)((a,i)=>{let{color:l="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...h}=a;return(0,s.createElement)("svg",{ref:i,...n,width:o,height:o,stroke:l,strokeWidth:d?24*Number(c)/Number(o):c,className:["lucide","lucide-".concat(r(e)),u].join(" "),...h},[...t.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(m)?m:[m]])});return a.displayName="".concat(e),a}},9108:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(7461).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},9475:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(7461).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},8792:function(e,t,a){"use strict";a.d(t,{default:function(){return n.a}});var s=a(5250),n=a.n(s)},7907:function(e,t,a){"use strict";var s=a(5313);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},5884:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(3827),n=a(4090),r=a(7907),i=a(8792),l=a(9108),o=a(9475);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,a(7461).Z)("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);var d=a(8793),u=a(4958);function m(){let e=(0,r.useRouter)(),[t,a]=(0,n.useState)(null),[m,h]=(0,n.useState)([]),[x,f]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{let t=await (0,d.ts)();if(!t||"provider"!==t.role){e.replace("/login");return}a(t);let{data:s}=await u.O.from("projects").select("id, campaign_title, location, final_date, status").eq("provider_id",t.id);if(!(null==s?void 0:s.length)){f(!1);return}let{data:n}=await u.O.from("bookings").select("id, campaign_id, farmer_id, area_10r, actual_area_10r, work_status, final_amount, invoice_status").in("campaign_id",s.map(e=>e.id)).eq("work_status","completed"),r=n||[],i=[...new Set(r.map(e=>e.farmer_id).filter(Boolean))],l=new Map;if(i.length>0){let{data:e}=await u.O.from("users").select("id, name").in("id",i);l=new Map((e||[]).map(e=>[e.id,e]))}let o=new Map;s.forEach(e=>{o.set(e.id,{project:e,bookings:[],totalAmount:0})}),r.forEach(e=>{let t=o.get(e.campaign_id);if(!t)return;let a=e.farmer_id?l.get(e.farmer_id):void 0,s=Number(e.final_amount)||0;t.bookings.push({...e,farmer:a}),t.totalAmount+=s}),h(Array.from(o.values()).filter(e=>e.bookings.length>0)),f(!1)})()},[e]),x||!t)?(0,s.jsx)("main",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,s.jsx)("main",{className:"min-h-screen bg-slate-50 print:bg-white",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-6 print:mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(i.default,{href:"/admin/campaigns",className:"p-2 rounded-lg border border-slate-200 hover:bg-white flex items-center gap-2 text-slate-600 print:hidden",children:[(0,s.jsx)(l.Z,{className:"w-5 h-5"}),"戻る"]}),(0,s.jsxs)("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"w-7 h-7 text-green-600"}),"請求管理"]})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>{window.print()},className:"flex items-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 print:hidden",children:[(0,s.jsx)(c,{className:"w-4 h-4"}),"印刷 / PDF"]})]}),0===m.length?(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center text-slate-600",children:[(0,s.jsx)("p",{children:"作業完了済みの申込がありません。"}),(0,s.jsx)(i.default,{href:"/admin/campaigns",className:"mt-4 inline-block text-green-600 font-medium hover:underline",children:"案件一覧へ"})]}):(0,s.jsx)("div",{className:"space-y-8",children:m.map(e=>{let{project:t,bookings:a,totalAmount:n}=e;return(0,s.jsxs)("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print:break-inside-avoid",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50",children:[(0,s.jsx)("h2",{className:"font-bold text-slate-800",children:t.campaign_title||t.location||t.id}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:["確定日: ",t.final_date||"-"," ・ 完了申込 ",a.length," 件"]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-slate-200 bg-slate-50/50",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 font-bold text-slate-700",children:"農家"}),(0,s.jsx)("th",{className:"text-right py-3 px-4 font-bold text-slate-700",children:"実績面積（反）"}),(0,s.jsx)("th",{className:"text-right py-3 px-4 font-bold text-slate-700",children:"確定金額"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-bold text-slate-700",children:"請求状況"})]})}),(0,s.jsx)("tbody",{children:a.map(e=>{var t,a,n,r;return(0,s.jsxs)("tr",{className:"border-b border-slate-100",children:[(0,s.jsx)("td",{className:"py-3 px-4 text-slate-800",children:null!==(a=null===(t=e.farmer)||void 0===t?void 0:t.name)&&void 0!==a?a:"—"}),(0,s.jsx)("td",{className:"py-3 px-4 text-right text-slate-700",children:null!==(r=null!==(n=e.actual_area_10r)&&void 0!==n?n:e.area_10r)&&void 0!==r?r:"-"}),(0,s.jsxs)("td",{className:"py-3 px-4 text-right font-medium text-slate-800",children:["\xa5",(Number(e.final_amount)||0).toLocaleString()]}),(0,s.jsx)("td",{className:"py-3 px-4 text-slate-600",children:"sent"===e.invoice_status||"processed"===e.invoice_status||"invoiced"===e.invoice_status?"請求済":"未請求"})]},e.id)})}),(0,s.jsx)("tfoot",{children:(0,s.jsxs)("tr",{className:"bg-slate-50 font-bold",children:[(0,s.jsx)("td",{className:"py-3 px-4",colSpan:2,children:"合計"}),(0,s.jsxs)("td",{className:"py-3 px-4 text-right text-slate-800",children:["\xa5",n.toLocaleString()]}),(0,s.jsx)("td",{})]})})]})})]},t.id)})})]})})}},8793:function(e,t,a){"use strict";a.d(t,{ts:function(){return n},w7:function(){return r}});var s=a(4958);async function n(){try{let{data:{session:e}}=await s.O.auth.getSession();if(!e)return null;let{data:t,error:a}=await s.O.from("users").select("*").eq("email",e.user.email).single();if(a||!t)return null;return t}catch(e){return console.error("Error getting current user:",e),null}}async function r(){await s.O.auth.signOut(),window.location.href="/login"}},4958:function(e,t,a){"use strict";a.d(t,{O:function(){return s}});let s=(0,a(6070).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")}},function(e){e.O(0,[755,250,971,69,744],function(){return e(e.s=5149)}),_N_E=e.O()}]);