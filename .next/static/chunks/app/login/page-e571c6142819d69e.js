(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8198:function(e,s,t){Promise.resolve().then(t.bind(t,378))},7907:function(e,s,t){"use strict";var a=t(5313);t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},378:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var a=t(3827),l=t(4090),r=t(7907),n=t(4958);function o(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(!0),[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(null),[x,b]=(0,l.useState)({email:"",password:"",name:"",phone:"",role:"farmer",invitationCode:""}),h=async s=>{s.preventDefault(),i(!0),c(null);try{let{data:s,error:t}=await n.O.auth.signInWithPassword({email:x.email,password:x.password});if(t)throw t;let{data:a,error:l}=await n.O.from("users").select("*").eq("email",x.email).single();if(l)throw l;if("pending"===a.status){c("メール認証が完了していません。届いたメールを確認してください。"),await n.O.auth.signOut();return}if("provider"===a.role&&"under_review"===a.status){c("アカウントは審査中です。管理者による承認後、ログインが可能になります。"),await n.O.auth.signOut();return}if("suspended"===a.status||"rejected"===a.status){c("このアカウントは現在利用できません。"),await n.O.auth.signOut();return}e.refresh(),"admin"===a.role?e.push("/admin"):"provider"===a.role?e.push("/admin/campaigns"):e.push("/")}catch(e){console.error("Login error:",e),c(e.message||"ログインに失敗しました")}finally{i(!1)}},f=async e=>{e.preventDefault(),i(!0),c(null),m(null);try{let{data:e}=await n.O.from("users").select("email").eq("email",x.email).single();if(e){c("このメールアドレスは既に登録されています");return}let{data:s,error:t}=await n.O.auth.signUp({email:x.email,password:x.password,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback"),data:{name:x.name,phone:x.phone,role:x.role,invitation_code:x.invitationCode}}});if(t)throw t;let a=("farmer"===x.role?"F":"P")+Date.now(),l="provider"===x.role?a:null;if("farmer"===x.role&&x.invitationCode){let{data:e}=await n.O.from("users").select("id").eq("invitation_code",x.invitationCode).eq("role","provider").single();e&&(l=e.id)}let{error:r}=await n.O.from("users").insert({id:a,email:x.email,role:x.role,name:x.name,phone:x.phone,status:"pending",associated_provider_id:l,invitation_code:x.invitationCode||null});if(r)throw r;m("確認メールを送信しました。メール内のリンクをクリックして登録を完了してください。"),b({email:"",password:"",name:"",phone:"",role:"farmer",invitationCode:""})}catch(e){console.error("Signup error:",e),c(e.message||"登録に失敗しました")}finally{i(!1)}};return(0,a.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsxs)("h1",{className:"text-4xl font-black text-slate-800 mb-2",children:[(0,a.jsx)("span",{className:"text-green-600",children:"\uD83C\uDF3E"})," ドローンあいのり予約"]}),(0,a.jsx)("p",{className:"text-slate-500 font-medium",children:"農家と業者をつなぐプラットフォーム"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex border-b border-slate-200",children:[(0,a.jsx)("button",{onClick:()=>{t(!0),c(null),m(null)},className:"flex-1 py-4 font-bold transition-colors ".concat(s?"bg-green-600 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100"),children:"ログイン"}),(0,a.jsx)("button",{onClick:()=>{t(!1),c(null),m(null)},className:"flex-1 py-4 font-bold transition-colors ".concat(s?"bg-slate-50 text-slate-600 hover:bg-slate-100":"bg-green-600 text-white"),children:"新規登録"})]}),(0,a.jsxs)("div",{className:"p-8",children:[d&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm font-medium",children:[(0,a.jsx)("i",{className:"fas fa-exclamation-circle mr-2"}),d]}),u&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm font-medium",children:[(0,a.jsx)("i",{className:"fas fa-check-circle mr-2"}),u]}),s?(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"メールアドレス"}),(0,a.jsx)("input",{type:"email",value:x.email,onChange:e=>b({...x,email:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"example@example.com",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"パスワード"}),(0,a.jsx)("input",{type:"password",value:x.password,onChange:e=>b({...x,password:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"••••••••",required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-green-600 text-white py-4 rounded-xl font-black shadow-lg hover:bg-green-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"ログイン中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-sign-in-alt mr-2"}),"ログイン"]})})]}):(0,a.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"ユーザー種別"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>b({...x,role:"farmer"}),className:"p-3 rounded-xl font-bold transition-all ".concat("farmer"===x.role?"bg-green-600 text-white shadow-lg":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:[(0,a.jsx)("i",{className:"fas fa-user mr-2"}),"農家"]}),(0,a.jsxs)("button",{type:"button",onClick:()=>b({...x,role:"provider"}),className:"p-3 rounded-xl font-bold transition-all ".concat("provider"===x.role?"bg-blue-600 text-white shadow-lg":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:[(0,a.jsx)("i",{className:"fas fa-building mr-2"}),"業者"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"お名前"}),(0,a.jsx)("input",{type:"text",value:x.name,onChange:e=>b({...x,name:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"山田 太郎",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"電話番号"}),(0,a.jsx)("input",{type:"tel",value:x.phone,onChange:e=>b({...x,phone:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"090-1234-5678",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"メールアドレス"}),(0,a.jsx)("input",{type:"email",value:x.email,onChange:e=>b({...x,email:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"example@example.com",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"パスワード"}),(0,a.jsx)("input",{type:"password",value:x.password,onChange:e=>b({...x,password:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"8文字以上",required:!0,minLength:8})]}),"farmer"===x.role&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"招待コード（任意）"}),(0,a.jsx)("input",{type:"text",value:x.invitationCode,onChange:e=>b({...x,invitationCode:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500",placeholder:"業者から受け取った招待コード"}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"業者から招待コードを受け取っている場合は入力してください"})]}),(0,a.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-green-600 text-white py-4 rounded-xl font-black shadow-lg hover:bg-green-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"登録中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-user-plus mr-2"}),"新規登録"]})})]})]})]}),(0,a.jsx)("p",{className:"text-center text-slate-500 text-sm mt-6",children:"\xa9 2026 ドローンあいのり予約. All rights reserved."})]})})}},4958:function(e,s,t){"use strict";t.d(s,{O:function(){return a}});let a=(0,t(6070).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")}},function(e){e.O(0,[755,971,69,744],function(){return e(e.s=8198)}),_N_E=e.O()}]);