(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8198:function(e,a,s){Promise.resolve().then(s.bind(s,378))},7907:function(e,a,s){"use strict";var t=s(5313);s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}})},378:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return o}});var t=s(3827),l=s(4090),r=s(7907),n=s(4958);function o(){let e=(0,r.useRouter)(),[a,s]=(0,l.useState)(!0),[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(null),[x,b]=(0,l.useState)({email:"",password:"",name:"",phone:"",role:"farmer",invitationCode:""}),h=async a=>{a.preventDefault(),i(!0),c(null);try{let{data:a,error:s}=await n.O.auth.signInWithPassword({email:x.email,password:x.password});if(s)throw s;let{data:t,error:l}=await n.O.from("users").select("*").eq("email",x.email).single();if(l)throw l;if("pending"===t.status){c("メール認証が完了していません。届いたメールを確認してください。"),await n.O.auth.signOut();return}if("provider"===t.role&&"under_review"===t.status){c("アカウントは審査中です。管理者による承認後、ログインが可能になります。"),await n.O.auth.signOut();return}if("suspended"===t.status||"rejected"===t.status){c("このアカウントは現在利用できません。"),await n.O.auth.signOut();return}e.refresh(),"admin"===t.role?e.push("/admin"):"provider"===t.role?e.push("/admin/campaigns"):e.push("/")}catch(e){console.error("Login error:",e),c(e.message||"ログインに失敗しました")}finally{i(!1)}},f=async e=>{e.preventDefault(),i(!0),c(null),m(null);try{let{data:e}=await n.O.from("users").select("email").eq("email",x.email).single();if(e){c("このメールアドレスは既に登録されています");return}let{data:a,error:s}=await n.O.auth.signUp({email:x.email,password:x.password,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback"),data:{name:x.name,phone:x.phone,role:x.role,invitation_code:x.invitationCode}}});if(s)throw s;let t=("farmer"===x.role?"F":"P")+Date.now(),l="provider"===x.role?t:null;if("farmer"===x.role&&x.invitationCode){let{data:e}=await n.O.from("users").select("id").eq("invitation_code",x.invitationCode).eq("role","provider").single();e&&(l=e.id)}let{error:r}=await n.O.from("users").insert({id:t,email:x.email,role:x.role,name:x.name,phone:x.phone,status:"pending",associated_provider_id:l,invitation_code:x.invitationCode||null});if(r)throw r;m("確認メールを送信しました。メール内のリンクをクリックして登録を完了してください。"),b({email:"",password:"",name:"",phone:"",role:"farmer",invitationCode:""})}catch(e){console.error("Signup error:",e),c(e.message||"登録に失敗しました")}finally{i(!1)}};return(0,t.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsxs)("h1",{className:"text-4xl font-black text-[#334155] mb-2",children:[(0,t.jsx)("span",{className:"text-[#16a34a]",children:"\uD83C\uDF3E"})," Wayfinder AgriX"]}),(0,t.jsx)("p",{className:"text-slate-500 font-medium",children:"農家と業者をつなぐプラットフォーム"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex border-b border-slate-200",children:[(0,t.jsx)("button",{onClick:()=>{s(!0),c(null),m(null)},className:"flex-1 py-4 font-bold transition-colors ".concat(a?"bg-[#16a34a] text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100"),children:"ログイン"}),(0,t.jsx)("button",{onClick:()=>{s(!1),c(null),m(null)},className:"flex-1 py-4 font-bold transition-colors ".concat(a?"bg-slate-50 text-slate-600 hover:bg-slate-100":"bg-[#16a34a] text-white"),children:"新規登録"})]}),(0,t.jsxs)("div",{className:"p-8",children:[d&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-2xl text-red-700 text-sm font-medium",children:[(0,t.jsx)("i",{className:"fas fa-exclamation-circle mr-2"}),d]}),u&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-2xl text-green-700 text-sm font-medium",children:[(0,t.jsx)("i",{className:"fas fa-check-circle mr-2"}),u]}),a?(0,t.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"メールアドレス"}),(0,t.jsx)("input",{type:"email",value:x.email,onChange:e=>b({...x,email:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"example@example.com",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"パスワード"}),(0,t.jsx)("input",{type:"password",value:x.password,onChange:e=>b({...x,password:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"••••••••",required:!0})]}),(0,t.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-[#16a34a] text-white py-4 rounded-2xl font-black shadow-sm hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"ログイン中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-sign-in-alt mr-2"}),"ログイン"]})})]}):(0,t.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"ユーザー種別"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>b({...x,role:"farmer"}),className:"p-3 rounded-2xl font-bold transition-all shadow-sm ".concat("farmer"===x.role?"bg-[#16a34a] text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:[(0,t.jsx)("i",{className:"fas fa-user mr-2"}),"農家"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>b({...x,role:"provider"}),className:"p-3 rounded-2xl font-bold transition-all shadow-sm ".concat("provider"===x.role?"bg-[#334155] text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:[(0,t.jsx)("i",{className:"fas fa-building mr-2"}),"業者"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"お名前"}),(0,t.jsx)("input",{type:"text",value:x.name,onChange:e=>b({...x,name:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"山田 太郎",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"電話番号"}),(0,t.jsx)("input",{type:"tel",value:x.phone,onChange:e=>b({...x,phone:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"090-1234-5678",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"メールアドレス"}),(0,t.jsx)("input",{type:"email",value:x.email,onChange:e=>b({...x,email:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"example@example.com",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"パスワード"}),(0,t.jsx)("input",{type:"password",value:x.password,onChange:e=>b({...x,password:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"8文字以上",required:!0,minLength:8})]}),"farmer"===x.role&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"招待コード（任意）"}),(0,t.jsx)("input",{type:"text",value:x.invitationCode,onChange:e=>b({...x,invitationCode:e.target.value}),className:"w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 focus:ring-[#16a34a]",placeholder:"業者から受け取った招待コード"}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"業者から招待コードを受け取っている場合は入力してください"})]}),(0,t.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-[#16a34a] text-white py-4 rounded-2xl font-black shadow-sm hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"登録中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-user-plus mr-2"}),"新規登録"]})})]})]})]}),(0,t.jsx)("p",{className:"text-center text-slate-500 text-sm mt-6",children:"\xa9 2026 Wayfinder AgriX. All rights reserved."})]})})}},4958:function(e,a,s){"use strict";s.d(a,{O:function(){return t}});let t=(0,s(6070).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","sb_publishable_saY21TLJVLBNk5lg53j5Pg_PW9RAlEr")}},function(e){e.O(0,[755,971,69,744],function(){return e(e.s=8198)}),_N_E=e.O()}]);