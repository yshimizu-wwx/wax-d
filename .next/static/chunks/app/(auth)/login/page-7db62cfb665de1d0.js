(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{6284:function(e,r,a){Promise.resolve().then(a.bind(a,3679))},6578:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(7461).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8994:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2244:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(7461).Z)("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]])},1213:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(7461).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},7907:function(e,r,a){"use strict";var t=a(5313);a.o(t,"usePathname")&&a.d(r,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(r,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(r,{useSearchParams:function(){return t.useSearchParams}})},3679:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return y}});var t=a(3827),s=a(4090),n=a(7907),i=a(4958),o=a(5671),l=a(2782),d=a(575),c=a(2647),u=a(7461);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,u.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=a(6578),f=a(8994),x=a(2244),g=a(1213);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let b=(0,u.Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),p=(0,u.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function v(){let e=(0,n.useSearchParams)(),[r,a]=(0,s.useState)(!0),[u,v]=(0,s.useState)(!1),[y,w]=(0,s.useState)(null),[j,N]=(0,s.useState)(null),[k,C]=(0,s.useState)(null),[O,I]=(0,s.useState)(null),[_,Z]=(0,s.useState)({email:"",password:"",name:"",phone:"",role:"farmer",invitationCode:""});(0,s.useEffect)(()=>{let r=e.get("provider_id"),t=e.get("signup");r&&("1"===t||"true"===t)&&(C(r),a(!1),Z(e=>({...e,role:"farmer"})),i.O.from("users").select("id, name").eq("id",r).eq("role","provider").single().then(e=>{let{data:r}=e;(null==r?void 0:r.name)&&I(r.name)}))},[e]);let M=async e=>{e.preventDefault(),v(!0),w(null);try{let{error:e}=await i.O.auth.signInWithPassword({email:_.email,password:_.password});if(e)throw e;let{data:r,error:a}=await i.O.from("users").select("*").eq("email",_.email).single();if(a||!r)throw await i.O.auth.signOut(),Error((null==a?void 0:a.code)==="PGRST116"?"このメールアドレスは登録されていません。新規登録をお試しください。":(null==a?void 0:a.message)||"ユーザー情報の取得に失敗しました。");if("pending"===r.status){w("メール認証が完了していません。届いたメールを確認してください。"),await i.O.auth.signOut();return}if("provider"===r.role&&"under_review"===r.status){w("アカウントは審査中です。管理者による承認後、ログインが可能になります。"),await i.O.auth.signOut();return}if("suspended"===r.status||"rejected"===r.status){w("このアカウントは現在利用できません。"),await i.O.auth.signOut();return}let t="admin"===r.role?"/admin":"provider"===r.role?"/admin":"/";window.location.href=t}catch(e){w(e instanceof Error?e.message:"ログインに失敗しました")}finally{v(!1)}},z=async e=>{e.preventDefault(),v(!0),w(null),N(null);try{let{data:e}=await i.O.from("users").select("email").eq("email",_.email).single();if(e){w("このメールアドレスは既に登録されています");return}let r={name:_.name,phone:_.phone,role:_.role,invitation_code:_.invitationCode||void 0};"farmer"===_.role&&k&&(r.provider_id=k);let{error:a}=await i.O.auth.signUp({email:_.email,password:_.password,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback"),data:r}});if(a)throw a;let t=("farmer"===_.role?"F":"P")+Date.now(),s="provider"===_.role?t:null;if("farmer"===_.role&&(_.invitationCode||k)){if(k){let{data:e}=await i.O.from("users").select("id").eq("id",k).eq("role","provider").single();e&&(s=e.id)}else{let{data:e}=await i.O.from("users").select("id").eq("invitation_code",_.invitationCode).eq("role","provider").single();e&&(s=e.id)}}let{error:n}=await i.O.from("users").insert({id:t,email:_.email,role:_.role,name:_.name,phone:_.phone,status:"pending",associated_provider_id:s,invitation_code:_.invitationCode||null});if(n)throw n;N("確認メールを送信しました。メール内のリンクをクリックして登録を完了してください。"),Z({email:"",password:"",name:"",phone:"",role:"farmer",invitationCode:""})}catch(e){w(e instanceof Error?e.message:"登録に失敗しました")}finally{v(!1)}};return(0,t.jsx)("main",{className:"min-h-screen w-full flex flex-col items-center justify-center p-4 bg-dashboard-bg bg-gradient-to-br from-dashboard-bg via-agrix-forest/[0.06] to-dashboard-bg",children:(0,t.jsxs)("div",{className:"w-full max-w-md flex flex-col items-center",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsxs)("h1",{className:"text-3xl font-black text-dashboard-text tracking-tight flex items-center justify-center gap-2",children:[(0,t.jsx)("span",{className:"text-agrix-forest","aria-hidden":!0,children:"\uD83C\uDF3E"}),"Wayfinder AgriX Drone"]}),(0,t.jsx)("p",{className:"text-dashboard-muted font-medium mt-2 text-base",children:"農家と業者をつなぐプラットフォーム"})]}),(0,t.jsxs)(o.Zb,{className:"w-full max-w-md border border-dashboard-border shadow-xl overflow-hidden rounded-2xl",children:[(0,t.jsxs)("div",{className:"flex border-b border-dashboard-border",children:[(0,t.jsx)(d.z,{type:"button",variant:r?"default":"ghost",className:"flex-1 rounded-none h-12 font-bold ".concat(r?"bg-agrix-forest text-white hover:bg-agrix-forest-light shadow-none":"bg-dashboard-bg text-dashboard-muted hover:bg-dashboard-border hover:text-dashboard-text"),onClick:()=>{a(!0),w(null),N(null)},children:"ログイン"}),(0,t.jsx)(d.z,{type:"button",variant:r?"ghost":"default",className:"flex-1 rounded-none h-12 font-bold ".concat(r?"bg-dashboard-bg text-dashboard-muted hover:bg-dashboard-border hover:text-dashboard-text":"bg-agrix-forest text-white hover:bg-agrix-forest-light shadow-none"),onClick:()=>{a(!1),w(null),N(null)},children:"新規登録"})]}),(0,t.jsxs)(o.aY,{className:"p-6",children:[y&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-destructive/10 border border-destructive/30 rounded-xl text-destructive text-sm font-medium flex items-start gap-2",children:[(0,t.jsx)(h,{className:"w-5 h-5 shrink-0 mt-0.5"}),(0,t.jsx)("span",{children:y})]}),j&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-agrix-forest/10 border border-agrix-forest/30 rounded-xl text-agrix-forest text-sm font-medium flex items-start gap-2",children:[(0,t.jsx)(m.Z,{className:"w-5 h-5 shrink-0 mt-0.5"}),(0,t.jsx)("span",{children:j})]}),r?(0,t.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"login-email",children:"メールアドレス"}),(0,t.jsx)(l.I,{id:"login-email",type:"email",value:_.email,onChange:e=>Z({..._,email:e.target.value}),placeholder:"example@example.com",required:!0,className:"border-dashboard-border bg-dashboard-card"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"login-password",children:"パスワード"}),(0,t.jsx)(l.I,{id:"login-password",type:"password",value:_.password,onChange:e=>Z({..._,password:e.target.value}),placeholder:"••••••••",required:!0,className:"border-dashboard-border bg-dashboard-card"})]}),(0,t.jsx)(d.z,{type:"submit",disabled:u,className:"w-full h-12 font-bold rounded-xl bg-agrix-forest text-white hover:bg-agrix-forest-light border-0",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Z,{className:"w-4 h-4 animate-spin"})," ログイン中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Z,{className:"w-4 h-4"})," ログイン"]})})]}):(0,t.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{children:"ユーザー種別"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)(d.z,{type:"button",variant:"farmer"===_.role?"default":"secondary",className:"farmer"===_.role?"bg-agrix-forest text-white hover:bg-agrix-forest-light border-0":"",onClick:()=>Z({..._,role:"farmer"}),children:[(0,t.jsx)(g.Z,{className:"w-4 h-4"})," 農家"]}),(0,t.jsxs)(d.z,{type:"button",variant:"provider"===_.role?"accent":"secondary",className:"provider"===_.role?"bg-agrix-gold text-agrix-forest hover:bg-agrix-gold-light border-0":"",onClick:()=>Z({..._,role:"provider"}),children:[(0,t.jsx)(b,{className:"w-4 h-4"})," 業者"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"signup-name",children:"お名前"}),(0,t.jsx)(l.I,{id:"signup-name",type:"text",value:_.name,onChange:e=>Z({..._,name:e.target.value}),placeholder:"山田 太郎",required:!0,className:"border-dashboard-border bg-dashboard-card"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"signup-phone",children:"電話番号"}),(0,t.jsx)(l.I,{id:"signup-phone",type:"tel",value:_.phone,onChange:e=>Z({..._,phone:e.target.value}),placeholder:"090-1234-5678",required:!0,className:"border-dashboard-border bg-dashboard-card"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"signup-email",children:"メールアドレス"}),(0,t.jsx)(l.I,{id:"signup-email",type:"email",value:_.email,onChange:e=>Z({..._,email:e.target.value}),placeholder:"example@example.com",required:!0,className:"border-dashboard-border bg-dashboard-card"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"signup-password",children:"パスワード"}),(0,t.jsx)(l.I,{id:"signup-password",type:"password",value:_.password,onChange:e=>Z({..._,password:e.target.value}),placeholder:"8文字以上",required:!0,minLength:8,className:"border-dashboard-border bg-dashboard-card"})]}),"farmer"===_.role&&(0,t.jsxs)(t.Fragment,{children:[k&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-agrix-forest/10 border border-agrix-forest/30 text-agrix-forest text-sm",children:O?"「".concat(O,"」から招待されています。登録完了後に自動で紐付けられます。"):"招待リンクから登録されています。登録完了後に業者と自動で紐付けられます。"}),!k&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c._,{htmlFor:"signup-invitation",children:"招待コード（任意）"}),(0,t.jsx)(l.I,{id:"signup-invitation",type:"text",value:_.invitationCode,onChange:e=>Z({..._,invitationCode:e.target.value}),placeholder:"業者から受け取った招待コード",className:"border-dashboard-border bg-dashboard-card"}),(0,t.jsx)("p",{className:"text-xs text-dashboard-muted",children:"業者から招待コードを受け取っている場合は入力してください"})]})]}),(0,t.jsx)(d.z,{type:"submit",disabled:u,className:"w-full h-12 font-bold rounded-xl bg-agrix-forest text-white hover:bg-agrix-forest-light border-0",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Z,{className:"w-4 h-4 animate-spin"})," 登録中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p,{className:"w-4 h-4"})," 新規登録"]})})]})]})]}),(0,t.jsxs)("p",{className:"text-dashboard-muted text-sm mt-6 text-center",children:["\xa9 2026"," ",(0,t.jsx)("a",{href:"https://wayfinderworx.com/",target:"_blank",rel:"noopener noreferrer",className:"text-dashboard-text hover:text-agrix-forest underline underline-offset-2",children:"Wayfinder WorX"}),"."]})]})})}function y(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("main",{className:"min-h-screen w-full flex flex-col items-center justify-center p-4 bg-dashboard-bg",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-dashboard-muted",children:[(0,t.jsx)(f.Z,{className:"w-6 h-6 animate-spin"}),(0,t.jsx)("span",{children:"読み込み中..."})]})}),children:(0,t.jsx)(v,{})})}},575:function(e,r,a){"use strict";a.d(r,{z:function(){return l}});var t=a(3827),s=a(4090),n=a(9769),i=a(2169);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-bold tracking-tight transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",accent:"bg-accent text-accent-foreground hover:bg-accent/80 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-transparent text-primary hover:bg-primary/10",secondary:"bg-muted text-muted-foreground hover:bg-muted/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,r)=>{let{className:a,variant:s,size:n,...l}=e;return(0,t.jsx)("button",{className:(0,i.cn)(o({variant:s,size:n,className:a})),ref:r,...l})});l.displayName="Button"},5671:function(e,r,a){"use strict";a.d(r,{Ol:function(){return o},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},ll:function(){return l}});var t=a(3827),s=a(4090),n=a(2169);let i=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border border-border bg-card text-card-foreground shadow-sm",a),...s})});i.displayName="Card";let o=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("h3",{ref:r,className:(0,n.cn)("text-lg font-bold leading-none tracking-tight text-card-foreground",a),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},2782:function(e,r,a){"use strict";a.d(r,{I:function(){return i}});var t=a(3827),s=a(4090),n=a(2169);let i=s.forwardRef((e,r)=>{let{className:a,type:s,...i}=e;return(0,t.jsx)("input",{type:s,className:(0,n.cn)("flex h-11 w-full rounded-lg border border-border bg-card px-4 py-2 text-sm font-medium text-foreground ring-offset-background transition-colors","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:border-primary","disabled:cursor-not-allowed disabled:opacity-50",a),ref:r,...i})});i.displayName="Input"},2647:function(e,r,a){"use strict";a.d(r,{_:function(){return i}});var t=a(3827),s=a(4090),n=a(2169);let i=s.forwardRef((e,r)=>{let{className:a,...s}=e;return(0,t.jsx)("label",{ref:r,className:(0,n.cn)("block text-sm font-bold text-foreground leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",a),...s})});i.displayName="Label"},4958:function(e,r,a){"use strict";a.d(r,{O:function(){return t}});let t=(0,a(342).createBrowserClient)("https://ayvieorwnyxxfygbhzny.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dmllb3J3bnl4eGZ5Z2Joem55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjY1OTUsImV4cCI6MjA4NjQwMjU5NX0.-alPp1Cr1J2yoKcdaln4LMbOPjaGCb4wRjURGhibLPk")},2169:function(e,r,a){"use strict";a.d(r,{cn:function(){return n}});var t=a(3167),s=a(1367);function n(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return(0,s.m6)((0,t.W)(r))}},9769:function(e,r,a){"use strict";a.d(r,{j:function(){return i}});var t=a(3167);let s=e=>"boolean"==typeof e?"".concat(e):0===e?"0":e,n=t.W,i=(e,r)=>a=>{var t;if((null==r?void 0:r.variants)==null)return n(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:i,defaultVariants:o}=r,l=Object.keys(i).map(e=>{let r=null==a?void 0:a[e],t=null==o?void 0:o[e];if(null===r)return null;let n=s(r)||s(t);return i[e][n]}),d=a&&Object.entries(a).reduce((e,r)=>{let[a,t]=r;return void 0===t||(e[a]=t),e},{});return n(e,l,null==r?void 0:null===(t=r.compoundVariants)||void 0===t?void 0:t.reduce((e,r)=>{let{class:a,className:t,...s}=r;return Object.entries(s).every(e=>{let[r,a]=e;return Array.isArray(a)?a.includes({...o,...d}[r]):({...o,...d})[r]===a})?[...e,a,t]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)}}},function(e){e.O(0,[128,150,971,69,744],function(){return e(e.s=6284)}),_N_E=e.O()}]);