"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813],{6036:function(e,t,l){l.r(t),l.d(t,{default:function(){return p}});var r=l(3827),n=l(4090),a=l(3614),o=l(6052),s=l(7378),u=l(6461),i=l.n(u);l(9851),l(3623);var d=l(47),c=l(6763);function m(e){switch(e){case 1:return"位置情報が許可されていません。ブラウザの設定で位置情報を許可するか、住所で検索してください。";case 2:return"位置情報を取得できませんでした。ネットワークや設定を確認して再試行してください。";case 3:return"位置情報の取得がタイムアウトしました。もう一度お試しください。";default:return"位置情報を利用できません。住所で検索してください。"}}var f=l(1004),g=l(8561),h=l(2999);l(8506),delete i().Icon.Default.prototype._getIconUrl,i().Icon.Default.mergeOptions({iconUrl:g.Z.src,iconRetinaUrl:f.Z.src,shadowUrl:h.Z.src});let x=[35.6812,139.7671];function b(e){let{onPolygonComplete:t,initialPolygon:l,flyTo:r}=e,o=(0,a.Sx)(),s=(0,n.useRef)(new(i()).FeatureGroup),u=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!r)return;let e="".concat(r[0],",").concat(r[1]);u.current!==e&&(u.current=e,o.flyTo([r[0],r[1]],15,{duration:.5}))},[o,r]),(0,n.useEffect)(()=>{let e=s.current;if(o.addLayer(e),l&&l.length>2){let t=i().polygon(l,{color:"#1A4731",fillColor:"#1A4731",fillOpacity:.25,weight:3});e.addLayer(t),o.fitBounds(t.getBounds())}let r=new(i()).Control.Draw({draw:{polygon:{allowIntersection:!1,showArea:!0,shapeOptions:{color:"#1A4731",fillColor:"#1A4731",fillOpacity:.25,weight:3}},rectangle:!1,circle:!1,marker:!1,polyline:!1,circlemarker:!1},edit:{featureGroup:e,remove:!0,edit:!1}});return o.addControl(r),o.on(i().Draw.Event.CREATED,l=>{let r=l.layer;e.clearLayers(),e.addLayer(r);let n=r.getLatLngs()[0].map(e=>({lat:e.lat,lng:e.lng})),a=(0,d.nn)(r);t(n,(0,d.fw)(a),a)}),o.on(i().Draw.Event.DELETED,()=>{t(null,0,null)}),()=>{o.removeControl(r),o.removeLayer(e),o.off(i().Draw.Event.CREATED),o.off(i().Draw.Event.DELETED)}},[o,t,l]),null}function p(e){var t;let{initialCenter:l,initialAddress:a,showAddressSearch:u=!1}=e,[i,d]=(0,n.useState)(null),[f,g]=(0,n.useState)(""),[h,p]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),[w,E]=(0,n.useState)(null),[C,j]=(0,n.useState)(!1),k=(0,n.useRef)(!1),D=(0,n.useRef)(!1),{getCurrentPosition:T,loading:N,error:A,clearError:L}=function(){let[e,t]=(0,n.useState)(!1),[l,r]=(0,n.useState)(null);return{getCurrentPosition:(0,n.useCallback)(()=>{var e;return(null===(e=navigator)||void 0===e?void 0:e.geolocation)?(r(null),t(!0),new Promise(e=>{let l=setTimeout(()=>{t(!1),r({code:3,message:"Timeout",userFriendlyMessage:m(3)}),e(null)},1e4);navigator.geolocation.getCurrentPosition(n=>{clearTimeout(l),t(!1),r(null),e({lat:n.coords.latitude,lng:n.coords.longitude})},n=>{var a,o;clearTimeout(l),t(!1);let s=null!==(a=null==n?void 0:n.code)&&void 0!==a?a:0;r({code:s,message:null!==(o=null==n?void 0:n.message)&&void 0!==o?o:"Unknown",userFriendlyMessage:m(s)}),e(null)},{enableHighAccuracy:!0,timeout:8e3,maximumAge:5e3})})):(r({code:0,message:"Geolocation not supported",userFriendlyMessage:"お使いのブラウザでは位置情報を利用できません。住所で検索してください。"}),Promise.resolve(null))},[]),loading:e,error:l,clearError:()=>r(null)}}(),S=null!==(t=null!=l?l:w)&&void 0!==t?t:x,R=!l&&!!(null==a?void 0:a.trim())&&null===w;(0,n.useEffect)(()=>{let e=null==a?void 0:a.trim();e&&!D.current&&(D.current=!0,g(e))},[a]),(0,n.useEffect)(()=>{(null==a?void 0:a.trim())&&null==l&&!k.current&&(k.current=!0,(0,c.V)(a.trim()).then(e=>{if(e){let t=[e.lat,e.lng];E(t),d(t),j(!0),setTimeout(()=>j(!1),600)}else E(x)}))},[a,l]);let F=(0,n.useCallback)(async()=>{let e=f.trim();if(e){p(!0),y(null),L();try{let t=await (0,c.V)(e);t?(d([t.lat,t.lng]),j(!0),setTimeout(()=>j(!1),600)):y("住所が見つかりませんでした。別のキーワードで試してください。")}catch(e){y("検索に失敗しました。しばらくしてから再試行してください。")}finally{p(!1)}}},[f,L]),I=(0,n.useCallback)(async()=>{y(null),L();let e=await T();e&&(d([e.lat,e.lng]),j(!0),setTimeout(()=>j(!1),600))},[T,L]);return(0,r.jsxs)("div",{className:"w-full h-full flex flex-col min-h-0",children:[u&&(0,r.jsxs)("div",{className:"shrink-0 flex flex-wrap gap-2 mb-2",children:[(0,r.jsx)("input",{type:"text",value:f,onChange:e=>{g(e.target.value),y(null),L()},onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),F()),placeholder:"住所で検索（例: 東京都千代田区）",className:"flex-1 min-w-[160px] px-3 py-2 text-sm bg-dashboard-bg border border-dashboard-border rounded-lg outline-none focus:ring-2 focus:ring-agrix-forest text-dashboard-text placeholder:text-dashboard-muted"}),(0,r.jsx)("button",{type:"button",onClick:F,disabled:h,className:"px-4 py-2 text-sm font-medium rounded-lg bg-agrix-forest hover:bg-agrix-forest-dark text-white disabled:opacity-50",children:h?"検索中...":"地図を移動"}),(0,r.jsx)("button",{type:"button",onClick:I,disabled:N,className:"px-4 py-2 text-sm font-medium rounded-lg border border-dashboard-border bg-dashboard-card hover:bg-dashboard-bg text-dashboard-text disabled:opacity-50",title:"現在地へ移動",children:N?"取得中...":"現在地"}),(v||A)&&(0,r.jsx)("p",{className:"w-full text-xs text-destructive",children:v||(null==A?void 0:A.userFriendlyMessage)})]}),(0,r.jsx)("div",{className:"flex-1 min-h-0 rounded-lg overflow-hidden relative",children:R?(0,r.jsx)("div",{className:"w-full h-full min-h-[400px] rounded-lg bg-dashboard-card flex items-center justify-center text-dashboard-muted text-sm",children:"拠点住所から地図を読み込み中..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.h,{center:S,zoom:15,style:{height:"100%",width:"100%",minHeight:"400px",borderRadius:"0.5rem"},children:[(0,r.jsx)(s.I,{attribution:'\xa9 <a href="https://www.google.com/maps">Google</a>',url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",maxZoom:20}),(0,r.jsx)(b,{...e,flyTo:i})]}),C&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none rounded-lg bg-black/20",children:(0,r.jsx)("span",{className:"px-3 py-2 text-sm font-medium rounded-lg bg-dashboard-card text-dashboard-text shadow",children:"移動中..."})})]})})]})}}}]);