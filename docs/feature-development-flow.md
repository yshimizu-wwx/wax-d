# 機能開発フロー（v0.3 Feature Expansion）

確立したテスト・品質基盤（v0.1, v0.2）を使い、「テスト→実装→QA」のサイクルで安全に機能追加・改修を行う手順です。

## 1. ターゲット機能の選定

次に実装または改修する具体的な機能を決める。

- 例: 新規CRUD、UI改善、ログアウト、一覧のフィルタ など
- スコープを小さくし、1サイクルで「E2E追加 → 実装 → 検証」まで完了できる単位にする。

## 2. TDD / E2E ファースト

**実装の前に**、その機能の期待動作を E2E で定義する。

- `e2e/[feature-name].spec.ts` を追加（例: `e2e/logout.spec.ts`）
- ユーザー視点の「こうなったら成功」をテストで書く
- 実行: `npm run test:e2e`（事前に `npm run dev` でアプリを起動）

## 3. 実装

- 機能を実装する
- 既存の E2E（ログイン等）が壊れないようにする

## 4. 検証

以下をパスさせる。

| コマンド | 内容 |
|----------|------|
| `npm run check` | Lint と型チェック（エラー 0 件） |
| `npm run test:e2e` | 全 E2E（ログイン・ログアウト等）が通ること |

**E2E 実行前**: 初回は `npx playwright install`。別ターミナルで `npm run dev` を起動し、`http://localhost:3000` でアプリが動いていること。

## 5. RLS 確認（該当する場合）

新規テーブルやカラムを追加した場合のみ:

- [docs/rls-verification.md](./rls-verification.md) のチェックリストに従い、RLS ポリシーと権限を確認する
- 必要に応じて `src/lib/__tests__/rls-verification.test.ts` にアサーションを追加

## 受入基準（Done）

- [ ] 新機能が実装され、対応する E2E が追加・パスしている
- [ ] 既存のテスト（ログイン等）が壊れていない
- [ ] Lint / TypeCheck のエラーが 0 件

## 今回の実装例（v0.3）

- **ターゲット機能**: ログアウト
- **E2E**: `e2e/logout.spec.ts` — ログイン後、ユーザーメニューから「ログアウト」を押すと `/login` に遷移することを検証
- **実装**: 既存の `signOut()` と UserMenu の「ログアウト」で充足（変更なし）
- **検証**: `npm run check` および `npm run test:e2e` で確認
