Type: Feature
Priority: High
Milestone: v0.1

概要
業者が特定の地域を地図上で指定（ポリゴン描画）し、逆オークション条件（開始単価・目標単価・面積）を設定して案件を公開する機能を実装する。

現状の課題・背景
現在はGASベースの管理であり、地理的な範囲指定が曖昧。業者が直感的に「このエリアで募集したい」と指定でき、かつその範囲内の農家を自動抽出するための基盤が必要。

修正・実装内容
[ ] Google Maps APIを用いたポリゴン描画インターフェースの構築
[ ] 描画されたポリゴン座標（JSON）の保存処理
[ ] 逆オークションパラメータ（開始/目標単価、目標/最低面積）の入力フォーム作成
[ ] ポリゴン範囲から「表示用地区名」を逆ジオコーディングで自動取得するロジックの実装
[ ] 招待コード発行ロジックの実装

関連ファイル (推測)
src/components/provider/CampaignEditor.tsx
src/hooks/useGoogleMapsPolygon.ts
lib/supabase/campaigns.ts

受入基準 (Doneの定義)
[ ] 地図上で多角形を描画し、その頂点座標がDBに保存されること
[ ] 入力された面積条件に基づき、案件の「募集開始」ステータスが正常に遷移すること
[ ] 描画エリアから住所（地区名）が自動補完されること

Type: Feature
Priority: High
Milestone: v0.1

概要
農家が自身の所有する畑（圃場）を地図上でポリゴン登録し、面積（反別）と位置情報をシステムに保存する機能を実装する。

現状の課題・背景
「あいのり」に参加するためには、農家の畑が案件エリア内にあるかをシステム的に判定する必要がある。住所文字情報だけでなく、正確な形状と座標データが必須。

修正・実装内容
[ ] 農家向け「My畑管理」画面の作成
[ ] 畑のポリゴン描画機能（Google Maps連携）
[ ] 描画した形状から面積（10a単位）を自動計算するロジック
[ ] 畑ごとの基本情報（作物種別、住所、名称）の保存機能

関連ファイル (推測)
src/components/farmer/FieldRegistration.tsx
lib/area-calculator.ts
src/types/field.ts

受入基準 (Doneの定義)
[ ] 農家が自身の畑を地図上で囲い、面積が自動算出されること
[ ] 登録した畑がリスト表示および地図上に再表示されること

Type: Feature
Priority: High
Milestone: v0.1

概要
案件への申込総面積（totalArea10r）に応じて、リアルタイムに現在の適用単価を算出・表示するロジックを実装する。

現状の課題・背景
「人が集まれば安くなる」という本システムのコア価値を担保するため、複雑な価格変動を正確に計算し、農家へのインセンティブとして可視化する必要がある。

修正・実装内容
[ ] 総面積に基づいた単価スライド計算関数の作成（開始単価〜目標単価の線形または段階補間）
[ ] 案件詳細画面での「現在の単価」および「目標達成までの残り面積」のリアルタイム表示
[ ] 募集締切時の最終単価確定処理と通知トリガー

関連ファイル (推測)
lib/pricing-engine.ts
src/components/common/PriceSimulator.tsx
supabase/functions/calculate-final-price/index.ts

受入基準 (Doneの定義)
[ ] 新しい申込（エントリー）があるたびに、総面積と現在単価が正しく更新されること
[ ] 目標面積達成時に、単価が最低値（目標単価）で固定されること

Type: UI-UX
Priority: Medium
Milestone: v0.2

概要
農家が登録した「自分の畑」が含まれる案件を、地図上で視覚的に探し出し、参加可能性を判定する機能を実装する。

現状の課題・背景
リスト形式の検索では、自分の畑が業者の指定エリア（ポリゴン）に合致しているか判断しづらい。空間クエリを用いた直感的なマッチングが必要。

修正・実装内容
[ ] 募集中の案件ポリゴンを地図上にレイヤー表示
[ ] 農家の登録済み畑ポリゴンと、案件ポリゴンの重なり判定（Spatial Query）
[ ] 自分の畑がエリア内の場合に「参加可能」フラグを表示するUI

関連ファイル (推測)
src/components/farmer/CaseMapFinder.tsx
lib/supabase/spatial-queries.ts

受入基準 (Doneの定義)
[ ] 地図上で自分の畑の近くで募集されている案件がピンおよびポリゴンで表示されること
[ ] 重なり判定により、参加可能な畑をドロップダウン等で選択できること

Type: Feature
Priority: Medium
Milestone: v0.2

概要
業者が現地で作業を完了した際、現場写真と実際の薬剤使用量を報告し、ステータスを「作業完了」に更新する機能を実装する。

現状の課題・背景
作業実施の証拠（エビデンス）を残すことで農家の信頼を確保し、請求処理へ繋げるためのトリガーが必要。モバイル端末からの操作性を重視する。

修正・実装内容
[ ] 業者向け「作業報告」モバイルUIの構築
[ ] カメラ起動および写真アップロード機能（Storage連携）
[ ] 薬剤名、希釈倍率、実使用量の入力フォーム
[ ] ステータス更新（confirmed -> completed）に伴う農家へのプッシュ通知

関連ファイル (推測)
src/components/provider/WorkReportForm.tsx
lib/storage-client.ts
src/hooks/useNotification.ts

受入基準 (Doneの定義)
[ ] 現場で撮影した写真が正常にアップロードされ、案件データと紐付いていること
[ ] 完了報告後、ステータスが「作業完了」に変わり、編集不可（読み取り専用）になること

Type: Feature
Priority: Low
Milestone: 次のフェーズ

概要
農家が個別に送信した「作業依頼リクエスト」を業者が確認し、それを元に新しい「あいのり案件（キャンペーン）」を作成できるワークフローを実装する。

現状の課題・背景
業者が旗を振るだけでなく、農家のニーズから案件が生まれる「ボトムアップ型」の組成をサポートし、マッチング率を高める。

修正・実装内容
[ ] 農家からのリクエスト送信フォーム（希望日、希望単価、畑選択）
[ ] 業者ダッシュボードでのリクエスト一覧表示（地図プロット）
[ ] リクエスト情報をコピーして案件作成画面へ引き継ぐ「案件化」ボタンの実装

関連ファイル (推測)
src/components/farmer/RequestForm.tsx
src/components/provider/RequestInbox.tsx

受入基準 (Doneの定義)
[ ] 農家のリクエストを業者が承諾した際、そのリクエスト内容をベースにした新規案件が自動生成されること